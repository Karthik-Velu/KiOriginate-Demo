<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ki originate - monitoring dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        
        .card {
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            transition: all 0.2s ease-in-out;
        }
        
        .card:hover {
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -2px rgb(0 0 0 / 0.1);
        }
        
        .nav-tab {
            padding: 1rem 1.5rem;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            font-weight: 600;
            color: #6b7280;
            transition: all 0.3s ease;
        }
        
        .nav-tab.active {
            color: #4f46e5;
            border-bottom-color: #4f46e5;
            background-color: #eef2ff;
        }
        
        .nav-tab:hover {
            color: #4f46e5;
            background-color: #f8fafc;
        }
        
        .section-content {
            display: none;
        }
        
        .section-content.active {
            display: block;
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .metric-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 1rem;
            padding: 1.5rem;
        }
        
        .metric-value {
            font-size: 2.5rem;
            font-weight: 700;
            line-height: 1;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: 600;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-primary:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .btn-secondary {
            background-color: #e5e7eb;
            color: #374151;
            font-weight: 600;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
        }
        
        .btn-secondary:hover {
            background-color: #d1d5db;
        }
        
        .alert-card {
            border-left: 4px solid #ef4444;
            background-color: #fef2f2;
        }
        
        .warning-card {
            border-left: 4px solid #f59e0b;
            background-color: #fffbeb;
        }
        
        .success-card {
            border-left: 4px solid #10b981;
            background-color: #ecfdf5;
        }
        
        .data-table {
            overflow-x: auto;
        }
        
        .data-table table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .data-table th,
        .data-table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .data-table th {
            background-color: #f9fafb;
            font-weight: 600;
            color: #374151;
        }
        
        .kaleidofin-logo {
            display: inline-block;
            margin-right: 1rem;
        }
        
        .kaleidofin-logo svg {
            height: 32px;
            width: auto;
        }
        
        .performance-toggle {
            background-color: #4f46e5;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .performance-toggle:hover {
            background-color: #4338ca;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 50;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }
        
        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background-color: white;
            border-radius: 0.75rem;
            padding: 2rem;
            width: 90%;
            max-width: 700px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-step {
            display: none;
        }

        .stepper {
            display: flex;
            justify-content: space-between;
            margin-bottom: 2rem;
        }
        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex-grow: 1;
            position: relative;
        }
        .step-circle {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: #e5e7eb;
            color: #6b7280;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            border: 2px solid #e5e7eb;
            transition: all 0.3s ease;
        }
        .step-label {
            margin-top: 0.5rem;
            font-size: 0.8rem;
            color: #6b7280;
            text-align: center;
        }
        .step-line {
            position: absolute;
            top: 15px;
            left: 50%;
            width: 100%;
            height: 2px;
            background-color: #e5e7eb;
            z-index: -1;
        }
        .step:last-child .step-line {
            display: none;
        }

        .step.active .step-circle {
            background-color: #4f46e5;
            color: white;
            border-color: #4f46e5;
        }
        .step.active .step-label {
            color: #4f46e5;
            font-weight: 600;
        }

        .step.completed .step-circle {
            background-color: #10b981;
            color: white;
            border-color: #10b981;
        }

        .step.completed .step-line {
            background-color: #10b981;
        }

        .upload-box {
            border: 2px dashed #d1d5db;
            border-radius: 0.5rem;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
        }
        .upload-box:hover {
            background-color: #f9fafb;
            border-color: #4f46e5;
        }
        .roll-rate-table td {
            text-align: center;
        }
        .roll-rate-table .bg-gray-100 {
            background-color: #f3f4f6;
            font-weight: bold;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="min-h-screen">
        <!-- Header -->
        <div class="bg-white shadow-sm border-b">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-16">
                    <div class="flex items-center space-x-4">
                        <button onclick="window.location.href='india-home.html'" class="text-gray-500 hover:text-gray-700">
                            <i class="fas fa-arrow-left text-xl"></i>
                        </button>
                        <div class="kaleidofin-logo">
                            <svg width="164" height="30" viewBox="0 0 164 30" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M0.105469 8.45524L17.0689 0V6.76419L0.105469 15.2194V8.45524Z" fill="#0F547E" style="fill:#0F547E;fill:color(display-p3 0.0588 0.3294 0.4941);fill-opacity:1;"/>
                                <path d="M0.105469 15.3882L17.0689 23.8434V17.0792L0.105469 8.62402V15.3882Z" fill="#28B2B6" style="fill:#28B2B6;fill:color(display-p3 0.1569 0.6980 0.7137);fill-opacity:1;"/>
                                <path d="M38.8973 7.79234L32.7479 14.3625L39.0221 23.4083H33.9341L29.8762 17.4412L28.1593 19.2821V23.4083H24.0078V0.428711H28.1593V13.6007L33.4659 7.79234H38.8973Z" fill="#0F547E" style="fill:#0F547E;fill:color(display-p3 0.0588 0.3294 0.4941);fill-opacity:1;"/>
                                <path d="M43.7233 23.4083H39.5717V7.79236H43.7233V23.4083ZM39.0723 2.68225C39.0723 1.96282 39.322 1.34918 39.8214 0.841347C40.3208 0.312351 40.9244 0.0478516 41.6319 0.0478516C42.3394 0.0478516 42.9429 0.301771 43.4423 0.809609C43.9417 1.31744 44.1915 1.94167 44.1915 2.68225C44.1915 3.38053 43.9417 3.98359 43.4423 4.49142C42.9429 4.99927 42.3394 5.25318 41.6319 5.25318C40.9244 5.25318 40.3208 4.99927 39.8214 4.49142C39.322 3.98359 39.0723 3.38053 39.0723 2.68225Z" fill="#0F547E" style="fill:#0F547E;fill:color(display-p3 0.0588 0.3294 0.4941);fill-opacity:1;"/>
                                <path d="M63.6016 21.7378C62.0603 23.2502 60.1787 24.0064 57.9568 24.0064C55.7349 24.0064 53.8533 23.2502 52.312 21.7378C50.7707 20.2054 50 18.3348 50 16.1258C50 13.9169 50.7707 12.0562 52.312 10.5437C53.8533 9.01139 55.7349 8.24522 57.9568 8.24522C60.1787 8.24522 62.0603 9.01139 63.6016 10.5437C65.1429 12.0562 65.9136 13.9169 65.9136 16.1258C65.9136 18.3348 65.1429 20.2054 63.6016 21.7378ZM55.4947 18.6631C56.1553 19.3198 56.976 19.6482 57.9568 19.6482C58.9376 19.6482 59.7583 19.3198 60.4189 18.6631C61.0795 18.0064 61.4097 17.1606 61.4097 16.1258C61.4097 15.091 61.0795 14.2452 60.4189 13.5885C59.7583 12.9318 58.9376 12.6034 57.9568 12.6034C56.976 12.6034 56.1553 12.9318 55.4947 13.5885C54.8341 14.2452 54.5038 15.091 54.5038 16.1258C54.5038 17.1606 54.8341 18.0064 55.4947 18.6631Z" fill="#28B2B6" style="fill:#28B2B6;fill:color(display-p3 0.1569 0.6980 0.7137);fill-opacity:1;"/>
                                <path d="M71.4636 11.3198C71.7439 10.3646 72.3043 9.63825 73.1451 9.14074C74.0058 8.62333 74.9466 8.36462 75.9675 8.36462V13.4392C74.8665 13.2601 73.8356 13.4492 72.8748 14.0064C71.934 14.5437 71.4636 15.489 71.4636 16.8422V23.5885H66.9598V8.66313H71.4636V11.3198Z" fill="#28B2B6" style="fill:#28B2B6;fill:color(display-p3 0.1569 0.6980 0.7137);fill-opacity:1;"/>
                                <path d="M80.715 6.57358C80.1946 7.09099 79.5641 7.3497 78.8234 7.3497C78.0828 7.3497 77.4422 7.09099 76.9018 6.57358C76.3813 6.03626 76.1211 5.39945 76.1211 4.66313C76.1211 3.92681 76.3813 3.29995 76.9018 2.78253C77.4422 2.24522 78.0828 1.97656 78.8234 1.97656C79.5641 1.97656 80.1946 2.24522 80.715 2.78253C81.2555 3.29995 81.5257 3.92681 81.5257 4.66313C81.5257 5.39945 81.2555 6.03626 80.715 6.57358ZM76.5715 23.5885V8.66313H81.0753V23.5885H76.5715Z" fill="#28B2B6" style="fill:#28B2B6;fill:color(display-p3 0.1569 0.6980 0.7137);fill-opacity:1;"/>
                                <path d="M93.8892 8.66313H98.273V22.8422C98.273 25.1905 97.5023 26.9616 95.961 28.1557C94.4197 29.3696 92.5481 29.9766 90.3462 29.9766C86.9633 29.9766 84.5913 28.7726 83.2301 26.3646L87.0734 24.1557C87.754 25.4094 88.895 26.0363 90.4963 26.0363C91.5573 26.0363 92.388 25.7577 92.9885 25.2004C93.589 24.6631 93.8892 23.8771 93.8892 22.8422V21.4691C92.8484 22.7626 91.3871 23.4094 89.5055 23.4094C87.4037 23.4094 85.6422 22.6731 84.221 21.2004C82.8198 19.7079 82.1192 17.9169 82.1192 15.8273C82.1192 13.7378 82.8198 11.9567 84.221 10.484C85.6422 8.99149 87.4037 8.24522 89.5055 8.24522C91.3871 8.24522 92.8484 8.89199 93.8892 10.1855V8.66313ZM87.6439 18.3348C88.3245 18.9716 89.1952 19.29 90.2561 19.29C91.317 19.29 92.1878 18.9716 92.8684 18.3348C93.549 17.698 93.8892 16.8621 93.8892 15.8273C93.8892 14.7925 93.549 13.9567 92.8684 13.3198C92.1878 12.683 91.317 12.3646 90.2561 12.3646C89.1952 12.3646 88.3245 12.683 87.6439 13.3198C86.9633 13.9567 86.623 14.7925 86.623 15.8273C86.623 16.8621 86.9633 17.698 87.6439 18.3348Z" fill="#28B2B6" style="fill:#28B2B6;fill:color(display-p3 0.1569 0.6980 0.7137);fill-opacity:1;"/>
                                <path d="M104.219 6.57358C103.699 7.09099 103.068 7.3497 102.328 7.3497C101.587 7.3497 100.947 7.09099 100.406 6.57358C99.8858 6.03626 99.6255 5.39945 99.6255 4.66313C99.6255 3.92681 99.8858 3.29995 100.406 2.78253C100.947 2.24522 101.587 1.97656 102.328 1.97656C103.068 1.97656 103.699 2.24522 104.219 2.78253C104.76 3.29995 105.03 3.92681 105.03 4.66313C105.03 5.39945 104.76 6.03626 104.219 6.57358ZM100.076 23.5885V8.66313H104.58V23.5885H100.076Z" fill="#28B2B6" style="fill:#28B2B6;fill:color(display-p3 0.1569 0.6980 0.7137);fill-opacity:1;"/>
                                <path d="M115.172 8.24522C116.773 8.24522 118.104 8.79248 119.165 9.88701C120.246 10.9815 120.787 12.494 120.787 14.4243V23.5885H116.283V15.081C116.283 14.2054 116.033 13.5388 115.532 13.081C115.052 12.6034 114.431 12.3646 113.67 12.3646C112.81 12.3646 112.129 12.6233 111.629 13.1407C111.128 13.6582 110.878 14.4243 110.878 15.4393V23.5885H106.374V8.66313H110.878V10.0661C111.779 8.85219 113.21 8.24522 115.172 8.24522Z" fill="#28B2B6" style="fill:#28B2B6;fill:color(display-p3 0.1569 0.6980 0.7137);fill-opacity:1;"/>
                                <path d="M133.277 8.66313H137.781V23.5885H133.277V22.1855C132.217 23.3995 130.725 24.0064 128.804 24.0064C126.822 24.0064 125.131 23.2502 123.729 21.7378C122.328 20.2054 121.628 18.3348 121.628 16.1258C121.628 13.9169 122.328 12.0562 123.729 10.5437C125.131 9.01139 126.822 8.24522 128.804 8.24522C130.725 8.24522 132.217 8.85219 133.277 10.0661V8.66313ZM127.122 18.7825C127.783 19.4393 128.644 19.7676 129.704 19.7676C130.765 19.7676 131.626 19.4393 132.287 18.7825C132.947 18.1258 133.277 17.2402 133.277 16.1258C133.277 15.0114 132.947 14.1258 132.287 13.4691C131.626 12.8124 130.765 12.484 129.704 12.484C128.644 12.484 127.783 12.8124 127.122 13.4691C126.462 14.1258 126.131 15.0114 126.131 16.1258C126.131 17.2402 126.462 18.1258 127.122 18.7825Z" fill="#28B2B6" style="fill:#28B2B6;fill:color(display-p3 0.1569 0.6980 0.7137);fill-opacity:1;"/>
                                <path d="M148.382 12.9616H145.289V18.2452C148.382 18.8422 145.529 19.2203 146.01 19.3795C146.49 19.5388 147.281 19.5885 148.382 19.5288V23.5885C145.519 23.887 143.538 23.6184 142.437 22.7825C141.336 21.9268 140.785 20.4144 140.785 18.2452V12.9616H138.383V8.66313H140.785V5.82731L145.289 4.48403V8.66313H148.382V12.9616Z" fill="#28B2B6" style="fill:#28B2B6;fill:color(display-p3 0.1569 0.6980 0.7137);fill-opacity:1;"/>
                                <path d="M153.161 17.9169C153.681 19.3099 154.882 20.0064 156.764 20.0064C157.985 20.0064 158.946 19.6283 159.646 18.8721L163.249 20.9318C161.768 22.9815 159.586 24.0064 156.704 24.0064C154.182 24.0064 152.16 23.2601 150.639 21.7676C149.137 20.2751 148.387 18.3945 148.387 16.1258C148.387 13.8771 149.127 12.0064 150.609 10.5139C152.11 9.00144 154.032 8.24522 156.373 8.24522C158.555 8.24522 160.367 9.00144 161.808 10.5139C163.269 12.0064 164 13.8771 164 16.1258C164 16.7626 163.94 17.3596 163.82 17.9169H153.161ZM153.071 14.5736H159.526C159.086 13.0014 158.025 12.2154 156.343 12.2154C154.602 12.2154 153.511 13.0014 153.071 14.5736Z" fill="#28B2B6" style="fill:#28B2B6;fill:color(display-p3 0.1569 0.6980 0.7137);fill-opacity:1;"/>
                            </svg>
                        </div>
                        <h1 class="text-2xl font-bold text-gray-900">Monitoring Dashboard</h1>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div class="performance-toggle" onclick="togglePerformanceMode()">
                            <i class="fas fa-toggle-off mr-2" id="toggle-icon"></i>
                            <span id="toggle-text">Enable Performance Data</span>
                        </div>
                        <div class="text-sm text-gray-500">
                            <i class="fas fa-calendar mr-1"></i>
                            Last Updated: <span id="last-updated">Nov 15, 2024</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Navigation Tabs -->
        <div class="bg-white border-b">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex space-x-8">
                    <div class="nav-tab active" onclick="switchSection('portfolio', event)">
                        <i class="fas fa-briefcase mr-2"></i>Portfolio Monitoring
                    </div>
                    <div class="nav-tab" onclick="switchSection('model', event)">
                        <i class="fas fa-brain mr-2"></i>Model Monitoring
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            
            <!-- Portfolio Monitoring Section -->
            <div id="portfolio-section" class="section-content active">
                <!-- Day 0 View (Default) -->
                <div id="portfolio-day0" class="portfolio-view">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-3xl font-bold text-gray-900">Portfolio Overview</h2>
                        <div class="flex items-center space-x-4">
                            <div class="flex items-center space-x-2 text-sm">
                                <span class="text-gray-600">Weighting:</span>
                                <button id="day0-mode-aum" class="px-3 py-1 rounded border bg-indigo-600 text-white" onclick="setDay0MetricMode('AUM')">AUM</button>
                                <button id="day0-mode-count" class="px-3 py-1 rounded border bg-white text-gray-700" onclick="setDay0MetricMode('COUNT')">Count</button>
                            </div>
                            <select id="product-filter" class="border rounded-lg px-3 py-2">
                                <option value="all">All Products</option>
                                
                                <option value="mfi">MFI - Individual Loans</option>
                                <option value="msme_unsecured">MSME (Unsecured)</option>
                                <option value="msme_secured">MSME (Secured)</option>
                                <option value="agri">Agri Loans</option>
                                <option value="housing">Affordable Housing</option>
                                <option value="tw">Two Wheelers</option>
    
                            </select>
                            <select class="border rounded-lg px-3 py-2">
                                <option>Last 6 Months</option>
                                <option>Last 12 Months</option>
                                <option>YTD</option>
                            </select>
                        </div>
                    </div>

                    <!-- Product Mix -->
                    <div id="product-mix-card" class="card p-6 mb-8">
                        <h3 class="text-xl font-bold text-gray-900 mb-4">Product Mix & Volume Distribution</h3>
                        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4">
                            
                            <div class="text-center p-4 bg-blue-50 rounded-lg">
                                <h4 class="font-bold text-blue-900 text-sm">MFI Individual</h4>
                                <p class="text-xl font-bold text-blue-600">15%</p>
                                <p class="text-xs text-blue-700">₹42 Cr AUM</p>
                            </div>
                            <div class="text-center p-4 bg-green-50 rounded-lg">
                                <h4 class="font-bold text-green-900 text-sm">MSME Unsecured</h4>
                                <p class="text-xl font-bold text-green-600">20%</p>
                                <p class="text-xs text-green-700">₹56 Cr AUM</p>
                            </div>
                            <div class="text-center p-4 bg-yellow-50 rounded-lg">
                                <h4 class="font-bold text-yellow-900 text-sm">Agri Loans</h4>
                                <p class="text-xl font-bold text-yellow-600">15%</p>
                                <p class="text-xs text-yellow-700">₹42 Cr AUM</p>
                            </div>
                            <div class="text-center p-4 bg-purple-50 rounded-lg">
                                <h4 class="font-bold text-purple-900 text-sm">MSME Secured</h4>
                                <p class="text-xl font-bold text-purple-600">25%</p>
                                <p class="text-xs text-purple-700">₹70 Cr AUM</p>
                            </div>
                            <div class="text-center p-4 bg-red-50 rounded-lg">
                                <h4 class="font-bold text-red-900 text-sm">Housing</h4>
                                <p class="text-xl font-bold text-red-600">20%</p>
                                <p class="text-xs text-red-700">₹56 Cr AUM</p>
                            </div>
                            <div class="text-center p-4 bg-indigo-50 rounded-lg">
                                <h4 class="font-bold text-indigo-900 text-sm">Two Wheelers</h4>
                                <p class="text-xl font-bold text-indigo-600">5%</p>
                                <p class="text-xs text-indigo-700">₹14 Cr AUM</p>
                            </div>
    
                        </div>
                    </div>

                    <!-- Key Metrics -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <div class="metric-card">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-blue-100 text-sm font-medium">Total Applications</p>
                                    <p class="metric-value" id="metric-total-apps">10,900</p>
                                    <p class="text-blue-100 text-sm">↑ 12% from last month</p>
                                </div>
                                <i class="fas fa-file-alt text-3xl opacity-80"></i>
                            </div>
                        </div>
                        <div class="metric-card">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-blue-100 text-sm font-medium">Auto Approved</p>
                                    <p class="metric-value" id="metric-approved-apps">8,720</p>
                                    <p class="text-blue-100 text-sm" id="metric-approval-rate">80.0% approval rate</p>
                                </div>
                                <i class="fas fa-check-circle text-3xl opacity-80"></i>
                            </div>
                        </div>
                        <div class="metric-card">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-blue-100 text-sm font-medium">Approved Amount</p>
                                    <p class="metric-value" id="metric-approved-amount">₹280 Cr</p>
                                    <p class="text-blue-100 text-sm">↑ 22% from last month</p>
                                </div>
                                <i class="fas fa-rupee-sign text-3xl opacity-80"></i>
                            </div>
                        </div>
                        <div class="metric-card">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-blue-100 text-sm font-medium">Avg. Loan Amount</p>
                                    <p class="metric-value" id="metric-avg-loan">₹3.2L</p>
                                    <p class="text-blue-100 text-sm">Stable trend</p>
                                </div>
                                <i class="fas fa-calculator text-3xl opacity-80"></i>
                            </div>
                        </div>
                    </div>

                    <!-- Charts Row: Originations and Decision Trends -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                        <div class="card p-6">
                            <h3 class="text-xl font-bold text-gray-900 mb-4">Monthly Originations</h3>
                            <div id="originations-chart"></div>
                        </div>
                        <div class="card p-6">
                            <h3 class="text-xl font-bold text-gray-900 mb-4">Monthly Decision Trends</h3>
                            <div id="decision-trends-chart"></div>
                        </div>
                    </div>

                    <!-- Detailed Metric Trends -->
                    <div class="card p-6 mb-8">
                        <h3 class="text-xl font-bold text-gray-900 mb-6">Key Metric Distributions (Month-on-Month)</h3>
                        <div class="space-y-8">
                            <!-- KI Score -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                                <div class="p-4 border rounded-lg">
                                    <h4 class="font-semibold text-center text-gray-700 mb-2">KI Score Distribution (Approved)</h4>
                                    <div id="ki-score-dist-approved-chart"></div>
                        </div>
                                <div class="p-4 border rounded-lg">
                                    <h4 class="font-semibold text-center text-gray-700 mb-2">KI Score Distribution (Declined)</h4>
                                    <div id="ki-score-dist-declined-chart"></div>
                        </div>
                    </div>
                            <!-- Bureau Score -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                                <div class="p-4 border rounded-lg">
                                    <h4 class="font-semibold text-center text-gray-700 mb-2">Bureau Score Distribution (Approved)</h4>
                                    <div id="bureau-score-dist-approved-chart"></div>
                            </div>
                                <div class="p-4 border rounded-lg">
                                    <h4 class="font-semibold text-center text-gray-700 mb-2">Bureau Score Distribution (Declined)</h4>
                                    <div id="bureau-score-dist-declined-chart"></div>
                        </div>
                            </div>
                             <!-- Monthly Income -->
                             <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                                <div class="p-4 border rounded-lg">
                                    <h4 class="font-semibold text-center text-gray-700 mb-2">Annual Income Distribution (Approved)</h4>
                                    <div id="income-dist-approved-chart"></div>
                        </div>
                                <div class="p-4 border rounded-lg">
                                    <h4 class="font-semibold text-center text-gray-700 mb-2">Annual Income Distribution (Declined)</h4>
                                    <div id="income-dist-declined-chart"></div>
                                </div>
                            </div>
                             <!-- FOIR -->
                             <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                                <div class="p-4 border rounded-lg">
                                    <h4 class="font-semibold text-center text-gray-700 mb-2">FOIR Distribution (Approved)</h4>
                                    <div id="foir-dist-approved-chart"></div>
                                </div>
                                <div class="p-4 border rounded-lg">
                                    <h4 class="font-semibold text-center text-gray-700 mb-2">FOIR Distribution (Declined)</h4>
                                    <div id="foir-dist-declined-chart"></div>
                                </div>
                            </div>
                             <!-- LTV -->
                             <div id="ltv-distribution-section" class="grid grid-cols-1 md:grid-cols-2 gap-8">
                                <div class="p-4 border rounded-lg">
                                    <h4 class="font-semibold text-center text-gray-700 mb-2">LTV Distribution (Approved)*</h4>
                                    <div id="ltv-dist-approved-chart"></div>
                                </div>
                                <div class="p-4 border rounded-lg">
                                    <h4 class="font-semibold text-center text-gray-700 mb-2">LTV Distribution (Declined)*</h4>
                                    <div id="ltv-dist-declined-chart"></div>
                                </div>
                            </div>
                             <!-- Ticket Size -->
                             <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                                <div class="p-4 border rounded-lg">
                                    <h4 class="font-semibold text-center text-gray-700 mb-2">Loan Ticket Size Distribution (Approved)</h4>
                                    <div id="ticket-size-dist-approved-chart"></div>
                                </div>
                                <div class="p-4 border rounded-lg">
                                    <h4 class="font-semibold text-center text-gray-700 mb-2">Loan Ticket Size Distribution (Declined)</h4>
                                    <div id="ticket-size-dist-declined-chart"></div>
                                </div>
                            </div>
                        </div>
                        <p class="text-xs text-gray-500 mt-4 text-right">*LTV Ratio applicable for secured products only.</p>
                    </div>

                    <!-- Demographic Distributions -->
                    <div class="card p-6 mb-8">
                        <h3 class="text-xl font-bold text-gray-900 mb-6">Demographic Distributions (Month-on-Month)</h3>
                        <div class="space-y-8">
                            <!-- Age -->
                             <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                                <div class="p-4 border rounded-lg">
                                    <h4 class="font-semibold text-center text-gray-700 mb-2">Age Distribution (Approved)</h4>
                                    <div id="age-dist-approved-chart"></div>
                            </div>
                                <div class="p-4 border rounded-lg">
                                    <h4 class="font-semibold text-center text-gray-700 mb-2">Age Distribution (Declined)</h4>
                                    <div id="age-dist-declined-chart"></div>
                            </div>
                            </div>
                            <!-- Education -->
                             <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                                <div class="p-4 border rounded-lg">
                                    <h4 class="font-semibold text-center text-gray-700 mb-2">Education Distribution (Approved)</h4>
                                    <div id="education-dist-approved-chart"></div>
                            </div>
                                <div class="p-4 border rounded-lg">
                                    <h4 class="font-semibold text-center text-gray-700 mb-2">Education Distribution (Declined)</h4>
                                    <div id="education-dist-declined-chart"></div>
                            </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- DealSmart Module -->
                    <div class="card p-6 mb-8">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-xl font-bold text-gray-900">DealSmart Module - Intelligent Decisioning</h3>
                            <div class="flex items-center space-x-4">
                                <div class="text-sm text-gray-500">
                                    <i class="fas fa-lightbulb mr-1"></i>
                                    AI-Powered Deal Optimization
                                </div>
                                <select id="dealsmart-product-filter" class="border rounded-lg px-3 py-2 text-sm">
                                    <option value="all">All Products</option>
                                    <option value="mfi">MFI - Individual Loans</option>
                                    <option value="msme_unsecured">MSME (Unsecured)</option>
                                    <option value="msme_secured">MSME (Secured)</option>
                                    <option value="agri">Agri Loans</option>
                                    <option value="housing">Affordable Housing</option>
                                    <option value="tw">Two Wheelers</option>
                                </select>
                                <select id="dealsmart-time-filter" class="border rounded-lg px-3 py-2 text-sm">
                                    <option>Last 6 Months</option>
                                    <option>Last 12 Months</option>
                                    <option>YTD</option>
                                </select>
                            </div>
                        </div>

                        <!-- Upsell and Counter Offer Metrics -->
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                            <!-- Upsell Offers Card -->
                            <div class="card p-6">
                                <div class="flex items-center mb-4">
                                    <div class="bg-green-100 p-2 rounded-lg mr-3">
                                        <i class="fas fa-arrow-up text-green-600"></i>
                                    </div>
                                    <h4 class="font-semibold text-gray-800">Upsell Offers</h4>
                                </div>
                                <div class="grid grid-cols-3 gap-4">
                                    <div class="text-center">
                                        <p class="text-2xl font-bold text-gray-900">1,250</p>
                                        <p class="text-sm text-gray-600">Total Upsell Offers</p>
                                    </div>
                                    <div class="text-center">
                                        <p class="text-2xl font-bold text-green-600">₹22,500</p>
                                        <p class="text-sm text-gray-600">Average Increase</p>
                                    </div>
                                    <div class="text-center">
                                        <p class="text-2xl font-bold text-green-600">₹2.8 Cr</p>
                                        <p class="text-sm text-gray-600">Incremental Business</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Counter Offers Card -->
                            <div class="card p-6">
                                <div class="flex items-center mb-4">
                                    <div class="bg-green-100 p-2 rounded-lg mr-3">
                                        <i class="fas fa-shield-alt text-green-600"></i>
                                    </div>
                                    <h4 class="font-semibold text-gray-800">Counter Offers</h4>
                                </div>
                                <div class="grid grid-cols-3 gap-4">
                                    <div class="text-center">
                                        <p class="text-2xl font-bold text-gray-900">890</p>
                                        <p class="text-sm text-gray-600">Total Counter Offers</p>
                                    </div>
                                    <div class="text-center">
                                        <p class="text-2xl font-bold text-green-600">₹80,000</p>
                                        <p class="text-sm text-gray-600">Average Loan Amount</p>
                                    </div>
                                    <div class="text-center">
                                        <p class="text-2xl font-bold text-green-600">₹7.1 Cr</p>
                                        <p class="text-sm text-gray-600">Salvaged Business</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- RBP Performance -->
                        <div class="card p-6 mb-6">
                            <h4 class="font-semibold text-gray-800 mb-4">Risk-Based Pricing (RBP) Performance</h4>
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-6">
                                <div>
                                    <h5 class="text-sm font-medium text-gray-700 mb-2">PD (%) by KI Score (1-100)</h5>
                                    <div id="pd-chart" class="h-48"></div>
                                </div>
                                <div>
                                    <h5 class="text-sm font-medium text-gray-700 mb-2">LGD (%) by Recovery Rate</h5>
                                    <div id="lgd-chart" class="h-48"></div>
                                </div>
                            </div>
                            <div class="bg-gray-50 p-3 rounded-lg mb-4">
                                <p class="text-sm font-medium text-gray-800">RBP = (PD × LGD) + Hurdle Rate + Margin</p>
                                <p class="text-xs text-gray-600">RBP = Estimated Loss (EL) + Cost of Funds + Required Margin</p>
                            </div>
                            <div>
                                <h5 class="text-sm font-medium text-gray-700 mb-2">Interest Rate Distribution</h5>
                                <div id="rbp-distribution-chart"></div>
                            </div>
                        </div>

                        <!-- Impact Metrics -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="card p-6">
                                <h4 class="font-semibold text-gray-800 mb-2">Conversion Lift</h4>
                                <p class="text-sm text-gray-600 mb-3">Estimated increase in offer acceptance from low-risk customers.</p>
                                <p class="text-3xl font-bold text-green-600">+8%</p>
                            </div>
                            <div class="card p-6">
                                <h4 class="font-semibold text-gray-800 mb-2">Margin Improvement</h4>
                                <p class="text-sm text-gray-600 mb-3">Projected NIM gain from accurately pricing risk across the portfolio.</p>
                                <p class="text-3xl font-bold text-green-600">+0.5%</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Performance Data View (Hidden by default) -->
                <div id="portfolio-performance" class="portfolio-view" style="display: none;">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-3xl font-bold text-gray-900">Portfolio Performance Analysis</h2>
                        <div class="flex items-center space-x-2 text-sm">
                            <span class="text-gray-600">Weighting:</span>
                            <button id="mode-aum" class="px-3 py-1 rounded border bg-indigo-600 text-white" onclick="setMetricMode('AUM')">AUM</button>
                            <button id="mode-count" class="px-3 py-1 rounded border bg-white text-gray-700" onclick="setMetricMode('COUNT')">Count</button>
                        </div>
                    </div>

                    <!-- Risk Summary (only risk charts) -->
                    <div class="card p-6 mb-8">
                        <h3 class="text-xl font-bold text-gray-900 mb-4">Risk Summary</h3>
                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                                <div>
                                <h4 class="font-semibold text-gray-800 mb-4 text-center">Risk by Program</h4>
                                <div id="risk-by-program-chart"></div>
                                </div>
                            <div>
                                <h4 class="font-semibold text-gray-800 mb-4 text-center">Risk by Originator</h4>
                                <div id="risk-by-originator-chart"></div>
                            </div>
                            <div>
                                <h4 class="font-semibold text-gray-800 mb-4 text-center">Risk by State</h4>
                                <div id="risk-by-state-chart"></div>
                        </div>
                                <div>
                                <h4 class="font-semibold text-gray-800 mb-4 text-center">Risk by Tenure</h4>
                                <div id="risk-by-tenure-chart"></div>
                                </div>
                            <div>
                                <h4 class="font-semibold text-gray-800 mb-4 text-center">Risk by Ticket Size</h4>
                                <div id="risk-by-ticket-size-chart"></div>
                            </div>
                                <div>
                                <h4 class="font-semibold text-gray-800 mb-4 text-center">Risk by Interest Rate</h4>
                                <div id="risk-by-interest-chart"></div>
                                </div>
                            </div>
                        </div>

                    <!-- Metrics Over Time -->
                    <div class="card p-6 mb-8">
                         <h3 class="text-xl font-bold text-gray-900 mb-4">Risk over Time</h3>
                         <div id="risk-metrics-over-time-chart"></div>
                         <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mt-8">
                                <div>
                                 <h4 class="font-semibold text-gray-800 mb-2">PAR 30 over Time</h4>
                                 <div id="par30-over-time-chart"></div>
                                </div>
                             <div>
                                 <h4 class="font-semibold text-gray-800 mb-2">PAR 60 over Time</h4>
                                 <div id="par60-over-time-chart"></div>
                            </div>
                             <div>
                                 <h4 class="font-semibold text-gray-800 mb-2">PAR 90 over Time</h4>
                                 <div id="par90-over-time-chart"></div>
                        </div>
                    </div>
                        </div>

                    <!-- Vintage Analysis -->
                    <div class="card p-6 mb-8">
                         <h3 class="text-xl font-bold text-gray-900 mb-4">Vintage Analysis (90+ DPD Rate %)</h3>
                            <div id="vintage-chart"></div>
                    </div>

                    <!-- Roll Rate Analysis -->
                    <div class="card p-6 mb-8">
                         <h3 class="text-xl font-bold text-gray-900 mb-4">Roll Rate Analysis (Oct'24 to Nov'24)</h3>
                        <div class="data-table">
                             <table class="roll-rate-table">
                                <thead>
                                    <tr>
                                        <th class="bg-gray-100">From (Oct)</th>
                                        <th class="bg-blue-100">Current</th>
                                        <th class="bg-yellow-100">DPD 1-30</th>
                                        <th class="bg-orange-100">DPD 31-60</th>
                                        <th class="bg-red-100">DPD 61-90</th>
                                        <th class="bg-red-200">DPD 90+</th>
                                    </tr>
                                </thead>
                                                                    <tbody>
                                        <tr>
                                        <td class="bg-gray-100">Current</td>
                                        <td class="bg-green-100">97.2%</td>
                                        <td>2.5%</td>
                                        <td>0.2%</td>
                                        <td>0.1%</td>
                                        <td>0.0%</td>
                                        </tr>
                                        <tr>
                                        <td class="bg-gray-100">DPD 1-30</td>
                                        <td>45.5%</td>
                                        <td class="bg-yellow-200">40.1%</td>
                                        <td>14.0%</td>
                                        <td>0.3%</td>
                                        <td>0.1%</td>
                                        </tr>
                                        <tr>
                                        <td class="bg-gray-100">DPD 31-60</td>
                                        <td>25.2%</td>
                                        <td>15.8%</td>
                                        <td class="bg-orange-200">42.5%</td>
                                        <td>16.1%</td>
                                        <td>0.4%</td>
                                        </tr>
                                        <tr>
                                        <td class="bg-gray-100">DPD 61-90</td>
                                        <td>15.0%</td>
                                        <td>10.1%</td>
                                        <td>14.9%</td>
                                        <td class="bg-red-300">45.5%</td>
                                        <td>14.5%</td>
                                        </tr>
                                    </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Model Monitoring Section -->
            <div id="model-section" class="section-content">
                <!-- Day 0 View (Default) -->
                <div id="model-day0" class="model-view">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-3xl font-bold text-gray-900">Model Health Dashboard</h2>
                        <button class="btn-primary" onclick="showPerformanceSetup()">
                            <i class="fas fa-cog mr-2"></i>Setup Performance Data
                        </button>
                    </div>

                    <!-- PSI and CSI Tables -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                        <div class="card p-6">
                            <h3 class="text-xl font-bold text-gray-900 mb-4">
                                Population Stability Index (PSI)
                                <span class="text-sm font-normal text-gray-500 ml-2">- Model Score Distribution Shift</span>
                            </h3>
                            <div class="data-table">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>KI Score Range</th>
                                            <th>Reference %</th>
                                            <th>Current %</th>
                                            <th>PSI Component</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>1-10 (Best)</td>
                                            <td>8.2%</td>
                                            <td>7.8%</td>
                                            <td class="text-green-600">0.002</td>
                                        </tr>
                                        <tr>
                                            <td>11-20</td>
                                            <td>12.5%</td>
                                            <td>13.1%</td>
                                            <td class="text-green-600">0.003</td>
                                        </tr>
                                        <tr>
                                            <td>21-30</td>
                                            <td>18.3%</td>
                                            <td>17.9%</td>
                                            <td class="text-green-600">0.001</td>
                                        </tr>
                                        <tr>
                                            <td>31-40</td>
                                            <td>22.1%</td>
                                            <td>22.8%</td>
                                            <td class="text-green-600">0.002</td>
                                        </tr>
                                        <tr>
                                            <td>41-50</td>
                                            <td>15.4%</td>
                                            <td>15.1%</td>
                                            <td class="text-green-600">0.001</td>
                                        </tr>
                                        <tr>
                                            <td>51-60</td>
                                            <td>12.8%</td>
                                            <td>12.5%</td>
                                            <td class="text-green-600">0.001</td>
                                        </tr>
                                        <tr>
                                            <td>61-70</td>
                                            <td>7.2%</td>
                                            <td>7.5%</td>
                                            <td class="text-green-600">0.001</td>
                                        </tr>
                                        <tr>
                                            <td>71-80</td>
                                            <td>2.8%</td>
                                            <td>2.6%</td>
                                            <td class="text-green-600">0.001</td>
                                        </tr>
                                        <tr>
                                            <td>81-90</td>
                                            <td>0.6%</td>
                                            <td>0.6%</td>
                                            <td class="text-green-600">0.000</td>
                                        </tr>
                                        <tr>
                                            <td>91-100 (Worst)</td>
                                            <td>0.1%</td>
                                            <td>0.1%</td>
                                            <td class="text-green-600">0.000</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="mt-4 p-3 bg-green-50 rounded-lg">
                                <p class="text-sm text-green-700">
                                    <strong>Overall PSI: 0.012</strong> - KI Score distribution is stable
                                </p>
                            </div>
                        </div>

                        <div class="card p-6">
                            <h3 class="text-xl font-bold text-gray-900 mb-4">
                                Characteristic Stability Index (CSI)
                                <span class="text-sm font-normal text-gray-500 ml-2">- Input Feature Drift Detection</span>
                            </h3>
                            <div class="data-table">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Feature</th>
                                            <th>CSI Score</th>
                                            <th>Status</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        
                                        <tr>
                                            <td>Number of dependents</td>
                                            <td>0.07</td>
                                            <td><span class="px-2 py-1 bg-green-100 text-green-800 rounded text-xs">Stable</span></td>
                                        </tr>
                                        <tr>
                                            <td>Land Holding</td>
                                            <td>0.05</td>
                                            <td><span class="px-2 py-1 bg-green-100 text-green-800 rounded text-xs">Stable</span></td>
                                        </tr>
                                        <tr>
                                            <td># enquiries in last 180 days</td>
                                            <td>0.14</td>
                                            <td><span class="px-2 py-1 bg-yellow-100 text-yellow-800 rounded text-xs">Monitor</span></td>
                                        </tr>
                                        <tr>
                                            <td>Sum of outstanding balance (MFI)</td>
                                            <td>0.08</td>
                                            <td><span class="px-2 py-1 bg-green-100 text-green-800 rounded text-xs">Stable</span></td>
                                        </tr>
                                        <tr>
                                            <td>Age of the customer</td>
                                            <td>0.06</td>
                                            <td><span class="px-2 py-1 bg-green-100 text-green-800 rounded text-xs">Stable</span></td>
                                        </tr>
                                        <tr>
                                            <td># times 90 DPD in last 360 days</td>
                                            <td>0.09</td>
                                            <td><span class="px-2 py-1 bg-green-100 text-green-800 rounded text-xs">Stable</span></td>
                                        </tr>
                                        <tr>
                                            <td>Days since last closed loan</td>
                                            <td>0.07</td>
                                            <td><span class="px-2 py-1 bg-green-100 text-green-800 rounded text-xs">Stable</span></td>
                                        </tr>
    
                                    </tbody>
                                </table>
                            </div>
                            <div class="mt-4 p-3 bg-gray-50 rounded-lg">
                                <p class="text-sm text-gray-600">
                                    <strong>CSI Thresholds:</strong> 
                                    <span class="text-green-600">≤0.10 Stable</span> | 
                                    <span class="text-yellow-600">0.10-0.20 Monitor</span> | 
                                    <span class="text-red-600">>0.20 Alert</span>
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Alerts Section -->
                    <div class="card p-6 mb-8">
                        <h3 class="text-xl font-bold text-gray-900 mb-4">Internal Alerts</h3>
                        <div class="space-y-4">
                             <div class="warning-card p-4 rounded-lg">
                                <div class="flex items-start space-x-3">
                                    <i class="fas fa-info-circle text-yellow-500 text-xl mt-1"></i>
                                    <div class="flex-1">
                                        <h4 class="font-bold text-yellow-800">New-to-Credit (NTC) Population Increasing</h4>
                                        <p class="text-yellow-700 text-sm">NTC applications increased from a 6-week average of 20% to 30% this week. This may impact portfolio risk.</p>
                                        <p class="text-yellow-600 text-xs mt-1">Detected: Nov 14, 2024 | Severity: Low</p>
                                    </div>
                                </div>
                            </div>
                            <div class="warning-card p-4 rounded-lg">
                                <div class="flex items-start space-x-3">
                                    <i class="fas fa-info-circle text-yellow-500 text-xl mt-1"></i>
                                    <div class="flex-1">
                                        <h4 class="font-bold text-yellow-800">Bureau Score Distribution Shift</h4>
                                        <p class="text-yellow-700 text-sm">The proportion of applicants with bureau scores below 700 has increased by 8% this week compared to the monthly average.</p>
                                        <p class="text-yellow-600 text-xs mt-1">Detected: Nov 12, 2024 | Severity: Medium</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Model Performance View (Hidden by default) -->
                <div id="model-performance" class="model-view" style="display: none;">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-3xl font-bold text-gray-900">Model Performance Analysis</h2>
                    </div>

                    <!-- Model Performance Metrics -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                        <div class="card p-6 border-l-4 border-green-500">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-600 text-sm font-medium">Live Gini</p>
                                    <p class="text-3xl font-bold text-gray-900">0.74</p>
                                    <p class="text-green-600 text-sm">vs 0.78 dev</p>
                                </div>
                                <i class="fas fa-chart-line text-3xl text-green-500"></i>
                            </div>
                        </div>
                        <div class="card p-6 border-l-4 border-blue-500">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-600 text-sm font-medium">KS Statistic</p>
                                    <p class="text-3xl font-bold text-gray-900">0.45</p>
                                    <p class="text-blue-600 text-sm">Strong separation</p>
                                </div>
                                <i class="fas fa-divide text-3xl text-blue-500"></i>
                            </div>
                        </div>
                        <div class="card p-6 border-l-4 border-purple-500">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-600 text-sm font-medium">Live AUC</p>
                                    <p class="text-3xl font-bold text-gray-900">0.82</p>
                                    <p class="text-purple-600 text-sm">Area Under Curve</p>
                                </div>
                                <i class="fas fa-vector-square text-3xl text-purple-500"></i>
                            </div>
                        </div>
                    </div>

                    <!-- Performance Charts -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                        <div class="card p-6">
                            <h3 class="text-xl font-bold text-gray-900 mb-4">ROC Curve Comparison</h3>
                            <div id="roc-chart"></div>
                        </div>
                        <div class="card p-6">
                             <h3 class="text-xl font-bold text-gray-900 mb-4">Default Captured by Decile (Lift)</h3>
                             <div id="gain-lift-chart"></div>
                        </div>
                    </div>

                    <!-- Gini / KS Table -->
                    <div class="card p-6 mb-8">
                        <h3 class="text-xl font-bold text-gray-900 mb-4">Gini & KS Performance Details</h3>
                        <div class="data-table">
                            <h4 class="font-semibold text-gray-700 text-md mb-2">Monitoring Sample (Gini: 53)</h4>
                             <table>
                                <thead>
                                    <tr><th>KI Score Band</th><th>% Population</th><th>Observed PD</th><th>Cumulative Bad% (A)</th><th>Cumulative Good% (B)</th><th>KS (A-B)</th></tr>
                                </thead>
                                <tbody>
                                    <tr><td>1-20 (Low Risk)</td><td>20%</td><td>0.3%</td><td>10.1%</td><td>20.5%</td><td>-10.4</td></tr>
                                    <tr><td>21-40</td><td>20%</td><td>1.1%</td><td>28.5%</td><td>40.1%</td><td>-11.6</td></tr>
                                    <tr><td>41-60</td><td>20%</td><td>2.8%</td><td>55.5%</td><td>59.8%</td><td>-4.3</td></tr>
                                    <tr><td>61-80</td><td>20%</td><td>4.3%</td><td>81.7%</td><td>79.2%</td><td class="font-bold">2.5</td></tr>
                                    <tr><td>81-100 (High Risk)</td><td>20%</td><td>9.1%</td><td>100%</td><td>100%</td><td>0.0</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Performance Setup Modal -->
    <div id="performance-setup-modal" class="modal">
        <div class="modal-content">
             <div class="flex justify-between items-center mb-4">
                <h3 class="text-2xl font-bold text-gray-900">Setup Performance Data</h3>
                <button onclick="closePerformanceSetup()" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <!-- Stepper -->
            <div class="stepper">
                <div id="step-indicator-1" class="step active">
                    <div class="step-line"></div>
                    <div class="step-circle">1</div>
                    <div class="step-label">Upload Data</div>
                        </div>
                <div id="step-indicator-2" class="step">
                    <div class="step-line"></div>
                    <div class="step-circle">2</div>
                    <div class="step-label">Map Columns</div>
                        </div>
                <div id="step-indicator-3" class="step">
                    <div class="step-line"></div>
                    <div class="step-circle">3</div>
                    <div class="step-label">Validate</div>
                </div>
                 <div id="step-indicator-4" class="step">
                    <div class="step-circle">4</div>
                    <div class="step-label">Finish</div>
                    </div>
                </div>

            <!-- Step 1: Upload -->
            <div id="step-1" class="modal-step" style="display: block;">
                <h4 class="font-bold text-lg text-gray-800 mb-3">Upload Performance File</h4>
                <p class="text-sm text-gray-600 mb-4">Please upload a CSV or Excel file containing performance data. Download our sample file to see the required format.</p>
                <div class="flex justify-center space-x-4 mb-6">
                    <button onclick="downloadSampleCSV()" class="btn-secondary"><i class="fas fa-download mr-2"></i>Download Sample CSV</button>
                        </div>
                <div class="upload-box" onclick="document.getElementById('file-upload-input').click()">
                     <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-3"></i>
                     <p class="font-semibold text-gray-700">Click to browse or drag & drop your file</p>
                     <p class="text-xs text-gray-500">Max file size: 10MB</p>
                     <input type="file" id="file-upload-input" class="hidden" onchange="handleFileSelect(event)">
                        </div>
                <p id="file-name-display" class="text-center mt-3 text-sm text-gray-600"></p>
                <div class="flex justify-end mt-6">
                    <button id="step-1-next" onclick="nextStep()" class="btn-primary" disabled>Next <i class="fas fa-arrow-right ml-2"></i></button>
                        </div>
                        </div>

            <!-- Step 2: Map Columns -->
            <div id="step-2" class="modal-step">
                 <h4 class="font-bold text-lg text-gray-800 mb-3">Map Your Columns</h4>
                 <p class="text-sm text-gray-600 mb-4">Match the required data fields to the columns from your uploaded file. This ensures we process your data correctly.</p>
                 <div class="space-y-3">
                    <div class="grid grid-cols-3 items-center gap-4 p-2 bg-gray-50 rounded">
                        <label class="font-semibold text-gray-700 text-sm">Required Field</label>
                        <span class="col-span-2 font-semibold text-gray-700 text-sm">Your File's Column</span>
                    </div>
                     <!-- Mandatory Fields -->
                     <div class="grid grid-cols-3 items-center gap-4 p-2 border-b"><label class="text-sm">Loan ID <span class="text-red-500">*</span></label><i class="fas fa-arrows-alt-h text-gray-400 text-center"></i><select class="w-full border rounded-lg px-3 py-1 text-sm"><option>loan_reference_num</option><option>application_id</option><option>customer_id</option></select></div>
                     <div class="grid grid-cols-3 items-center gap-4 p-2 border-b"><label class="text-sm">Application ID <span class="text-red-500">*</span></label><i class="fas fa-arrows-alt-h text-gray-400 text-center"></i><select class="w-full border rounded-lg px-3 py-1 text-sm"><option>application_id</option><option>loan_reference_num</option><option>customer_id</option></select></div>
                     <div class="grid grid-cols-3 items-center gap-4 p-2 border-b"><label class="text-sm">DPD as of Reporting Date <span class="text-red-500">*</span></label><i class="fas fa-arrows-alt-h text-gray-400 text-center"></i><select class="w-full border rounded-lg px-3 py-1 text-sm"><option>dpd_days</option><option>days_overdue</option><option>late_by_days</option></select></div>
                     <div class="grid grid-cols-3 items-center gap-4 p-2 border-b"><label class="text-sm">Current Balance <span class="text-red-500">*</span></label><i class="fas fa-arrows-alt-h text-gray-400 text-center"></i><select class="w-full border rounded-lg px-3 py-1 text-sm"><option>outstanding_principal</option><option>current_bal</option><option>balance_amt</option></select></div>
                     <div class="grid grid-cols-3 items-center gap-4 p-2 border-b"><label class="text-sm">Loan Disbursed Amount <span class="text-red-500">*</span></label><i class="fas fa-arrows-alt-h text-gray-400 text-center"></i><select class="w-full border rounded-lg px-3 py-1 text-sm"><option>disbursed_amt</option><option>loan_amount</option></select></div>
                     <!-- Optional Fields -->
                     <div class="grid grid-cols-3 items-center gap-4 p-2 border-b"><label class="text-sm">Total Overdue Amount</label><i class="fas fa-arrows-alt-h text-gray-400 text-center"></i><select class="w-full border rounded-lg px-3 py-1 text-sm"><option>-- Do not map --</option><option>overdue_amt</option></select></div>
                     <div class="grid grid-cols-3 items-center gap-4 p-2 border-b"><label class="text-sm">Loan Disbursed Date</label><i class="fas fa-arrows-alt-h text-gray-400 text-center"></i><select class="w-full border rounded-lg px-3 py-1 text-sm"><option>-- Do not map --</option><option>disbursement_date</option></select></div>
                     <div class="grid grid-cols-3 items-center gap-4 p-2 border-b"><label class="text-sm">Interest Rate</label><i class="fas fa-arrows-alt-h text-gray-400 text-center"></i><select class="w-full border rounded-lg px-3 py-1 text-sm"><option>-- Do not map --</option><option>interest_rate_pa</option></select></div>
                     <div class="grid grid-cols-3 items-center gap-4 p-2 border-b"><label class="text-sm">Loan Written Off</label><i class="fas fa-arrows-alt-h text-gray-400 text-center"></i><select class="w-full border rounded-lg px-3 py-1 text-sm"><option>-- Do not map --</option><option>is_written_off</option></select></div>
                     <div class="grid grid-cols-3 items-center gap-4 p-2 border-b"><label class="text-sm">Repossession</label><i class="fas fa-arrows-alt-h text-gray-400 text-center"></i><select class="w-full border rounded-lg px-3 py-1 text-sm"><option>-- Do not map --</option><option>is_repossessed</option></select></div>
                     <div class="grid grid-cols-3 items-center gap-4 p-2"><label class="text-sm">Recovery after writeoff</label><i class="fas fa-arrows-alt-h text-gray-400 text-center"></i><select class="w-full border rounded-lg px-3 py-1 text-sm"><option>-- Do not map --</option><option>recovery_amt</option></select></div>
                 </div>
                 <div class="flex justify-between mt-6">
                    <button onclick="prevStep()" class="btn-secondary"><i class="fas fa-arrow-left mr-2"></i>Back</button>
                    <button onclick="nextStep()" class="btn-primary">Next <i class="fas fa-arrow-right ml-2"></i></button>
                    </div>
                </div>

            <!-- Step 3: Validate -->
             <div id="step-3" class="modal-step">
                 <h4 class="font-bold text-lg text-gray-800 mb-3">Validate Data</h4>
                 <p class="text-sm text-gray-600 mb-4">We will run a few checks on your data to ensure it's in the correct format and ready for processing.</p>
                 <div id="validation-result" class="hidden p-4 rounded-lg text-center my-4"></div>
                 <div class="text-center">
                    <button id="validate-btn" onclick="validateData()" class="btn-primary"><i class="fas fa-check-circle mr-2"></i>Validate Data</button>
                        </div>
                 <div class="flex justify-between mt-6">
                    <button onclick="prevStep()" class="btn-secondary"><i class="fas fa-arrow-left mr-2"></i>Back</button>
                    <button id="step-3-next" onclick="nextStep()" class="btn-primary" disabled>Next <i class="fas fa-arrow-right ml-2"></i></button>
                    </div>
                </div>

            <!-- Step 4: Finish -->
             <div id="step-4" class="modal-step">
                <div class="text-center p-6">
                    <i class="fas fa-check-circle fa-3x text-green-500 mb-4"></i>
                     <h4 class="font-bold text-2xl text-gray-800 mb-3">Configuration Complete!</h4>
                     <p class="text-gray-600 mb-6">Your performance data mapping has been saved. You can now enable performance data view on your dashboard.</p>
                     <button onclick="savePerformanceSetup()" class="btn-primary">Finish Setup</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let performanceDataEnabled = false;
        let charts = {};
        let productData = {};
        let modalCurrentStep = 1;

        // Section switching
        function switchSection(section, event) {
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            event.target.closest('.nav-tab').classList.add('active');
            document.querySelectorAll('.section-content').forEach(content => content.classList.remove('active'));
            document.getElementById(`${section}-section`).classList.add('active');
        }

        // Performance mode toggle
        function togglePerformanceMode() {
            performanceDataEnabled = !performanceDataEnabled;
            const toggleIcon = document.getElementById('toggle-icon');
            const toggleText = document.getElementById('toggle-text');
            
            if (performanceDataEnabled) {
                toggleIcon.className = 'fas fa-toggle-on mr-2';
                toggleText.textContent = 'Performance Data Active';
                document.getElementById('portfolio-day0').style.display = 'none';
                document.getElementById('portfolio-performance').style.display = 'block';
                document.getElementById('model-day0').style.display = 'none';
                document.getElementById('model-performance').style.display = 'block';
                setTimeout(initPerformanceCharts, 10); 
            } else {
                toggleIcon.className = 'fas fa-toggle-off mr-2';
                toggleText.textContent = 'Enable Performance Data';
                document.getElementById('portfolio-day0').style.display = 'block';
                document.getElementById('portfolio-performance').style.display = 'none';
                document.getElementById('model-day0').style.display = 'block';
                document.getElementById('model-performance').style.display = 'none';
            }
        }

        // --- Performance setup modal workflow ---
        function showPerformanceSetup() {
            modalCurrentStep = 1;
            showStep(modalCurrentStep);
            document.getElementById('performance-setup-modal').classList.add('show');
        }

        function closePerformanceSetup() {
            document.getElementById('performance-setup-modal').classList.remove('show');
        }
        
        function nextStep() {
            if (modalCurrentStep < 4) {
                modalCurrentStep++;
                showStep(modalCurrentStep);
            }
        }

        function prevStep() {
            if (modalCurrentStep > 1) {
                modalCurrentStep--;
                showStep(modalCurrentStep);
            }
        }

        function showStep(stepNum) {
            document.querySelectorAll('.modal-step').forEach(step => step.style.display = 'none');
            document.getElementById(`step-${stepNum}`).style.display = 'block';

            document.querySelectorAll('.step').forEach((step, index) => {
                const stepIndicator = step;
                stepIndicator.classList.remove('active', 'completed');
                if (index + 1 < stepNum) {
                    stepIndicator.classList.add('completed');
                } else if (index + 1 === stepNum) {
                    stepIndicator.classList.add('active');
                }
            });
        }
        
        function downloadSampleCSV() {
            const header = "Loan ID,Application ID,DPD as of Reporting Date,Current Balance,Loan Disbursed Amount,Total Overdue Amount,Loan Disbursed Date,Interest Rate,Loan Written Off,Repossession,Recovery after writeoff\n";
            const row1 = "LN001,APP001,0,50000,50000,0,2024-10-01,12.5,No,No,0\n";
            const row2 = "LN002,APP002,32,75000,80000,5000,2024-09-15,14.0,No,No,0\n";
            const row3 = "LN003,APP003,15,45000,50000,2500,2024-09-20,13.2,No,No,0\n";
            const csvContent = "data:text/csv;charset=utf-8," + header + row1 + row2 + row3;
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "performance_data_sample.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function handleFileSelect(event) {
            const file = event.target.files[0];
            if(file) {
                document.getElementById('file-name-display').textContent = `File selected: ${file.name}`;
                document.getElementById('step-1-next').disabled = false;
            }
        }

        function validateData() {
            const btn = document.getElementById('validate-btn');
            const resultDiv = document.getElementById('validation-result');
            btn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Validating...';
            btn.disabled = true;
            resultDiv.classList.remove('hidden', 'bg-green-100', 'text-green-800', 'bg-red-100', 'text-red-800');

            setTimeout(() => {
                resultDiv.innerHTML = '<i class="fas fa-check-circle mr-2"></i>Validation Successful! All mandatory columns mapped and formats are correct.';
                resultDiv.classList.add('bg-green-100', 'text-green-800');
                resultDiv.classList.remove('hidden');
                btn.innerHTML = '<i class="fas fa-check-circle mr-2"></i>Validation Complete';
                document.getElementById('step-3-next').disabled = false;
            }, 2000);
        }

        function savePerformanceSetup() {
            alert('Performance data configuration saved successfully!');
            closePerformanceSetup();
            // Automatically enable performance data mode
            if (!performanceDataEnabled) {
                togglePerformanceMode();
            }
        }
        
        // Chart creation functions
        function createStackedBarChart(elementId, categories, seriesData, colors) {
             const options = {
                series: seriesData,
                chart: { type: 'bar', height: 220, stacked: true, stackType: '100%', toolbar: { show: false } },
                plotOptions: { bar: { horizontal: false } },
                xaxis: { categories: categories },
                yaxis: { labels: { formatter: (val) => val.toFixed(0) + '%' } },
                legend: { position: 'top', horizontalAlign: 'left', offsetX: 10 },
                fill: { opacity: 1 },
                colors: colors
             };
             if(document.querySelector(`#${elementId}`)){
                const chart = new ApexCharts(document.querySelector(`#${elementId}`), options);
                chart.render();
                return chart;
             }
             return null;
        }

        // Initialize charts
        function initCharts() {
            const months = ['May 24', 'Jun 24', 'Jul 24', 'Aug 24', 'Sep 24', 'Oct 24'];
            
            // Sample data for demonstration
            const sampleData = {
                originations: [
                    { name: 'Applications', data: [1500, 1600, 1700, 1900, 2000, 2200] },
                    { name: 'Approved', data: [1200, 1280, 1360, 1520, 1600, 1760] }
                ],
                decisionTrends: [
                    { name: 'Approved', data: [80, 80, 80, 80, 80, 80] },
                    { name: 'Rejected', data: [20, 20, 20, 20, 20, 20] }
                ]
            };
            
            // Originations Chart
            charts.originations = new ApexCharts(document.querySelector("#originations-chart"), {
                chart: { type: 'bar', height: 300, toolbar: { show: false } },
                plotOptions: { bar: { horizontal: false, columnWidth: '55%' } },
                dataLabels: { enabled: false },
                xaxis: { categories: months },
                colors: ['#4f46e5', '#06b6d4'],
                series: sampleData.originations
            });
            charts.originations.render();

            // Decision Trends Chart
            charts.decisionTrends = new ApexCharts(document.querySelector("#decision-trends-chart"), {
                chart: { type: 'area', height: 300, toolbar: { show: false }, stacked: true },
                dataLabels: { enabled: false },
                stroke: { curve: 'smooth', width: 2 },
                xaxis: { categories: months },
                yaxis: { title: { text: 'Percentage %' } },
                colors: ['#10b981', '#ef4444'],
                series: sampleData.decisionTrends,
                fill: { opacity: 0.7 }
            });
            charts.decisionTrends.render();

            // Distribution Charts
            const distChartColors = ['#2563eb', '#3b82f6', '#60a5fa', '#93c5fd'];
            const riskChartColors = ['#f97316', '#fb923c', '#fdba74', '#fed7aa'];
            
            // Sample distribution data
            const sampleDistribution = [
                { name: 'Best', data: [60, 62, 65, 64, 66, 68] },
                { name: 'Good', data: [30, 28, 26, 27, 25, 24] },
                { name: 'Fair', data: [8, 8, 7, 7, 7, 6] },
                { name: 'Poor', data: [2, 2, 2, 2, 2, 2] }
            ];

            charts.kiScoreApproved = createStackedBarChart('ki-score-dist-approved-chart', months, sampleDistribution, distChartColors);
            charts.kiScoreDeclined = createStackedBarChart('ki-score-dist-declined-chart', months, sampleDistribution, riskChartColors);
            charts.bureauScoreApproved = createStackedBarChart('bureau-score-dist-approved-chart', months, sampleDistribution, distChartColors);
            charts.bureauScoreDeclined = createStackedBarChart('bureau-score-dist-declined-chart', months, sampleDistribution, riskChartColors);
            charts.incomeApproved = createStackedBarChart('income-dist-approved-chart', months, sampleDistribution, distChartColors);
            charts.incomeDeclined = createStackedBarChart('income-dist-declined-chart', months, sampleDistribution, riskChartColors);
            charts.foirApproved = createStackedBarChart('foir-dist-approved-chart', months, sampleDistribution, distChartColors);
            charts.foirDeclined = createStackedBarChart('foir-dist-declined-chart', months, sampleDistribution, riskChartColors);
            charts.ltvApproved = createStackedBarChart('ltv-dist-approved-chart', months, sampleDistribution, distChartColors);
            charts.ltvDeclined = createStackedBarChart('ltv-dist-declined-chart', months, sampleDistribution, riskChartColors);
            charts.ticketSizeApproved = createStackedBarChart('ticket-size-dist-approved-chart', months, sampleDistribution, distChartColors);
            charts.ticketSizeDeclined = createStackedBarChart('ticket-size-dist-declined-chart', months, sampleDistribution, riskChartColors);
            charts.ageApproved = createStackedBarChart('age-dist-approved-chart', months, sampleDistribution, distChartColors);
            charts.ageDeclined = createStackedBarChart('age-dist-declined-chart', months, sampleDistribution, riskChartColors);
            charts.educationApproved = createStackedBarChart('education-dist-approved-chart', months, sampleDistribution, distChartColors);
            charts.educationDeclined = createStackedBarChart('education-dist-declined-chart', months, sampleDistribution, riskChartColors);
        }

        // Metric mode toggle function
        let currentMetricMode = 'AUM';
        
        function setMetricMode(mode) {
            currentMetricMode = mode;
            document.getElementById('mode-aum').classList.toggle('bg-indigo-600', mode === 'AUM');
            document.getElementById('mode-aum').classList.toggle('text-white', mode === 'AUM');
            document.getElementById('mode-aum').classList.toggle('bg-white', mode !== 'AUM');
            document.getElementById('mode-aum').classList.toggle('text-gray-700', mode !== 'AUM');
            
            document.getElementById('mode-count').classList.toggle('bg-indigo-600', mode === 'COUNT');
            document.getElementById('mode-count').classList.toggle('text-white', mode === 'COUNT');
            document.getElementById('mode-count').classList.toggle('bg-white', mode !== 'COUNT');
            document.getElementById('mode-count').classList.toggle('text-gray-700', mode !== 'COUNT');
            
            // Update all risk charts with new data based on mode
            updateRiskCharts();
        }
        
        // Day 0 metric mode toggle function
        let currentDay0MetricMode = 'AUM';
        
        function setDay0MetricMode(mode) {
            currentDay0MetricMode = mode;
            document.getElementById('day0-mode-aum').classList.toggle('bg-indigo-600', mode === 'AUM');
            document.getElementById('day0-mode-aum').classList.toggle('text-white', mode === 'AUM');
            document.getElementById('day0-mode-aum').classList.toggle('bg-white', mode !== 'AUM');
            document.getElementById('day0-mode-aum').classList.toggle('text-gray-700', mode !== 'AUM');
            
            document.getElementById('day0-mode-count').classList.toggle('bg-indigo-600', mode === 'COUNT');
            document.getElementById('day0-mode-count').classList.toggle('text-white', mode === 'COUNT');
            document.getElementById('day0-mode-count').classList.toggle('bg-white', mode !== 'COUNT');
            document.getElementById('day0-mode-count').classList.toggle('text-gray-700', mode !== 'COUNT');
            
            // Update Day 0 charts and metrics based on mode
            updateDay0Metrics();
        }
        
        function updateDay0Metrics() {
            // Update product mix display based on current mode
            const isAUM = currentDay0MetricMode === 'AUM';
            
            // Update the product mix cards with different percentages based on mode
            const productMixCards = document.querySelectorAll('#product-mix-card .text-center');
            const aumData = [
                { percentage: '15%', metric: '₹42 Cr AUM' },
                { percentage: '20%', metric: '₹56 Cr AUM' },
                { percentage: '15%', metric: '₹42 Cr AUM' },
                { percentage: '25%', metric: '₹70 Cr AUM' },
                { percentage: '20%', metric: '₹56 Cr AUM' },
                { percentage: '5%', metric: '₹14 Cr AUM' }
            ];
            
            const countData = [
                { percentage: '28%', metric: '3,052 loans' },
                { percentage: '22%', metric: '2,398 loans' },
                { percentage: '18%', metric: '1,962 loans' },
                { percentage: '15%', metric: '1,635 loans' },
                { percentage: '12%', metric: '1,308 loans' },
                { percentage: '5%', metric: '545 loans' }
            ];
            
            const dataToUse = isAUM ? aumData : countData;
            
            // Update the percentage displays and metric text
            productMixCards.forEach((card, index) => {
                if (index < dataToUse.length) {
                    const percentageElement = card.querySelector('.text-xl.font-bold');
                    const metricElement = card.querySelector('.text-xs');
                    if (percentageElement) {
                        percentageElement.textContent = dataToUse[index].percentage;
                    }
                    if (metricElement) {
                        metricElement.textContent = dataToUse[index].metric;
                    }
                }
            });
            
            // Update KPIs based on mode - Approved Amount stays the same
            document.getElementById('metric-approved-amount').textContent = '₹280 Cr';
            if (isAUM) {
                document.getElementById('metric-avg-loan').textContent = '₹3.2L';
            } else {
                document.getElementById('metric-avg-loan').textContent = '₹2.8L';
            }
        }
        
        function updateRiskCharts() {
            // Update risk charts based on current metric mode
            const isAUM = currentMetricMode === 'AUM';
            
            // Risk by Program
            if (charts.riskByProgram) {
                charts.riskByProgram.updateSeries([
                    { name: 'PAR 30+', data: isAUM ? [14.6, 13.2, 15.8] : [12.3, 11.1, 13.4] },
                    { name: 'PAR 60+', data: isAUM ? [12.8, 11.4, 13.9] : [10.1, 9.2, 11.6] },
                    { name: 'PAR 90+', data: isAUM ? [11.8, 10.2, 12.1] : [8.9, 8.1, 10.2] }
                ]);
            }
            
            // Risk by Originator
            if (charts.riskByOriginator) {
                charts.riskByOriginator.updateSeries([
                    { name: 'PAR 30+', data: isAUM ? [12.4, 15.8, 13.9, 16.2] : [11.2, 14.1, 12.5, 14.8] },
                    { name: 'PAR 60+', data: isAUM ? [10.1, 13.2, 11.7, 14.3] : [9.1, 11.8, 10.4, 12.9] },
                    { name: 'PAR 90+', data: isAUM ? [8.8, 11.9, 10.4, 12.8] : [7.8, 10.5, 9.2, 11.4] }
                ]);
            }
            
            // Risk by State
            if (charts.riskByState) {
                charts.riskByState.updateSeries([
                    { name: 'PAR 30+', data: isAUM ? [11.2, 14.8, 16.3, 13.7] : [10.1, 13.2, 14.8, 12.4] },
                    { name: 'PAR 60+', data: isAUM ? [9.4, 12.1, 14.2, 11.8] : [8.5, 10.9, 12.8, 10.6] },
                    { name: 'PAR 90+', data: isAUM ? [8.1, 10.9, 12.4, 10.2] : [7.2, 9.6, 11.1, 9.1] }
                ]);
            }
            
            // Risk by Tenure
            if (charts.riskByTenure) {
                charts.riskByTenure.updateSeries([
                    { name: 'PAR 30+', data: isAUM ? [13.2, 23.0, 23.8, 53.0] : [11.8, 20.4, 21.2, 48.1] },
                    { name: 'PAR 60+', data: isAUM ? [11.6, 19.9, 20.5, 47.0] : [10.2, 17.6, 18.1, 42.8] },
                    { name: 'PAR 90+', data: isAUM ? [10.4, 17.8, 18.2, 42.0] : [9.1, 15.8, 16.1, 38.2] }
                ]);
            }
            
            // Risk by Ticket Size
            if (charts.riskByTicketSize) {
                charts.riskByTicketSize.updateSeries([
                    { name: 'PAR 30+', data: isAUM ? [18.2, 11.2, 15.7, 14.6] : [16.4, 10.1, 14.2, 13.1] },
                    { name: 'PAR 60+', data: isAUM ? [15.8, 9.5, 13.2, 12.1] : [14.1, 8.6, 11.8, 10.9] },
                    { name: 'PAR 90+', data: isAUM ? [13.4, 8.4, 11.8, 10.8] : [12.2, 7.5, 10.5, 9.6] }
                ]);
            }
            
            // Risk by Interest Rate
            if (charts.riskByInterest) {
                charts.riskByInterest.updateSeries([
                    { name: 'PAR 30+', data: isAUM ? [9.8, 12.4, 16.7, 19.3] : [8.9, 11.2, 15.1, 17.4] },
                    { name: 'PAR 60+', data: isAUM ? [8.2, 10.1, 14.2, 16.8] : [7.4, 9.1, 12.8, 15.2] },
                    { name: 'PAR 90+', data: isAUM ? [7.1, 8.9, 12.4, 14.9] : [6.4, 8.0, 11.2, 13.4] }
                ]);
            }
        }
        
        // Initialize Performance charts
        function initPerformanceCharts() {
            // Remove AUM charts as they're no longer needed

            // Risk by Program Bar Chart
            if (!charts.riskByProgram && document.querySelector("#risk-by-program-chart")) {
                charts.riskByProgram = new ApexCharts(document.querySelector("#risk-by-program-chart"), {
                    chart: { type: 'bar', height: 200, toolbar: { show: false } },
                series: [
                        { name: 'PAR 30+', data: [14.6, 13.2, 15.8] },
                        { name: 'PAR 60+', data: [12.8, 11.4, 13.9] },
                        { name: 'PAR 90+', data: [11.8, 10.2, 12.1] }
                    ],
                    xaxis: { categories: ['MFI', 'MSME', 'Agri'] },
                    colors: ['#eab308', '#f97316', '#ef4444'],
                    legend: { show: true, position: 'top' },
                    dataLabels: { enabled: true, formatter: (val) => val.toFixed(1) + '%' }
                });
                charts.riskByProgram.render();
            }
            
            // Risk by Originator Bar Chart
            if (!charts.riskByOriginator && document.querySelector("#risk-by-originator-chart")) {
                charts.riskByOriginator = new ApexCharts(document.querySelector("#risk-by-originator-chart"), {
                    chart: { type: 'bar', height: 200, toolbar: { show: false } },
                    series: [
                        { name: 'PAR 30+', data: [12.4, 15.8, 13.9, 16.2] },
                        { name: 'PAR 60+', data: [10.1, 13.2, 11.7, 14.3] },
                        { name: 'PAR 90+', data: [8.8, 11.9, 10.4, 12.8] }
                    ],
                    xaxis: { categories: ['Partner A', 'Partner B', 'Partner C', 'Partner D'] },
                    colors: ['#eab308', '#f97316', '#ef4444'],
                    legend: { show: true, position: 'top' },
                    dataLabels: { enabled: true, formatter: (val) => val.toFixed(1) + '%' }
                });
                charts.riskByOriginator.render();
            }
            
            // Risk by State Bar Chart
            if (!charts.riskByState && document.querySelector("#risk-by-state-chart")) {
                charts.riskByState = new ApexCharts(document.querySelector("#risk-by-state-chart"), {
                    chart: { type: 'bar', height: 200, toolbar: { show: false } },
                    series: [
                        { name: 'PAR 30+', data: [11.2, 14.8, 16.3, 13.7] },
                        { name: 'PAR 60+', data: [9.4, 12.1, 14.2, 11.8] },
                        { name: 'PAR 90+', data: [8.1, 10.9, 12.4, 10.2] }
                    ],
                    xaxis: { categories: ['Maharashtra', 'Karnataka', 'Tamil Nadu', 'Gujarat'] },
                    colors: ['#eab308', '#f97316', '#ef4444'],
                    legend: { show: true, position: 'top' },
                    dataLabels: { enabled: true, formatter: (val) => val.toFixed(1) + '%' }
                });
                charts.riskByState.render();
            }

            // Remove AUM by Tenure chart as it's no longer needed

            // Risk by Tenure Bar Chart
            if (!charts.riskByTenure && document.querySelector("#risk-by-tenure-chart")) {
                charts.riskByTenure = new ApexCharts(document.querySelector("#risk-by-tenure-chart"), {
                    chart: { type: 'bar', height: 250, toolbar: { show: false } },
                    series: [
                        { name: 'PAR 30+', data: [13.2, 23.0, 23.8, 53.0] },
                        { name: 'PAR 60+', data: [11.6, 19.9, 20.5, 47.0] },
                        { name: 'PAR 90+', data: [10.4, 17.8, 18.2, 42.0] }
                    ],
                    xaxis: { categories: ['18-20 months', '21-24 months', '25-30 months', 'nan'] },
                    colors: ['#eab308', '#f97316', '#ef4444'],
                    legend: { show: false },
                    dataLabels: { enabled: true, formatter: (val) => val.toFixed(1) + '%' }
                });
                charts.riskByTenure.render();
            }

            // Risk by Ticket Size Bar Chart
            if (!charts.riskByTicketSize && document.querySelector("#risk-by-ticket-size-chart")) {
                charts.riskByTicketSize = new ApexCharts(document.querySelector("#risk-by-ticket-size-chart"), {
                    chart: { type: 'bar', height: 200, toolbar: { show: false } },
                series: [
                        { name: 'PAR 30+', data: [18.2, 11.2, 15.7, 14.6] },
                        { name: 'PAR 60+', data: [15.8, 9.5, 13.2, 12.1] },
                        { name: 'PAR 90+', data: [13.4, 8.4, 11.8, 10.8] }
                    ],
                    xaxis: { categories: ['< ₹25k', '₹25k-50k', '₹50k-75k', '> ₹75k'] },
                    colors: ['#eab308', '#f97316', '#ef4444'],
                    legend: { show: true, position: 'top' },
                    dataLabels: { enabled: true, formatter: (val) => val.toFixed(1) + '%' }
                });
                charts.riskByTicketSize.render();
            }
            
            // Risk by Interest Rate Bar Chart
            if (!charts.riskByInterest && document.querySelector("#risk-by-interest-chart")) {
                charts.riskByInterest = new ApexCharts(document.querySelector("#risk-by-interest-chart"), {
                    chart: { type: 'bar', height: 200, toolbar: { show: false } },
                    series: [
                        { name: 'PAR 30+', data: [9.8, 12.4, 16.7, 19.3] },
                        { name: 'PAR 60+', data: [8.2, 10.1, 14.2, 16.8] },
                        { name: 'PAR 90+', data: [7.1, 8.9, 12.4, 14.9] }
                    ],
                    xaxis: { categories: ['< 12%', '12-15%', '15-18%', '> 18%'] },
                    colors: ['#eab308', '#f97316', '#ef4444'],
                    legend: { show: true, position: 'top' },
                    dataLabels: { enabled: true, formatter: (val) => val.toFixed(1) + '%' }
                });
                charts.riskByInterest.render();
            }

            if (!charts.riskMetrics) {
                charts.riskMetrics = new ApexCharts(document.querySelector("#risk-metrics-over-time-chart"), {
                chart: { type: 'line', height: 300, toolbar: { show: false } },
                stroke: { width: 3, curve: 'smooth' },
                    xaxis: { categories: ['Jun 24', 'Jul 24', 'Aug 24', 'Sep 24', 'Oct 24', 'Nov 24'] },
                    yaxis: { labels: { formatter: (val) => val.toFixed(1) + '%' } },
                    colors: ['#3b82f6', '#f59e0b', '#ef4444'],
                series: [
                        { name: '30+ DPD', data: [18.5, 16.8, 15.2, 13.9, 12.1, 10.8] },
                        { name: '60+ DPD', data: [15.2, 13.8, 12.4, 11.1, 9.8, 8.6] },
                        { name: '90+ DPD', data: [12.8, 11.6, 10.2, 9.1, 7.9, 6.9] }
                    ]
                });
                charts.riskMetrics.render();
            }

            // PAR 30/60/90 over time individual charts (showing decreasing trend)
            if (!charts.par30OverTime && document.querySelector('#par30-over-time-chart')) {
                charts.par30OverTime = new ApexCharts(document.querySelector('#par30-over-time-chart'), {
                    chart: { type: 'line', height: 180, toolbar: { show: false } },
                    stroke: { width: 3, curve: 'smooth' },
                    colors: ['#3b82f6'],
                    xaxis: { categories: ['Aug 2024','Sep 2024','Oct 2024','Nov 2024','Dec 2024','Jan 2025','Feb 2025','Mar 2025'] },
                    series: [{ name: 'PAR 30', data: [16.6, 16.2, 14.2, 12.8, 11.8, 10.3, 8.8, 7.0] }],
                    dataLabels: { enabled: false }
                });
                charts.par30OverTime.render();
            }

            if (!charts.par60OverTime && document.querySelector('#par60-over-time-chart')) {
                charts.par60OverTime = new ApexCharts(document.querySelector('#par60-over-time-chart'), {
                    chart: { type: 'line', height: 180, toolbar: { show: false } },
                    stroke: { width: 3, curve: 'smooth' },
                    colors: ['#f59e0b'],
                    xaxis: { categories: ['Aug 2024','Sep 2024','Oct 2024','Nov 2024','Dec 2024','Jan 2025','Feb 2025','Mar 2025'] },
                    series: [{ name: 'PAR 60', data: [14.6, 14.1, 12.4, 11.7, 9.8, 8.1, 6.6, 5.4] }],
                    dataLabels: { enabled: false }
                });
                charts.par60OverTime.render();
            }

            if (!charts.par90OverTime && document.querySelector('#par90-over-time-chart')) {
                charts.par90OverTime = new ApexCharts(document.querySelector('#par90-over-time-chart'), {
                    chart: { type: 'line', height: 180, toolbar: { show: false } },
                    stroke: { width: 3, curve: 'smooth' },
                    colors: ['#ef4444'],
                    xaxis: { categories: ['Aug 2024','Sep 2024','Oct 2024','Nov 2024','Dec 2024','Jan 2025','Feb 2025','Mar 2025'] },
                    series: [{ name: 'PAR 90', data: [11.8, 11.1, 9.4, 8.4, 7.1, 5.4, 4.4, 3.0] }],
                    dataLabels: { enabled: false }
                });
                charts.par90OverTime.render();
            }
            
            if (!charts.vintage) {
                charts.vintage = new ApexCharts(document.querySelector("#vintage-chart"), {
                    chart: { type: 'line', height: 300, toolbar: { show: false } },
                    stroke: { width: 2, curve: 'smooth' },
                    xaxis: { 
                        categories: ['MOB 1', 'MOB 2', 'MOB 3', 'MOB 4', 'MOB 5', 'MOB 6', 'MOB 7', 'MOB 8', 'MOB 9', 'MOB 10', 'MOB 11', 'MOB 12'],
                        title: { text: 'Months on Book (MOB)' },
                        type: 'category'
                    },
                    yaxis: { 
                        title: { text: 'Cumulative Default Rate (%)' },
                        min: 0,
                        max: 8,
                        labels: { formatter: (val) => val.toFixed(1) + '%' }
                    },
                    colors: ['#10b981', '#06b6d4', '#8b5cf6', '#f59e0b', '#ef4444', '#ec4899'],
                    legend: { 
                        position: 'top',
                        horizontalAlign: 'center',
                        fontSize: '12px'
                    },
                    tooltip: {
                        shared: true,
                        intersect: false,
                        y: { formatter: (val) => val.toFixed(2) + '%' }
                    },
                    series: [
                        { 
                            name: 'Nov 2024 Cohort', 
                            data: [0.1, 0.3, 0.6, null, null, null, null, null, null, null, null, null] 
                        },
                        { 
                            name: 'Oct 2024 Cohort', 
                            data: [0.1, 0.4, 0.8, 1.2, null, null, null, null, null, null, null, null] 
                        },
                        { 
                            name: 'Sep 2024 Cohort', 
                            data: [0.2, 0.5, 1.0, 1.5, 2.1, 2.6, null, null, null, null, null, null] 
                        },
                        { 
                            name: 'Aug 2024 Cohort', 
                            data: [0.2, 0.6, 1.2, 1.8, 2.5, 3.1, 3.6, 4.0, null, null, null, null] 
                        },
                        { 
                            name: 'Jul 2024 Cohort', 
                            data: [0.3, 0.7, 1.4, 2.1, 2.9, 3.6, 4.2, 4.7, 5.1, 5.4, null, null] 
                        },
                        { 
                            name: 'Jun 2024 Cohort', 
                            data: [0.3, 0.8, 1.6, 2.4, 3.3, 4.1, 4.8, 5.4, 5.9, 6.3, 6.6, 6.8] 
                        }
                    ]
                });
                charts.vintage.render();
            }

            if (!charts.roc && document.querySelector("#roc-chart")) {
                charts.roc = new ApexCharts(document.querySelector("#roc-chart"), {
                    chart: { 
                        type: 'line', 
                        height: 300, 
                        toolbar: { show: false },
                        animations: { enabled: false } // Disable animations to prevent disappearing
                    },
                    stroke: { width: 3, curve: 'smooth' },
                    xaxis: { 
                        title: { text: 'False Positive Rate' }, 
                        min: 0, 
                        max: 1,
                        type: 'numeric'
                    },
                    yaxis: { 
                        title: { text: 'True Positive Rate' }, 
                        min: 0, 
                        max: 1 
                    },
                    colors: ['#4f46e5', '#ef4444'],
                    series: [
                        { 
                            name: 'Current Model (AUC: 0.82)', 
                            data: [
                                [0, 0], [0.1, 0.35], [0.2, 0.55], [0.3, 0.72], [0.4, 0.80], 
                                [0.5, 0.86], [0.6, 0.90], [0.7, 0.94], [0.8, 0.97], [0.9, 0.99], [1, 1]
                            ] 
                        },
                        { 
                            name: 'Random (AUC: 0.5)', 
                            data: [[0, 0], [1, 1]] 
                        }
                    ],
                    tooltip: { 
                        x: { formatter: (val) => val.toFixed(2) }, 
                        y: { formatter: (val) => val.toFixed(2) } 
                    },
                    legend: { 
                        show: true,
                        position: 'top'
                    }
                });
                charts.roc.render();
            }

            if (!charts.gainLift) {
                charts.gainLift = new ApexCharts(document.querySelector("#gain-lift-chart"), {
                    series: [
                        { name: 'KI Score', type: 'column', data: [39, 22, 15, 10, 6, 4, 2, 1, 1, 0] },
                        { name: 'Bureau Score', type: 'line', data: [25, 18, 14, 11, 8, 6, 5, 4, 3, 2] }
                    ],
                    chart: { height: 300, type: 'line', toolbar: {show: false} },
                    stroke: { width: [0, 3] },
                    title: { text: 'Ki Score vs Bureau Score Lift' },
                    dataLabels: { enabled: true, enabledOnSeries: [0], formatter: (val) => val + '%'},
                    labels: ['10', '9', '8', '7', '6', '5', '4', '3', '2', '1'],
                    xaxis: { title: { text: 'Decile (10=Riskiest)' } },
                    yaxis: [{ title: { text: 'Default Captured (%)' }, labels: { formatter: (val) => val + '%' } }],
                    colors: ['#8b5cf6', '#f59e0b']
                });
                charts.gainLift.render();
            }
        }

        function updateDashboard(productKey) {
            const data = productData[productKey];
            if (!data) return;

            document.getElementById('metric-total-apps').textContent = data.metrics.totalApplications.toLocaleString();
            document.getElementById('metric-approved-apps').textContent = data.metrics.approvedApplications.toLocaleString();
            document.getElementById('metric-approval-rate').textContent = `${data.metrics.approvalRate}% approval rate`;
            document.getElementById('metric-approved-amount').textContent = data.metrics.approvedAmount;
            document.getElementById('metric-avg-loan').textContent = data.metrics.avgLoanSize;

            // Update charts if they exist
            if (charts.originations) charts.originations.updateSeries(data.charts.originations.series);
            if (charts.decisionTrends) charts.decisionTrends.updateSeries(data.charts.decisionTrends.series);
            
            if (charts.kiScoreApproved) charts.kiScoreApproved.updateSeries(data.charts.kiScore.approved);
            if (charts.kiScoreDeclined) charts.kiScoreDeclined.updateSeries(data.charts.kiScore.declined);
            if (charts.bureauScoreApproved) charts.bureauScoreApproved.updateSeries(data.charts.bureauScore.approved);
            if (charts.bureauScoreDeclined) charts.bureauScoreDeclined.updateSeries(data.charts.bureauScore.declined);
            if (charts.incomeApproved) charts.incomeApproved.updateSeries(data.charts.income.approved);
            if (charts.incomeDeclined) charts.incomeDeclined.updateSeries(data.charts.income.declined);
            if (charts.foirApproved) charts.foirApproved.updateSeries(data.charts.foir.approved);
            if (charts.foirDeclined) charts.foirDeclined.updateSeries(data.charts.foir.declined);
            if (charts.ticketSizeApproved) charts.ticketSizeApproved.updateSeries(data.charts.ticketSize.approved);
            if (charts.ticketSizeDeclined) charts.ticketSizeDeclined.updateSeries(data.charts.ticketSize.declined);
            if (charts.ageApproved) charts.ageApproved.updateSeries(data.charts.age.approved);
            if (charts.ageDeclined) charts.ageDeclined.updateSeries(data.charts.age.declined);
            if (charts.educationApproved) charts.educationApproved.updateSeries(data.charts.education.approved);
            if (charts.educationDeclined) charts.educationDeclined.updateSeries(data.charts.education.declined);
            
            const productMixCard = document.getElementById('product-mix-card');
            const ltvSection = document.getElementById('ltv-distribution-section');
            
            // Show/hide product mix for 'all' products view
            productMixCard.style.display = productKey === 'all' ? 'block' : 'none';

            // Show/hide LTV charts based on product type (only for secured products)
            if (data.showLTV) {
                ltvSection.style.display = 'grid';
                if (charts.ltvApproved) charts.ltvApproved.updateSeries(data.charts.ltv.approved);
                if (charts.ltvDeclined) charts.ltvDeclined.updateSeries(data.charts.ltv.declined);
            } else {
                ltvSection.style.display = 'none';
            }
        }

        // Initialize DealSmart charts
        function initDealSmartCharts() {
            // PD Chart - KI Score 1-100
            if (!charts.pdChart && document.querySelector("#pd-chart")) {
                charts.pdChart = new ApexCharts(document.querySelector("#pd-chart"), {
                    chart: { type: 'line', height: 200, toolbar: { show: false } },
                    series: [{ name: 'PD (%)', data: [0.2, 0.5, 1.0, 1.8, 2.5, 3.5, 4.8, 6.2, 8.0, 10.5] }],
                    xaxis: { 
                        categories: ['1-10', '11-20', '21-30', '31-40', '41-50', '51-60', '61-70', '71-80', '81-90', '91-100'],
                        title: { text: 'KI Score (1=Best, 100=Worst)' }
                    },
                    colors: ['#ec4899'],
                    stroke: { width: 3, curve: 'smooth' },
                    fill: { opacity: 0.3 },
                    yaxis: { min: 0, max: 12, title: { text: 'PD (%)' } }
                });
                charts.pdChart.render();
            }

            // LGD Chart - by Recovery Rate
            if (!charts.lgdChart && document.querySelector("#lgd-chart")) {
                charts.lgdChart = new ApexCharts(document.querySelector("#lgd-chart"), {
                    chart: { type: 'line', height: 200, toolbar: { show: false } },
                    series: [{ name: 'LGD (%)', data: [25, 35, 45, 55, 65, 75, 85, 95] }],
                    xaxis: { 
                        categories: ['90%+', '80-90%', '70-80%', '60-70%', '50-60%', '40-50%', '30-40%', '<30%'],
                        title: { text: 'Past Recovery Rate' }
                    },
                    colors: ['#3b82f6'],
                    stroke: { width: 3, curve: 'smooth' },
                    fill: { opacity: 0.3 },
                    yaxis: { min: 0, max: 100, title: { text: 'LGD (%)' } }
                });
                charts.lgdChart.render();
            }

            // RBP Distribution chart - with Standard Pricing in middle
            if (!charts.rbpDistribution && document.querySelector("#rbp-distribution-chart")) {
                charts.rbpDistribution = new ApexCharts(document.querySelector("#rbp-distribution-chart"), {
                    chart: { type: 'bar', height: 250, toolbar: { show: false } },
                    series: [
                        { name: 'Standard Pricing', data: [0, 0, 0, 0, 0, 25, 25, 25, 25, 0, 0, 0, 0, 0, 0] },
                        { name: 'Risk-Based Pricing', data: [2, 3, 5, 7, 10, 13, 15, 13, 10, 7, 5, 4, 3, 2, 1] }
                    ],
                    yaxis: {
                        labels: {
                            formatter: function (value) {
                                return value + "%";
                            }
                        },
                        title: {
                            text: '% of Loans'
                        }
                    },
                    xaxis: { 
                        categories: ['10%', '11%', '12%', '13%', '14%', '15%', '16%', '17%', '18%', '19%', '20%', '21%', '22%', '23%', '24%'],
                        labels: { 
                            style: { 
                                colors: ['#10b981', '#10b981', '#10b981', '#10b981', '#10b981', '#3b82f6', '#3b82f6', '#3b82f6', '#3b82f6', '#ef4444', '#ef4444', '#ef4444', '#ef4444', '#ef4444', '#ef4444'] 
                            } 
                        }
                    },
                    colors: ['#3b82f6', '#10b981'],
                    dataLabels: { enabled: false },
                    plotOptions: { bar: { horizontal: false, columnWidth: '70%' } },
                    legend: { position: 'top' },
                    annotations: {
                        xaxis: [{
                            x: '10%',
                            x2: '14%',
                            fillColor: '#10b981',
                            opacity: 0.2,
                            label: {
                                text: 'Improved Conversion Zone',
                                style: { color: '#fff', background: '#10b981', fontSize: '12px', padding: {left: 5, right: 5, top: 2, bottom: 2} }
                            }
                        }, {
                            x: '19%',
                            x2: '24%',
                            fillColor: '#ef4444',
                            opacity: 0.2,
                            label: {
                                text: 'Improved NIM Zone',
                                style: { color: '#fff', background: '#ef4444', fontSize: '12px', padding: {left: 5, right: 5, top: 2, bottom: 2} }
                            }
                        }]
                    }
                });
                charts.rbpDistribution.render();
            }
        }

        // Initialize on load
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize product data
            productData = {
                'all': {
                    showLTV: true,
                    metrics: { totalApplications: 10900, approvedApplications: 8720, approvalRate: 80.0, approvedAmount: '₹280 Cr', avgLoanSize: '₹3.2L' },
                    charts: {
                        originations: { series: [{ name: 'Applications', data: [1500, 1600, 1700, 1900, 2000, 2200] }, { name: 'Approved', data: [1200, 1280, 1360, 1520, 1600, 1760] }] },
                        decisionTrends: { series: [{ name: 'KI Score Approved', data: [78, 79, 80, 79, 80, 80] }, { name: 'KI Score Rejected', data: [22, 21, 20, 21, 20, 20] }] },
                        kiScore: { approved: [{ name: '1-20 (Best)', data: [60, 62, 65, 64, 66, 68] }, { name: '21-40', data: [30, 28, 26, 27, 25, 24] }, { name: '41-60', data: [8, 8, 7, 7, 7, 6] }, { name: '>60', data: [2, 2, 2, 2, 2, 2] }], declined: [{ name: '<40', data: [10, 11, 12, 10, 9, 8] }, { name: '41-60', data: [25, 25, 24, 26, 27, 28] }, { name: '61-80', data: [40, 40, 42, 41, 40, 41] }, { name: '>80 (Worst)', data: [25, 24, 22, 23, 24, 23] }] },
                        bureauScore: { approved: [{ name: '>780', data: [35, 36, 38, 40, 42, 43] }, { name: '751-780', data: [40, 40, 38, 37, 36, 35] }, { name: '700-750', data: [20, 19, 19, 18, 17, 17] }, { name: '<700', data: [5, 5, 5, 5, 5, 5] }], declined: [{ name: '>720', data: [10, 10, 11, 12, 12, 13] }, { name: '681-720', data: [20, 21, 22, 22, 23, 22] }, { name: '650-680', data: [40, 40, 39, 38, 37, 38] }, { name: '<650', data: [30, 29, 28, 28, 28, 27] }] },
                        income: { approved: [{ name: '>₹5L', data: [20, 22, 23, 25, 26, 28] }, { name: '₹3-5L', data: [40, 40, 41, 41, 42, 42] }, { name: '₹1-3L', data: [35, 34, 32, 30, 28, 26] }, { name: '<₹1L', data: [5, 4, 4, 4, 4, 4] }], declined: [{ name: '>₹5L', data: [5, 5, 6, 6, 7, 7] }, { name: '₹3-5L', data: [15, 16, 16, 17, 18, 18] }, { name: '₹1-3L', data: [40, 40, 39, 38, 37, 38] }, { name: '<₹1L', data: [40, 39, 39, 39, 38, 37] }] },
                        foir: { approved: [{ name: '<35%', data: [50, 52, 53, 55, 56, 58] }, { name: '36-45%', data: [35, 34, 33, 32, 31, 30] }, { name: '46-55%', data: [13, 12, 12, 11, 11, 10] }, { name: '>55%', data: [2, 2, 2, 2, 2, 2] }], declined: [{ name: '<40%', data: [5, 5, 6, 6, 7, 7] }, { name: '41-50%', data: [15, 16, 16, 17, 18, 18] }, { name: '51-60%', data: [40, 40, 39, 38, 37, 38] }, { name: '>60%', data: [40, 39, 39, 39, 38, 37] }] },
                        ltv: { approved: [{ name: '<60%', data: [15, 16, 18, 20, 22, 23] }, { name: '61-75%', data: [50, 50, 49, 48, 47, 46] }, { name: '76-85%', data: [30, 29, 28, 27, 26, 26] }, { name: '>85%', data: [5, 5, 5, 5, 5, 5] }], declined: [{ name: '<70%', data: [2, 2, 2, 3, 3, 3] }, { name: '71-80%', data: [10, 11, 11, 12, 12, 13] }, { name: '81-90%', data: [48, 48, 49, 48, 47, 47] }, { name: '>90%', data: [40, 39, 38, 37, 38, 37] }] },
                        ticketSize: { approved: [{ name: '>₹7L', data: [15, 16, 17, 18, 19, 20] }, { name: '₹3-7L', data: [35, 35, 36, 36, 37, 38] }, { name: '₹1-3L', data: [40, 39, 38, 37, 36, 35] }, { name: '<₹1L', data: [10, 10, 9, 9, 8, 7] }], declined: [{ name: '>₹7L', data: [10, 10, 11, 11, 12, 12] }, { name: '₹3-7L', data: [30, 31, 31, 32, 32, 33] }, { name: '₹1-3L', data: [45, 44, 44, 43, 43, 42] }, { name: '<₹1L', data: [15, 15, 14, 14, 13, 13] }] },
                        age: { approved: [{ name: '>55', data: [8, 8, 8, 9, 9, 9] }, { name: '46-55', data: [22, 22, 21, 21, 20, 20] }, { name: '36-45', data: [35, 35, 36, 36, 36, 37] }, { name: '25-35', data: [30, 30, 30, 29, 29, 28] }, { name: '<25', data: [5, 5, 5, 5, 6, 6] }], declined: [{ name: '>55', data: [4, 4, 4, 4, 3, 3] }, { name: '46-55', data: [10, 10, 11, 11, 12, 12] }, { name: '36-45', data: [25, 25, 24, 24, 23, 23] }, { name: '25-35', data: [36, 36, 36, 35, 35, 34] }, { name: '<25', data: [25, 25, 25, 26, 27, 28] }] },
                        education: { approved: [{ name: 'Undergraduate+', data: [10,11,11,12,12,13]},{ name: '12th Pass', data: [30,30,31,31,32,32] },{ name: '10th Pass', data: [50, 49, 48, 47, 46, 45] },{ name: 'Illiterate', data: [10, 10, 10, 10, 10, 10] }], declined: [{ name: 'Undergraduate+', data: [5,5,5,6,6,6]},{ name: '12th Pass', data: [20,21,21,22,22,23] },{ name: '10th Pass', data: [50, 50, 49, 48, 47, 47] },{ name: 'Illiterate', data: [25, 24, 25, 24, 25, 24] }]},
                    }
                },
                'mfi': {
                    showLTV: false,
                    metrics: { totalApplications: 3052, approvedApplications: 2442, approvalRate: 80.0, approvedAmount: '₹78 Cr', avgLoanSize: '₹0.6L' },
                    charts: {
                        originations: { series: [{ name: 'Applications', data: [420, 448, 476, 532, 560, 616] }, { name: 'Approved', data: [336, 358, 381, 426, 448, 493] }] },
                        decisionTrends: { series: [{ name: 'KI Score Approved', data: [80, 80, 80, 80, 80, 80] }, { name: 'KI Score Rejected', data: [20, 20, 20, 20, 20, 20] }] },
                        kiScore: { approved: [{ name: '1-20 (Best)', data: [65, 67, 70, 69, 71, 73] }, { name: '21-40', data: [25, 23, 21, 22, 20, 19] }, { name: '41-60', data: [8, 8, 7, 7, 7, 6] }, { name: '>60', data: [2, 2, 2, 2, 2, 2] }], declined: [{ name: '<40', data: [8, 9, 10, 8, 7, 6] }, { name: '41-60', data: [22, 22, 21, 23, 24, 25] }, { name: '61-80', data: [42, 42, 44, 43, 42, 43] }, { name: '>80 (Worst)', data: [28, 27, 25, 26, 27, 26] }] },
                        bureauScore: { approved: [{ name: '>780', data: [25, 26, 28, 30, 32, 33] }, { name: '751-780', data: [35, 35, 33, 32, 31, 30] }, { name: '700-750', data: [30, 29, 29, 28, 27, 27] }, { name: '<700', data: [10, 10, 10, 10, 10, 10] }], declined: [{ name: '>720', data: [8, 8, 9, 10, 10, 11] }, { name: '681-720', data: [18, 19, 20, 20, 21, 20] }, { name: '650-680', data: [42, 42, 41, 40, 39, 40] }, { name: '<650', data: [32, 31, 30, 30, 30, 29] }] },
                        income: { approved: [{ name: '>₹5L', data: [5, 7, 8, 10, 11, 13] }, { name: '₹3-5L', data: [15, 15, 16, 16, 17, 17] }, { name: '₹1-3L', data: [60, 59, 57, 55, 53, 51] }, { name: '<₹1L', data: [20, 19, 19, 19, 19, 19] }], declined: [{ name: '>₹5L', data: [2, 2, 3, 3, 4, 4] }, { name: '₹3-5L', data: [8, 9, 9, 10, 11, 11] }, { name: '₹1-3L', data: [45, 45, 44, 43, 42, 43] }, { name: '<₹1L', data: [45, 44, 44, 44, 43, 42] }] },
                        foir: { approved: [{ name: '<35%', data: [45, 47, 48, 50, 51, 53] }, { name: '36-45%', data: [40, 39, 38, 37, 36, 35] }, { name: '46-55%', data: [13, 12, 12, 11, 11, 10] }, { name: '>55%', data: [2, 2, 2, 2, 2, 2] }], declined: [{ name: '<40%', data: [3, 3, 4, 4, 5, 5] }, { name: '41-50%', data: [12, 13, 13, 14, 15, 15] }, { name: '51-60%', data: [45, 45, 44, 43, 42, 43] }, { name: '>60%', data: [40, 39, 39, 39, 38, 37] }] },
                        ltv: { approved: [], declined: [] }, // No LTV for MFI
                        ticketSize: { approved: [{ name: '>₹1L', data: [5, 6, 7, 8, 9, 10] }, { name: '₹50K-1L', data: [25, 25, 26, 26, 27, 28] }, { name: '₹25-50K', data: [50, 49, 48, 47, 46, 45] }, { name: '<₹25K', data: [20, 20, 19, 19, 18, 17] }], declined: [{ name: '>₹1L', data: [8, 8, 9, 9, 10, 10] }, { name: '₹50K-1L', data: [22, 23, 23, 24, 24, 25] }, { name: '₹25-50K', data: [50, 49, 49, 48, 48, 47] }, { name: '<₹25K', data: [20, 20, 19, 19, 18, 18] }] },
                        age: { approved: [{ name: '>55', data: [12, 12, 12, 13, 13, 13] }, { name: '46-55', data: [28, 28, 27, 27, 26, 26] }, { name: '36-45', data: [35, 35, 36, 36, 36, 37] }, { name: '25-35', data: [20, 20, 20, 19, 19, 18] }, { name: '<25', data: [5, 5, 5, 5, 6, 6] }], declined: [{ name: '>55', data: [8, 8, 8, 8, 7, 7] }, { name: '46-55', data: [15, 15, 16, 16, 17, 17] }, { name: '36-45', data: [30, 30, 29, 29, 28, 28] }, { name: '25-35', data: [32, 32, 32, 31, 31, 30] }, { name: '<25', data: [15, 15, 15, 16, 17, 18] }] },
                        education: { approved: [{ name: 'Undergraduate+', data: [2,3,3,4,4,5]},{ name: '12th Pass', data: [15,15,16,16,17,17] },{ name: '10th Pass', data: [65, 64, 63, 62, 61, 60] },{ name: 'Illiterate', data: [18, 18, 18, 18, 18, 18] }], declined: [{ name: 'Undergraduate+', data: [1,1,1,2,2,2]},{ name: '12th Pass', data: [10,11,11,12,12,13] },{ name: '10th Pass', data: [60, 60, 59, 58, 57, 57] },{ name: 'Illiterate', data: [29, 28, 29, 28, 29, 28] }]},
                    }
                },
                'msme_secured': {
                    showLTV: true,
                    metrics: { totalApplications: 1635, approvedApplications: 1308, approvalRate: 80.0, approvedAmount: '₹92 Cr', avgLoanSize: '₹7.0L' },
                    charts: {
                        originations: { series: [{ name: 'Applications', data: [225, 240, 255, 285, 300, 330] }, { name: 'Approved', data: [180, 192, 204, 228, 240, 264] }] },
                        decisionTrends: { series: [{ name: 'KI Score Approved', data: [80, 80, 80, 80, 80, 80] }, { name: 'KI Score Rejected', data: [20, 20, 20, 20, 20, 20] }] },
                        kiScore: { approved: [{ name: '1-20 (Best)', data: [55, 57, 60, 59, 61, 63] }, { name: '21-40', data: [35, 33, 31, 32, 30, 29] }, { name: '41-60', data: [8, 8, 7, 7, 7, 6] }, { name: '>60', data: [2, 2, 2, 2, 2, 2] }], declined: [{ name: '<40', data: [12, 13, 14, 12, 11, 10] }, { name: '41-60', data: [28, 28, 27, 29, 30, 31] }, { name: '61-80', data: [38, 38, 40, 39, 38, 39] }, { name: '>80 (Worst)', data: [22, 21, 19, 20, 21, 20] }] },
                        bureauScore: { approved: [{ name: '>780', data: [45, 46, 48, 50, 52, 53] }, { name: '751-780', data: [35, 35, 33, 32, 31, 30] }, { name: '700-750', data: [15, 14, 14, 13, 12, 12] }, { name: '<700', data: [5, 5, 5, 5, 5, 5] }], declined: [{ name: '>720', data: [15, 15, 16, 17, 17, 18] }, { name: '681-720', data: [25, 26, 27, 27, 28, 27] }, { name: '650-680', data: [35, 35, 34, 33, 32, 33] }, { name: '<650', data: [25, 24, 23, 23, 23, 22] }] },
                        income: { approved: [{ name: '>₹5L', data: [35, 37, 38, 40, 41, 43] }, { name: '₹3-5L', data: [45, 45, 46, 46, 47, 47] }, { name: '₹1-3L', data: [18, 17, 15, 13, 11, 9] }, { name: '<₹1L', data: [2, 1, 1, 1, 1, 1] }], declined: [{ name: '>₹5L', data: [10, 10, 11, 11, 12, 12] }, { name: '₹3-5L', data: [25, 26, 26, 27, 28, 28] }, { name: '₹1-3L', data: [35, 35, 34, 33, 32, 33] }, { name: '<₹1L', data: [30, 29, 29, 29, 28, 27] }] },
                        foir: { approved: [{ name: '<35%', data: [60, 62, 63, 65, 66, 68] }, { name: '36-45%', data: [30, 29, 28, 27, 26, 25] }, { name: '46-55%', data: [8, 7, 7, 6, 6, 5] }, { name: '>55%', data: [2, 2, 2, 2, 2, 2] }], declined: [{ name: '<40%', data: [8, 8, 9, 9, 10, 10] }, { name: '41-50%', data: [22, 23, 23, 24, 25, 25] }, { name: '51-60%', data: [35, 35, 34, 33, 32, 33] }, { name: '>60%', data: [35, 34, 34, 34, 33, 32] }] },
                        ltv: { approved: [{ name: '<60%', data: [25, 26, 28, 30, 32, 33] }, { name: '61-75%', data: [55, 55, 54, 53, 52, 51] }, { name: '76-85%', data: [18, 17, 16, 15, 14, 14] }, { name: '>85%', data: [2, 2, 2, 2, 2, 2] }], declined: [{ name: '<70%', data: [5, 5, 5, 6, 6, 6] }, { name: '71-80%', data: [15, 16, 16, 17, 17, 18] }, { name: '81-90%', data: [40, 40, 41, 40, 39, 39] }, { name: '>90%', data: [40, 39, 38, 37, 38, 37] }] },
                        ticketSize: { approved: [{ name: '>₹10L', data: [25, 26, 27, 28, 29, 30] }, { name: '₹5-10L', data: [45, 45, 46, 46, 47, 48] }, { name: '₹2-5L', data: [25, 24, 23, 22, 21, 20] }, { name: '<₹2L', data: [5, 5, 4, 4, 3, 2] }], declined: [{ name: '>₹10L', data: [15, 15, 16, 16, 17, 17] }, { name: '₹5-10L', data: [35, 36, 36, 37, 37, 38] }, { name: '₹2-5L', data: [35, 34, 34, 33, 33, 32] }, { name: '<₹2L', data: [15, 15, 14, 14, 13, 13] }] },
                        age: { approved: [{ name: '>55', data: [6, 6, 6, 7, 7, 7] }, { name: '46-55', data: [25, 25, 24, 24, 23, 23] }, { name: '36-45', data: [45, 45, 46, 46, 46, 47] }, { name: '25-35', data: [20, 20, 20, 19, 19, 18] }, { name: '<25', data: [4, 4, 4, 4, 5, 5] }], declined: [{ name: '>55', data: [2, 2, 2, 2, 1, 1] }, { name: '46-55', data: [8, 8, 9, 9, 10, 10] }, { name: '36-45', data: [30, 30, 29, 29, 28, 28] }, { name: '25-35', data: [40, 40, 40, 39, 39, 38] }, { name: '<25', data: [20, 20, 20, 21, 22, 23] }] },
                        education: { approved: [{ name: 'Undergraduate+', data: [25,26,26,27,27,28]},{ name: '12th Pass', data: [45,45,46,46,47,47] },{ name: '10th Pass', data: [25, 24, 23, 22, 21, 20] },{ name: 'Illiterate', data: [5, 5, 5, 5, 5, 5] }], declined: [{ name: 'Undergraduate+', data: [15,15,15,16,16,16]},{ name: '12th Pass', data: [35,36,36,37,37,38] },{ name: '10th Pass', data: [35, 35, 34, 33, 32, 32] },{ name: 'Illiterate', data: [15, 14, 15, 14, 15, 14] }]},
                    }
                }
            };
            
            // Copy 'all' data as placeholder for other products
            productData['msme_unsecured'] = JSON.parse(JSON.stringify(productData['all']));
            productData['msme_unsecured'].showLTV = false;
            productData['msme_unsecured'].metrics = { totalApplications: 2398, approvedApplications: 1918, approvalRate: 80.0, approvedAmount: '₹96 Cr', avgLoanSize: '₹5.0L' };
            
            productData['agri'] = JSON.parse(JSON.stringify(productData['all']));
            productData['agri'].showLTV = false;
            productData['agri'].metrics = { totalApplications: 1962, approvedApplications: 1570, approvalRate: 80.0, approvedAmount: '₹63 Cr', avgLoanSize: '₹4.0L' };
            
            productData['housing'] = JSON.parse(JSON.stringify(productData['msme_secured']));
            productData['housing'].metrics = { totalApplications: 1308, approvedApplications: 1046, approvalRate: 80.0, approvedAmount: '₹105 Cr', avgLoanSize: '₹10.0L' };
            
            productData['tw'] = JSON.parse(JSON.stringify(productData['all']));
            productData['tw'].showLTV = true;
            productData['tw'].metrics = { totalApplications: 545, approvedApplications: 436, approvalRate: 80.0, approvedAmount: '₹22 Cr', avgLoanSize: '₹5.0L' };
            
            initCharts();
            initDealSmartCharts();
            updateDashboard('all');

            // Add event listener for product filter
            document.getElementById('product-filter').addEventListener('change', function(e) {
                updateDashboard(e.target.value);
            });

            // Add event listeners for DealSmart filters
            document.getElementById('dealsmart-product-filter').addEventListener('change', function(e) {
                updateDealSmartData(e.target.value);
            });

            document.getElementById('dealsmart-time-filter').addEventListener('change', function(e) {
                updateDealSmartData(document.getElementById('dealsmart-product-filter').value);
            });
        });

        // Update DealSmart data based on product filter
        function updateDealSmartData(productKey) {
            const dealSmartData = {
                'all': {
                    upsellOffers: 1250,
                    avgIncrease: '₹22,500',
                    incrementalBusiness: '₹2.8 Cr',
                    counterOffers: 890,
                    avgLoanAmount: '₹80,000',
                    salvagedBusiness: '₹7.1 Cr',
                    conversionLift: '+8%',
                    marginImprovement: '+0.5%'
                },
                'mfi': {
                    upsellOffers: 420,
                    avgIncrease: '₹8,500',
                    incrementalBusiness: '₹0.9 Cr',
                    counterOffers: 298,
                    avgLoanAmount: '₹25,000',
                    salvagedBusiness: '₹1.5 Cr',
                    conversionLift: '+12%',
                    marginImprovement: '+0.8%'
                },
                'msme_unsecured': {
                    upsellOffers: 528,
                    avgIncrease: '₹35,000',
                    incrementalBusiness: '₹1.8 Cr',
                    counterOffers: 360,
                    avgLoanAmount: '₹2.5L',
                    salvagedBusiness: '₹2.3 Cr',
                    conversionLift: '+6%',
                    marginImprovement: '+0.4%'
                },
                'msme_secured': {
                    upsellOffers: 245,
                    avgIncrease: '₹75,000',
                    incrementalBusiness: '₹1.8 Cr',
                    counterOffers: 131,
                    avgLoanAmount: '₹7.0L',
                    salvagedBusiness: '₹1.8 Cr',
                    conversionLift: '+4%',
                    marginImprovement: '+0.3%'
                },
                'agri': {
                    upsellOffers: 353,
                    avgIncrease: '₹45,000',
                    incrementalBusiness: '₹1.6 Cr',
                    counterOffers: 196,
                    avgLoanAmount: '₹4.0L',
                    salvagedBusiness: '₹1.6 Cr',
                    conversionLift: '+10%',
                    marginImprovement: '+0.6%'
                },
                'housing': {
                    upsellOffers: 157,
                    avgIncrease: '₹2.5L',
                    incrementalBusiness: '₹3.9 Cr',
                    counterOffers: 105,
                    avgLoanAmount: '₹10.0L',
                    salvagedBusiness: '₹1.0 Cr',
                    conversionLift: '+3%',
                    marginImprovement: '+0.2%'
                },
                'tw': {
                    upsellOffers: 87,
                    avgIncrease: '₹25,000',
                    incrementalBusiness: '₹0.2 Cr',
                    counterOffers: 65,
                    avgLoanAmount: '₹5.0L',
                    salvagedBusiness: '₹0.3 Cr',
                    conversionLift: '+15%',
                    marginImprovement: '+1.2%'
                }
            };

            const data = dealSmartData[productKey] || dealSmartData['all'];
            
            // Update Upsell Offers card
            const upsellCard = document.querySelector('#dealsmart-section .space-y-6 .card:nth-child(1)');
            if (upsellCard) {
                upsellCard.querySelector('.text-2xl:nth-child(1)').textContent = data.upsellOffers.toLocaleString();
                upsellCard.querySelector('.text-2xl:nth-child(2)').textContent = data.avgIncrease;
                upsellCard.querySelector('.text-2xl:nth-child(3)').textContent = data.incrementalBusiness;
            }
            
            // Update Counter Offers card
            const counterCard = document.querySelector('#dealsmart-section .space-y-6 .card:nth-child(2)');
            if (counterCard) {
                counterCard.querySelector('.text-2xl:nth-child(1)').textContent = data.counterOffers.toLocaleString();
                counterCard.querySelector('.text-2xl:nth-child(2)').textContent = data.avgLoanAmount;
                counterCard.querySelector('.text-2xl:nth-child(3)').textContent = data.salvagedBusiness;
            }
            
            // Update bottom row cards
            const bottomCards = document.querySelectorAll('#dealsmart-section .grid:nth-child(3) .card');
            if (bottomCards.length >= 2) {
                bottomCards[0].querySelector('.text-3xl').textContent = data.conversionLift;
                bottomCards[1].querySelector('.text-3xl').textContent = data.marginImprovement;
            }
        }
    </script>
</body>
</html>