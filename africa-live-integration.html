<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ki originate - live integration demo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }
        .page { display: none; }
        .page.active { display: block; }
        .sidebar-link { transition: all 0.2s ease-in-out; }
        .sidebar-link:hover, .sidebar-link.active { background-color: #e0f2fe; color: #0c4a6e; }
        .k-gradient-text {
            background: linear-gradient(to right, #0ea5e9, #22d3ee);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .los-terminal {
            max-width: 1600px;
            margin: 0 auto;
            border-radius: 0.75rem;
            overflow: hidden;
        }
        .gauge-container { position: relative; width: 250px; height: 125px; overflow: hidden; }
        .gauge-background { position: absolute; width: 100%; height: 100%; border-radius: 250px 250px 0 0; background: conic-gradient(from -90deg at 50% 100%, #22c55e, #84cc16, #eab308, #f97316, #ef4444); }
        .gauge-mask { position: absolute; top: 10px; left: 10px; width: 230px; height: 115px; background: #fff; border-radius: 230px 230px 0 0; }
        .gauge-pointer-container { position: absolute; width: 100%; height: 100%; display: flex; justify-content: center; align-items: flex-end; transition: transform 1s ease-out; }
        .gauge-pointer { width: 2px; height: 115px; background-color: #334155; transform-origin: bottom center; }
        .gauge-center-circle { position: absolute; bottom: -10px; left: 50%; transform: translateX(-50%); width: 20px; height: 20px; background-color: #334155; border-radius: 50%; }
        .gauge-text { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); text-align: center; }
        .section-card { background-color: white; padding: 1.5rem; border-radius: 0.75rem; border: 1px solid #e2e8f0; }
        .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; padding-bottom: 1rem; border-bottom: 1px solid #f1f5f9; }
        .clickable-row:hover { cursor: pointer; background-color: #f9fafb; }
    </style>
</head>
<body class="bg-gray-50">
    <div class="min-h-screen">
        <!-- Header -->
        <div class="bg-white shadow-sm border-b">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-16">
                    <div class="flex items-center space-x-4">
                        <button onclick="window.location.href='africa-home.html'" class="text-gray-600 hover:text-gray-900 transition-colors mr-4" title="Back to Home">
                            <i class="fas fa-arrow-left text-xl"></i>
                        </button>
                        <div class="kaleidofin-logo">
                            <svg width="164" height="30" viewBox="0 0 164 30" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M0.105469 8.45524L17.0689 0V6.76419L0.105469 15.2194V8.45524Z" fill="#0F547E" style="fill:#0F547E;fill:color(display-p3 0.0588 0.3294 0.4941);fill-opacity:1;"/>
                                <path d="M0.105469 15.3882L17.0689 23.8434V17.0792L0.105469 8.62402V15.3882Z" fill="#28B2B6" style="fill:#28B2B6;fill:color(display-p3 0.1569 0.6980 0.7137);fill-opacity:1;"/>
                                <path d="M38.8973 7.79234L32.7479 14.3625L39.0221 23.4083H33.9341L29.8762 17.4412L28.1593 19.2821V23.4083H24.0078V0.428711H28.1593V13.6007L33.4659 7.79234H38.8973Z" fill="#0F547E" style="fill:#0F547E;fill:color(display-p3 0.0588 0.3294 0.4941);fill-opacity:1;"/>
                                <path d="M43.7233 23.4083H39.5717V7.79236H43.7233V23.4083ZM39.0723 2.68225C39.0723 1.96282 39.322 1.34918 39.8214 0.841347C40.3208 0.312351 40.9244 0.0478516 41.6319 0.0478516C42.3394 0.0478516 42.9429 0.301771 43.4423 0.809609C43.9417 1.31744 44.1915 1.94167 44.1915 2.68225C44.1915 3.38053 43.9417 3.98359 43.4423 4.49142C42.9429 4.99927 42.3394 5.25318 41.6319 5.25318C40.9244 5.25318 40.3208 4.99927 39.8214 4.49142C39.322 3.98359 39.0723 3.38053 39.0723 2.68225Z" fill="#0F547E" style="fill:#0F547E;fill:color(display-p3 0.0588 0.3294 0.4941);fill-opacity:1;"/>
                                <path d="M63.6016 21.7378C62.0603 23.2502 60.1787 24.0064 57.9568 24.0064C55.7349 24.0064 53.8533 23.2502 52.312 21.7378C50.7707 20.2054 50 18.3348 50 16.1258C50 13.9169 50.7707 12.0562 52.312 10.5437C53.8533 9.01139 55.7349 8.24522 57.9568 8.24522C60.1787 8.24522 62.0603 9.01139 63.6016 10.5437C65.1429 12.0562 65.9136 13.9169 65.9136 16.1258C65.9136 18.3348 65.1429 20.2054 63.6016 21.7378ZM55.4947 18.6631C56.1553 19.3198 56.976 19.6482 57.9568 19.6482C58.9376 19.6482 59.7583 19.3198 60.4189 18.6631C61.0795 18.0064 61.4097 17.1606 61.4097 16.1258C61.4097 15.091 61.0795 14.2452 60.4189 13.5885C59.7583 12.9318 58.9376 12.6034 57.9568 12.6034C56.976 12.6034 56.1553 12.9318 55.4947 13.5885C54.8341 14.2452 54.5038 15.091 54.5038 16.1258C54.5038 17.1606 54.8341 18.0064 55.4947 18.6631Z" fill="#28B2B6" style="fill:#28B2B6;fill:color(display-p3 0.1569 0.6980 0.7137);fill-opacity:1;"/>
                                <path d="M71.4636 11.3198C71.7439 10.3646 72.3043 9.63825 73.1451 9.14074C74.0058 8.62333 74.9466 8.36462 75.9675 8.36462V13.4392C74.8665 13.2601 73.8356 13.4492 72.8748 14.0064C71.934 14.5437 71.4636 15.489 71.4636 16.8422V23.5885H66.9598V8.66313H71.4636V11.3198Z" fill="#28B2B6" style="fill:#28B2B6;fill:color(display-p3 0.1569 0.6980 0.7137);fill-opacity:1;"/>
                                <path d="M80.715 6.57358C80.1946 7.09099 79.5641 7.3497 78.8234 7.3497C78.0828 7.3497 77.4422 7.09099 76.9018 6.57358C76.3813 6.03626 76.1211 5.39945 76.1211 4.66313C76.1211 3.92681 76.3813 3.29995 76.9018 2.78253C77.4422 2.24522 78.0828 1.97656 78.8234 1.97656C79.5641 1.97656 80.1946 2.24522 80.715 2.78253C81.2555 3.29995 81.5257 3.92681 81.5257 4.66313C81.5257 5.39945 81.2555 6.03626 80.715 6.57358ZM76.5715 23.5885V8.66313H81.0753V23.5885H76.5715Z" fill="#28B2B6" style="fill:#28B2B6;fill:color(display-p3 0.1569 0.6980 0.7137);fill-opacity:1;"/>
                                <path d="M93.8892 8.66313H98.273V22.8422C98.273 25.1905 97.5023 26.9616 95.961 28.1557C94.4197 29.3696 92.5481 29.9766 90.3462 29.9766C86.9633 29.9766 84.5913 28.7726 83.2301 26.3646L87.0734 24.1557C87.754 25.4094 88.895 26.0363 90.4963 26.0363C91.5573 26.0363 92.388 25.7577 92.9885 25.2004C93.589 24.6631 93.8892 23.8771 93.8892 22.8422V21.4691C92.8484 22.7626 91.3871 23.4094 89.5055 23.4094C87.4037 23.4094 85.6422 22.6731 84.221 21.2004C82.8198 19.7079 82.1192 17.9169 82.1192 15.8273C82.1192 13.7378 82.8198 11.9567 84.221 10.484C85.6422 8.99149 87.4037 8.24522 89.5055 8.24522C91.3871 8.24522 92.8484 8.89199 93.8892 10.1855V8.66313ZM87.6439 18.3348C88.3245 18.9716 89.1952 19.29 90.2561 19.29C91.317 19.29 92.1878 18.9716 92.8684 18.3348C93.549 17.698 93.8892 16.8621 93.8892 15.8273C93.8892 14.7925 93.549 13.9567 92.8684 13.3198C92.1878 12.683 91.317 12.3646 90.2561 12.3646C89.1952 12.3646 88.3245 12.683 87.6439 13.3198C86.9633 13.9567 86.623 14.7925 86.623 15.8273C86.623 16.8621 86.9633 17.698 87.6439 18.3348Z" fill="#28B2B6" style="fill:#28B2B6;fill:color(display-p3 0.1569 0.6980 0.7137);fill-opacity:1;"/>
                                <path d="M104.219 6.57358C103.699 7.09099 103.068 7.3497 102.328 7.3497C101.587 7.3497 100.947 7.09099 100.406 6.57358C99.8858 6.03626 99.6255 5.39945 99.6255 4.66313C99.6255 3.92681 99.8858 3.29995 100.406 2.78253C100.947 2.24522 101.587 1.97656 102.328 1.97656C103.068 1.97656 103.699 2.24522 104.219 2.78253C104.76 3.29995 105.03 3.92681 105.03 4.66313C105.03 5.39945 104.76 6.03626 104.219 6.57358ZM100.076 23.5885V8.66313H104.58V23.5885H100.076Z" fill="#28B2B6" style="fill:#28B2B6;fill:color(display-p3 0.1569 0.6980 0.7137);fill-opacity:1;"/>
                                <path d="M115.172 8.24522C116.773 8.24522 118.104 8.79248 119.165 9.88701C120.246 10.9815 120.787 12.494 120.787 14.4243V23.5885H116.283V15.081C116.283 14.2054 116.033 13.5388 115.532 13.081C115.052 12.6034 114.431 12.3646 113.67 12.3646C112.81 12.3646 112.129 12.6233 111.629 13.1407C111.128 13.6582 110.878 14.4243 110.878 15.4393V23.5885H106.374V8.66313H110.878V10.0661C111.779 8.85219 113.21 8.24522 115.172 8.24522Z" fill="#28B2B6" style="fill:#28B2B6;fill:color(display-p3 0.1569 0.6980 0.7137);fill-opacity:1;"/>
                                <path d="M133.277 8.66313H137.781V23.5885H133.277V22.1855C132.217 23.3995 130.725 24.0064 128.804 24.0064C126.822 24.0064 125.131 23.2502 123.729 21.7378C122.328 20.2054 121.628 18.3348 121.628 16.1258C121.628 13.9169 122.328 12.0562 123.729 10.5437C125.131 9.01139 126.822 8.24522 128.804 8.24522C130.725 8.24522 132.217 8.85219 133.277 10.0661V8.66313ZM127.122 18.7825C127.783 19.4393 128.644 19.7676 129.704 19.7676C130.765 19.7676 131.626 19.4393 132.287 18.7825C132.947 18.1258 133.277 17.2402 133.277 16.1258C133.277 15.0114 132.947 14.1258 132.287 13.4691C131.626 12.8124 130.765 12.484 129.704 12.484C128.644 12.484 127.783 12.8124 127.122 13.4691C126.462 14.1258 126.131 15.0114 126.131 16.1258C126.131 17.2402 126.462 18.1258 127.122 18.7825Z" fill="#28B2B6" style="fill:#28B2B6;fill:color(display-p3 0.1569 0.6980 0.7137);fill-opacity:1;"/>
                                <path d="M148.382 12.9616H145.289V18.2452C148.382 18.8422 145.529 19.2203 146.01 19.3795C146.49 19.5388 147.281 19.5885 148.382 19.5288V23.5885C145.519 23.887 143.538 23.6184 142.437 22.7825C141.336 21.9268 140.785 20.4144 140.785 18.2452V12.9616H138.383V8.66313H140.785V5.82731L145.289 4.48403V8.66313H148.382V12.9616Z" fill="#28B2B6" style="fill:#28B2B6;fill:color(display-p3 0.1569 0.6980 0.7137);fill-opacity:1;"/>
                                <path d="M153.161 17.9169C153.681 19.3099 154.882 20.0064 156.764 20.0064C157.985 20.0064 158.946 19.6283 159.646 18.8721L163.249 20.9318C161.768 22.9815 159.586 24.0064 156.704 24.0064C154.182 24.0064 152.16 23.2601 150.639 21.7676C149.137 20.2751 148.387 18.3945 148.387 16.1258C148.387 13.8771 149.127 12.0064 150.609 10.5139C152.11 9.00144 154.032 8.24522 156.373 8.24522C158.555 8.24522 160.367 9.00144 161.808 10.5139C163.269 12.0064 164 13.8771 164 16.1258C164 16.7626 163.94 17.3596 163.82 17.9169H153.161ZM153.071 14.5736H159.526C159.086 13.0014 158.025 12.2154 156.343 12.2154C154.602 12.2154 153.511 13.0014 153.071 14.5736Z" fill="#28B2B6" style="fill:#28B2B6;fill:color(display-p3 0.1569 0.6980 0.7137);fill-opacity:1;"/>
                            </svg>
                        </div>
                        <h1 class="text-2xl font-bold text-gray-900">live integration demo</h1>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div id="app-container">
                <div class="los-terminal">
                    <!-- APP SHELL (Sidebar + Main Content) -->
                    <div id="app-shell" class="page active">
                        <div class="flex bg-white" style="height: calc(100vh - 12rem);">
                            <!-- Sidebar -->
                            <nav class="w-64 bg-slate-50 border-r border-slate-200 p-4 flex flex-col">
                                <div class="flex items-center space-x-2 mb-8">
                                    <div class="w-10 h-10 bg-sky-500 rounded-lg flex items-center justify-center">
                                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                    </div>
                                    <h1 class="text-2xl font-bold k-gradient-text">ki originate</h1>
                                </div>
                                <ul class="space-y-2">
                                    <li><a href="#" onclick="showAppPage('applications-list-page', this)" class="sidebar-link active flex items-center p-3 rounded-lg text-slate-700 font-medium">Applications</a></li>
                                    <li><a href="#" onclick="showAppPage('new-application-page', this)" class="sidebar-link flex items-center p-3 rounded-lg text-slate-700 font-medium">New Application</a></li>
                                </ul>
                            </nav>

                            <!-- Main Content -->
                            <main class="flex-1 overflow-y-auto bg-slate-100">
                                <div id="app-content" class="p-4 sm:p-6 lg:p-8">
                                    <!-- App pages will be injected here -->
                                </div>
                            </main>
                        </div>
                    </div>
                    
                    <!-- EVALUATION SPINNER -->
                    <div id="evaluation-spinner-page" class="page">
                        <div class="h-full flex flex-col justify-center items-center bg-white p-4" style="height: calc(100vh - 12rem);">
                            <div class="w-16 h-16 border-4 border-sky-500 border-dashed rounded-full animate-spin"></div>
                            <p id="spinner-status" class="mt-6 text-lg font-medium text-slate-700">Starting Evaluation...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- TEMPLATES for App Content -->
    <template id="template-applications-list-page">
        <div class="max-w-7xl mx-auto">
            <div class="flex justify-between items-center mb-6">
                <h1 class="text-3xl font-bold text-slate-800">Applications</h1>
                <button onclick="showAppPage('new-application-page')" class="bg-sky-500 text-white font-bold py-2 px-4 rounded-lg shadow-sm hover:bg-sky-600 transition">New Application</button>
            </div>
            <div class="bg-white rounded-lg shadow-sm border border-slate-200 overflow-x-auto">
                <table class="min-w-full divide-y divide-slate-200" style="min-width: 1000px;">
                    <thead class="bg-slate-50">
                        <tr>
                            <th class="px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider" style="min-width: 120px;">Application ID</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider" style="min-width: 140px;">Applicant Name</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider" style="min-width: 100px;">Asset Class</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider" style="min-width: 80px;">Ki Score</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider" style="min-width: 100px;">Bureau Profile</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider" style="min-width: 120px;">Alt Data Profile</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider" style="min-width: 90px;">Decision</th>
                        </tr>
                    </thead>
                    <tbody id="applications-table-body" class="bg-white divide-y divide-slate-200"></tbody>
                </table>
            </div>
        </div>
    </template>

    <template id="template-new-application-page">
        <div class="max-w-4xl mx-auto">
            <div class="bg-white p-8 rounded-2xl border border-slate-200 shadow-sm">
                <div class="mb-8 text-left">
                    <h1 class="text-3xl font-bold text-slate-800">New Application</h1>
                    <p class="text-slate-500 mt-1">Select an asset class and fill in the details to begin evaluation.</p>
                </div>
                
                <div class="mb-8">
                    <label for="asset-class" class="font-semibold text-slate-700">Asset Class</label>
                    <select id="asset-class" onchange="updateAssetFields()" class="mt-1 block w-full rounded-lg border-slate-200 bg-slate-50 py-3 px-4 shadow-sm focus:border-sky-400 focus:ring focus:ring-sky-200 focus:ring-opacity-50 transition">
                        <option value="Agriculture">Agriculture</option>
                        <option value="SmallBusiness">Small Business</option>
                        <option value="Personal">Personal Loan</option>
                        <option value="Digital">Digital Loan</option>
                        <option value="Microfinance">Microfinance (JLG)</option>
                        <option value="MSME">MSME</option>
                    </select>
                </div>
                
                <div id="asset-specific-fields"></div>

                <div class="mt-10 pt-6 border-t border-slate-200">
                    <div class="flex justify-end">
                        <button onclick="runEvaluation()" class="w-full md:w-auto bg-sky-600 text-white font-bold py-3 px-8 rounded-lg shadow-md hover:bg-sky-700 transition-all transform hover:scale-105 flex items-center justify-center gap-2">
                            <span>Evaluate with Ki Originate</span>
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                              <path fill-rule="evenodd" d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z" clip-rule="evenodd" />
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <template id="template-decision-screen-page">
        <div class="max-w-5xl mx-auto">
             <div class="section-card mb-6">
                <div class="flex justify-between items-start">
                    <div>
                        <a href="#" onclick="showAppPage('applications-list-page')" class="text-sky-600 hover:text-sky-800 text-sm mb-2 inline-block">&larr; Back to Applications List</a>
                        <h1 class="text-2xl font-bold text-slate-800" id="decision-loan-id"></h1>
                    </div>
                    <span class="text-sm font-medium px-3 py-1 rounded-full" id="decision-status-badge"></span>
                </div>
                <div class="mt-4 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-y-4 gap-x-2 text-sm border-t pt-4">
                    <div><span class="text-slate-500 block">Date</span><p class="font-semibold text-slate-800" id="decision-date"></p></div>
                    <div><span class="text-slate-500 block">Loan Officer</span><p class="font-semibold text-slate-800">John Okello</p></div>
                    <div><span class="text-slate-500 block">Product</span><p class="font-semibold text-slate-800" id="decision-product"></p></div>
                    <div><span class="text-slate-500 block">Applicant</span><p class="font-semibold text-slate-800" id="decision-applicant-name"></p></div>
                </div>
            </div>

            <div class="space-y-6">
                <div class="section-card">
                    <div class="section-header"><h2 class="text-xl font-bold text-slate-800">Ki Decision Summary</h2></div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                        <div class="flex flex-col items-center">
                            <div class="gauge-container"><div class="gauge-background"></div><div class="gauge-mask"></div><div id="ki-gauge-pointer-container" class="gauge-pointer-container"><div class="gauge-pointer"></div><div class="gauge-center-circle"></div></div><div class="gauge-text"><div class="text-4xl font-bold text-slate-800" id="decision-ki-score-val"></div><div class="text-lg font-semibold" id="decision-ki-score-grade"></div></div></div>
                            <div class="flex items-center justify-center mt-2">
                                <span class="text-lg font-bold text-slate-700">Ki Score</span>
                                <span class="text-sm font-medium text-slate-600 ml-2">(1-100, lower is better)</span>
                            </div>
                        </div>
                        <div class="bg-slate-50 p-4 rounded-lg"><h3 class="font-semibold text-slate-700 mb-2">DealSmart Recommendation</h3>
                           <ul class="text-sm text-slate-700 space-y-3" id="decision-recommendation-list">
                           </ul>
                        </div>
                    </div>
                </div>

                <div class="section-card">
                    <div class="section-header"><h2 class="text-xl font-bold text-slate-800">Model Explainability</h2></div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="bg-green-50 p-4 rounded-lg border border-green-200"><h3 class="font-semibold text-green-800 mb-2">What's Good</h3><ul class="list-disc list-inside text-sm text-green-700 space-y-1" id="explain-good"></ul></div>
                        <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-200"><h3 class="font-semibold text-yellow-800 mb-2">Needs Improvement</h3><ul class="list-disc list-inside text-sm text-yellow-700 space-y-1" id="explain-improvement"></ul></div>
                        <div class="bg-red-50 p-4 rounded-lg border border-red-200"><h3 class="font-semibold text-red-800 mb-2">What's Bad</h3><ul class="list-disc list-inside text-sm text-red-700 space-y-1" id="explain-bad"></ul></div>
                    </div>
                </div>
                
                <div class="section-card" id="collateral-section"><div class="section-header"><h2 class="text-xl font-bold text-slate-800">Collateral Details</h2><span class="text-sm font-medium px-3 py-1 rounded-full" id="collateral-profile-badge"></span></div><ul class="grid grid-cols-2 md:grid-cols-3 gap-4 text-sm" id="collateral-details-list"></ul></div>
                <div class="section-card" id="bureau-section"><div class="section-header"><h2 class="text-xl font-bold text-slate-800">Bureau Details</h2><span class="text-sm font-medium px-3 py-1 rounded-full" id="bureau-profile-badge"></span></div><ul class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm" id="bureau-details-list"></ul></div>
                <div class="section-card" id="alternate-section"><div class="section-header"><h2 class="text-xl font-bold text-slate-800">Alternate Data Analysis</h2><span class="text-sm font-medium px-3 py-1 rounded-full" id="alternate-profile-badge"></span></div><div class="space-y-4 mt-4" id="alternate-details-content"></div></div>
                <div class="section-card" id="cashflow-section"><div class="section-header"><h2 class="text-xl font-bold text-slate-800 flex items-center">Mobile Wallet Analysis <span class="text-sm text-slate-500 font-normal ml-2">(Optional)</span><button onclick="toggleBankStatement()" class="ml-auto text-sky-600 hover:text-sky-800 text-sm flex items-center" id="bank-statement-toggle"><span id="toggle-text">Expand</span><svg class="w-4 h-4 ml-1 transition-transform" id="toggle-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></button></h2><span class="text-sm font-medium px-3 py-1 rounded-full" id="cashflow-profile-badge"></span></div><div id="cashflow-details" style="display: none;"><ul class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm" id="cashflow-details-list"></ul></div></div></div>
                <div class="section-card" id="affordability-section"><div class="section-header"><h2 class="text-xl font-bold text-slate-800">Affordability Analysis</h2></div><div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center" id="affordability-details-grid"></div></div>
            </div>
        </div>
    </template>

    <script>
        // --- DATA ---
        const mockApplications = [
            { id: '664793', name: 'Grace Adhiambo', assetClass: 'Small Business', score: 35, decision: 'Approved', date: '2025-09-02', bureauProfile: 'Fair', cashflowProfile: 'Excellent', altDataProfile: 'Positive' },
            { id: '664794', name: 'David Kimani', assetClass: 'MSME Loan', score: 12, decision: 'Approved', date: '2025-09-01', bureauProfile: 'Excellent', cashflowProfile: 'Excellent', altDataProfile: 'Positive' },
            { id: '664795', name: 'Mary Wanjiru', assetClass: 'Digital Loan', score: 28, decision: 'Approved', date: '2025-08-30', bureauProfile: 'No History', cashflowProfile: 'Excellent', altDataProfile: 'Average' },
            { id: '664796', name: 'Peter Oloo', assetClass: 'Personal Loan', score: 75, decision: 'Review', date: '2025-08-29', bureauProfile: 'Good', cashflowProfile: 'Poor', altDataProfile: 'Average' },
        ];

        // --- DETAILED DATA FOR EACH USE CASE ---
        const mockApplicationDetails = {
            '664793': { /* Grace Adhiambo - Use Case 1: Fair Bureau, Strong Alternatives */
                ...mockApplications[0],
                summary: { kiScore: 35, grade: 'Good', requestedAmount: 50000, eligibleAmount: 50000, term: 12, apr: 28, },
                explainability: {
                    good: ['Strong mobile wallet surplus', 'Positive alternate data signals', 'Consistent business inflows'],
                    improvement: ['Multiple recent credit inquiries', 'No formal collateral offered'],
                    bad: ['One instance of 30 DPD (12m ago)'],
                },
                collateral: { type: 'Chattel (Business Stock)', ownership: 'Owned', value: 80000 },
                bureau: { 
                    profile: 'Fair', class: 'text-yellow-700 bg-yellow-100', 
                    details: [ 
                        {label: 'Credit History', value: '1.5 years'}, {label: 'Active Accounts', value: '1'}, 
                        {label: 'Inquiries (180d)', value: '6', class: 'text-yellow-600'}, {label: 'Worst DPD (12m)', value: '1-30 DPD'},
                        {label: 'Credit Utilization', value: '75%'}, {label: 'On-Time Payments', value: '92%'},
                        {label: 'Total Balance', value: 'KES 22,500'}, {label: 'Oldest Account', value: '18 months'},
                        {label: 'Secured Loans', value: '0'}, {label: 'Unsecured Loans', value: '1'},
                        {label: 'Public Records', value: 'None'}, {label: 'Days Since Last Loan', value: '45'}
                    ] 
                },
                cashflow: { 
                    profile: 'Excellent', class: 'text-green-700 bg-green-100', 
                    details: [ 
                        {label: 'Avg Net Surplus', value: 'KES 15,100', class: 'text-green-600'}, {label: 'Avg Monthly Inflow', value: 'KES 65,400'},
                        {label: 'Avg Monthly Outflow', value: 'KES 50,300'}, {label: 'Income Volatility', value: 'Low (20%)'}, 
                        {label: 'Betting Activity', value: 'None Detected', class: 'text-green-600'}, {label: 'Loan Repayments', value: '1 Detected (Paid)'},
                        {label: 'Avg Txn Value', value: 'KES 1,250'}, {label: 'Days with Zero Balance', value: '0'},
                        {label: 'Inflow Source', value: 'Paybill (Business)'}, {label: 'Balance Trend', value: 'Increasing', class: 'text-green-600'},
                        {label: 'Unique Payers', value: '150+'}, {label: 'High-Risk Txns', value: 'None'}
                    ] 
                },
                alternate: { 
                    profile: 'Positive', class: 'text-green-700 bg-green-100', 
                    points: { 
                        agri: [
                            {label: 'Business Type', value: 'Retail Shop + Small Farm'}, 
                            {label: 'Land Size', value: '0.5 acres (kitchen garden)'}, 
                            {label: 'Crop Diversification', value: 'Vegetables + Poultry'}, 
                            {label: 'Market Access', value: 'Local market (2km)'}
                        ],
                        socio: [ 
                            {label: 'Housing Quality Index', value: 'Good'}, {label: 'Livelihood Zone', value: 'Urban Trade'}, 
                            {label: 'SIM Tenure', value: '6 years', class: 'text-green-600'}, {label: 'Access to Water', value: 'Piped'},
                            {label: 'Asset Ownership', value: 'Motorcycle + Shop Equipment'}, {label: 'Education Level', value: 'Secondary'},
                            {label: 'Cooperative Member', value: 'Yes - Kazi Njema SACCO'}, {label: 'Market Reputation', value: 'Well-established'}
                        ],
                        climate: [
                            {label: 'Business Location Risk', value: 'Low flood risk', class: 'text-green-600'}, 
                            {label: 'Seasonal Impact', value: 'Minimal - diversified income'}, 
                            {label: 'Infrastructure Access', value: 'Good road connectivity'}
                        ]
                    } 
                },
                affordability: { preDTI: '20%', postDTI: '45%', emi: 'KES 4,820', verdict: 'Comfortable', verdictClass: 'text-green-800 bg-green-50' },
            },
            '664794': { /* David Kimani - Use Case 2: Excellent Profile Upsell */
                ...mockApplications[1],
                summary: { kiScore: 12, grade: 'Excellent', requestedAmount: 250000, eligibleAmount: 350000, term: 24, apr: 18, },
                explainability: {
                    good: ['Pristine credit history', 'Very high, stable income', 'Strong collateral', 'Excellent alternate data'],
                    improvement: [], bad: [],
                },
                collateral: { type: 'Land Title Deed', ownership: 'Owned', value: 1500000 },
                bureau: { 
                    profile: 'Excellent', class: 'text-green-700 bg-green-100', 
                    details: [ 
                        {label: 'Credit History', value: '8 years'}, {label: 'Active Accounts', value: '3'}, 
                        {label: 'Inquiries (180d)', value: '1'}, {label: 'Worst DPD (12m)', value: 'No delinquency', class: 'text-green-600'},
                        {label: 'Credit Utilization', value: '15%', class: 'text-green-600'}, {label: 'On-Time Payments', value: '100%'},
                        {label: 'Total Balance', value: 'KES 1,200,000'}, {label: 'Oldest Account', value: '96 months'},
                        {label: 'Secured Loans', value: '2 (Mortgage, Auto)'}, {label: 'Unsecured Loans', value: '1 (Credit Card)'},
                        {label: 'Public Records', value: 'None'}, {label: 'Days Since Last Loan', value: '250'}
                    ] 
                },
                cashflow: { 
                    profile: 'Excellent', class: 'text-green-700 bg-green-100', 
                    details: [ 
                        {label: 'Avg Net Surplus', value: 'KES 85,000', class: 'text-green-600'}, {label: 'Avg Monthly Inflow', value: 'KES 250,000'},
                        {label: 'Avg Monthly Outflow', value: 'KES 165,000'}, {label: 'Income Volatility', value: 'Very Low (10%)'}, 
                        {label: 'Betting Activity', value: 'None Detected', class: 'text-green-600'}, {label: 'Loan Repayments', value: '3 Detected (All Paid)'},
                        {label: 'Avg Txn Value', value: 'KES 5,500'}, {label: 'Days with Zero Balance', value: '0'},
                        {label: 'Inflow Source', value: 'Salary (Formal)'}, {label: 'Balance Trend', value: 'Increasing', class: 'text-green-600'},
                        {label: 'Unique Payers', value: '20+'}, {label: 'High-Risk Txns', value: 'None'}
                    ] 
                },
                alternate: { 
                    profile: 'Excellent', class: 'text-green-700 bg-green-100', 
                    points: { 
                        agri: [
                            {label: 'Land Size', value: '15 acres', class: 'text-green-600'}, 
                            {label: 'Primary Crop', value: 'Coffee (Arabica)'}, 
                            {label: 'Secondary Crops', value: 'Maize, Beans, Bananas'}, 
                            {label: 'Average Yield', value: '1,200 kg/acre (coffee)', class: 'text-green-600'}, 
                            {label: 'Crop Cash Cycle', value: '6 months (coffee), 4 months (maize)'}, 
                            {label: 'Irrigation Access', value: 'Drip irrigation system', class: 'text-green-600'}, 
                            {label: 'Soil Quality', value: 'Excellent (pH 6.5, high organic matter)'}, 
                            {label: 'Farming Experience', value: '15+ years'}, 
                            {label: 'Cooperative Member', value: 'Coastal Coffee Cooperative'}, 
                            {label: 'Certification', value: 'Organic & Fair Trade certified', class: 'text-green-600'}
                        ],
                        socio: [ 
                            {label: 'Housing Quality Index', value: 'Excellent'}, {label: 'Livelihood Zone', value: 'Commercial Agriculture'}, 
                            {label: 'SIM Tenure', value: '10+ years', class: 'text-green-600'}, {label: 'Access to Water', value: 'Piped + Borehole'},
                            {label: 'Asset Ownership', value: 'Vehicle + Farm Equipment'}, {label: 'Education Level', value: 'University'},
                            {label: 'Leadership Role', value: 'Cooperative Chairman'}, {label: 'Extension Services', value: 'Regular access'}
                        ],
                        climate: [
                            {label: 'Rainfall Pattern', value: 'Excellent (1,200mm/year)', class: 'text-green-600'}, 
                            {label: 'Climate Risk Score', value: 'Very Low', class: 'text-green-600'}, 
                            {label: 'Altitude', value: '1,800m - Ideal for coffee'}, 
                            {label: 'Weather Monitoring', value: 'Digital weather station access'},
                            {label: 'Drought Resilience', value: 'High - irrigation backup'}
                        ]
                    } 
                },
                affordability: { preDTI: '10%', postDTI: '25%', emi: 'KES 17,250', verdict: 'Very Strong', verdictClass: 'text-green-800 bg-green-50' },
            },
            '664795': { /* Mary Wanjiru - Use Case 3: No Bureau, Cashflow Approval */
                ...mockApplications[2],
                summary: { kiScore: 28, grade: 'Good', requestedAmount: 5000, eligibleAmount: 5000, term: 1, apr: 15, },
                explainability: {
                    good: ['Excellent mobile wallet history', 'Stable digital footprint'],
                    improvement: ['Build formal credit history'], bad: ['No bureau data available'],
                },
                collateral: null,
                bureau: { 
                    profile: 'No History', class: 'text-slate-700 bg-slate-100', 
                    details: [
                        {label: 'Credit History', value: 'N/A'}, {label: 'Active Accounts', value: 'N/A'}, 
                        {label: 'Inquiries (180d)', value: 'N/A'}, {label: 'Worst DPD (12m)', value: 'N/A'},
                        {label: 'Credit Utilization', value: 'N/A'}, {label: 'On-Time Payments', value: 'N/A'},
                        {label: 'Total Balance', value: 'N/A'}, {label: 'Oldest Account', value: 'N/A'},
                        {label: 'Secured Loans', value: 'N/A'}, {label: 'Unsecured Loans', value: 'N/A'},
                        {label: 'Public Records', value: 'N/A'}, {label: 'Days Since Last Loan', value: 'N/A'}
                    ] 
                },
                cashflow: { 
                    profile: 'Excellent', class: 'text-green-700 bg-green-100', 
                    details: [ 
                        {label: 'Avg Net Surplus', value: 'KES 9,800', class: 'text-green-600'}, {label: 'Avg Monthly Inflow', value: 'KES 30,000'},
                        {label: 'Avg Monthly Outflow', value: 'KES 20,200'}, {label: 'Income Volatility', value: 'Low (25%)'}, 
                        {label: 'Betting Activity', value: 'None Detected', class: 'text-green-600'}, {label: 'Loan Repayments', value: 'None Detected'},
                        {label: 'Avg Txn Value', value: 'KES 800'}, {label: 'Days with Zero Balance', value: '0'},
                        {label: 'Inflow Source', value: 'P2P & Business'}, {label: 'Balance Trend', value: 'Stable'},
                        {label: 'Unique Payers', value: '40+'}, {label: 'High-Risk Txns', value: 'None'}
                    ] 
                },
                alternate: { 
                    profile: 'Good', class: 'text-green-700 bg-green-100', 
                    points: { 
                        agri: [
                            {label: 'Business Type', value: 'Urban Farming (Vertical)'}, 
                            {label: 'Crop Type', value: 'Leafy vegetables (Kale, Spinach)'}, 
                            {label: 'Production Cycle', value: '6 weeks per harvest'}, 
                            {label: 'Market Channel', value: 'Direct to restaurants'}, 
                            {label: 'Technology Use', value: 'Mobile-based market info', class: 'text-green-600'}
                        ],
                        socio: [ 
                            {label: 'Housing Quality Index', value: 'Average'}, {label: 'Livelihood Zone', value: 'Urban Agriculture'},
                            {label: 'SIM Tenure', value: '3 years'}, {label: 'Access to Water', value: 'Borehole'},
                            {label: 'Asset Ownership', value: 'Smartphone + Farming tools'}, {label: 'Education Level', value: 'Secondary'},
                            {label: 'Digital Literacy', value: 'High - mobile banking user', class: 'text-green-600'}, 
                            {label: 'Market Network', value: '5 regular restaurant clients'}
                        ],
                        climate: [
                            {label: 'Location Risk', value: 'Urban - climate controlled'}, 
                            {label: 'Water Security', value: 'Reliable borehole access'}, 
                            {label: 'Market Resilience', value: 'High - urban demand stable', class: 'text-green-600'}
                        ]
                    } 
                },
                affordability: { preDTI: '0%', postDTI: '20%', emi: 'KES 5,100', verdict: 'Comfortable', verdictClass: 'text-green-800 bg-green-50' },
            },
             '664796': { /* Peter Oloo - Use Case 4: Fraud Signals */
                ...mockApplications[3],
                summary: { kiScore: 75, grade: 'High Risk', requestedAmount: 20000, eligibleAmount: 0, term: 0, apr: 0, },
                explainability: {
                    good: ['Good on-time payment history on bureau'],
                    improvement: ['Reduce betting frequency'], bad: ['High velocity, circular payments detected', 'Significant betting activity'],
                },
                collateral: null,
                bureau: { 
                    profile: 'Good', class: 'text-green-700 bg-green-100', 
                    details: [ 
                        {label: 'Credit History', value: '4 years'}, {label: 'Active Accounts', value: '2'}, 
                        {label: 'Inquiries (180d)', value: '2'}, {label: 'Worst DPD (12m)', value: 'No delinquency', class: 'text-green-600'},
                        {label: 'Credit Utilization', value: '40%'}, {label: 'On-Time Payments', value: '98%'},
                        {label: 'Total Balance', value: 'KES 150,000'}, {label: 'Oldest Account', value: '48 months'},
                        {label: 'Secured Loans', value: '1'}, {label: 'Unsecured Loans', value: '1'},
                        {label: 'Public Records', value: 'None'}, {label: 'Days Since Last Loan', value: '120'}
                    ] 
                },
                cashflow: { 
                    profile: 'Poor', class: 'text-red-700 bg-red-100', 
                    details: [ 
                        {label: 'Avg Net Surplus', value: 'KES 1,200'}, {label: 'Avg Monthly Inflow', value: 'KES 45,000'},
                        {label: 'Avg Monthly Outflow', value: 'KES 43,800'}, {label: 'Income Volatility', value: 'Very High (80%)', class: 'text-red-600'}, 
                        {label: 'Betting Activity', value: 'High (>30% of outflow)', class: 'text-red-600'}, {label: 'Loan Repayments', value: 'Multiple Digital Loans'},
                        {label: 'Avg Txn Value', value: 'KES 500'}, {label: 'Days with Zero Balance', value: '12', class: 'text-yellow-600'},
                        {label: 'Inflow Source', value: 'Betting/P2P'}, {label: 'Balance Trend', value: 'Decreasing'},
                        {label: 'Unique Payers', value: '10 (Limited Circle)'}, {label: 'Fraud Flags', value: '2 (Velocity, Circular)', class: 'text-red-600'}
                    ] 
                },
                alternate: { 
                    profile: 'Poor', class: 'text-red-700 bg-red-100', 
                    points: { 
                        agri: [
                            {label: 'Land Access', value: 'None - landless', class: 'text-red-600'}, 
                            {label: 'Agricultural Activity', value: 'Occasional farm labor'}, 
                            {label: 'Seasonal Work', value: 'Irregular income patterns', class: 'text-red-600'}
                        ],
                        socio: [ 
                            {label: 'SIM Tenure', value: '5 years'}, {label: 'Livelihood Zone', value: 'Informal Trade'},
                            {label: 'Housing Quality', value: 'Poor - rental'}, {label: 'Access to Sanitation', value: 'Shared'},
                            {label: 'Asset Ownership', value: 'None Reported', class: 'text-red-600'}, 
                            {label: 'Social Network', value: 'Limited - high mobility'}, 
                            {label: 'Financial Inclusion', value: 'Mobile money only'}
                        ],
                        climate: [
                            {label: 'Vulnerability', value: 'High - no agricultural assets', class: 'text-red-600'}, 
                            {label: 'Income Stability', value: 'Weather dependent', class: 'text-red-600'}, 
                            {label: 'Risk Mitigation', value: 'None - no safety nets', class: 'text-red-600'}
                        ]
                    } 
                },
                affordability: { preDTI: '30%', postDTI: 'N/A', emi: 'N/A', verdict: 'Rejected', verdictClass: 'text-red-800 bg-red-50' },
            },
        };
        
        // --- PAGE & CONTENT LOGIC ---
        function showPage(pageId, isAppInit = false) {
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            if (isAppInit) {
                const appListLink = Array.from(document.querySelectorAll('.sidebar-link')).find(el => el.getAttribute('onclick').includes('applications-list-page'));
                showAppPage('applications-list-page', appListLink);
            }
        }

        function showAppPage(templateId, navLink = null, appId = null) {
            const contentArea = document.getElementById('app-content');
            const template = document.getElementById(`template-${templateId}`);
            if (!template) return;
            contentArea.innerHTML = template.innerHTML;

            document.querySelectorAll('.sidebar-link').forEach(link => link.classList.remove('active'));
            if (navLink) {
                navLink.classList.add('active');
            } else {
                const matchingLink = Array.from(document.querySelectorAll('.sidebar-link')).find(l => l.getAttribute('onclick')?.includes(templateId));
                if(matchingLink) matchingLink.classList.add('active');
            }
            
            if (templateId === 'applications-list-page') {
                populateApplicationsTable();
            }
            if (templateId === 'new-application-page') {
                updateAssetFields();
            }
            if (templateId === 'decision-screen-page' && appId) {
                const appData = mockApplicationDetails[appId];
                if(appData) populateDecisionScreen(appData);
            }
        }

        function populateApplicationsTable() {
            const tableBody = document.getElementById('applications-table-body');
            if (!tableBody) return;
            tableBody.innerHTML = '';

            const getProfileClass = (profile) => {
                switch (profile) {
                    case 'Excellent': case 'Positive': case 'Good': return 'text-green-700';
                    case 'Fair': case 'Average': return 'text-yellow-700';
                    case 'Poor': return 'text-red-700';
                    default: return 'text-slate-600';
                }
            };

            mockApplications.forEach(app => {
                let decisionClass = '';
                if (app.decision === 'Approved') { decisionClass = 'bg-green-100 text-green-800'; } 
                else if (app.decision === 'Rejected') { decisionClass = 'bg-red-100 text-red-800'; } 
                else { decisionClass = 'bg-yellow-100 text-yellow-800'; }

                let scoreClass = '';
                if(app.score <= 20) { scoreClass = 'text-green-600'; } 
                else if (app.score <= 50) { scoreClass = 'text-yellow-600'; } 
                else { scoreClass = 'text-red-600'; }

                const row = `
                    <tr class="clickable-row" onclick="showAppPage('decision-screen-page', null, '${app.id}')">
                        <td class="px-4 py-4 whitespace-nowrap text-sm font-medium text-slate-900">${app.id}</td>
                        <td class="px-4 py-4 whitespace-nowrap text-sm text-slate-500">${app.name}</td>
                        <td class="px-4 py-4 whitespace-nowrap text-sm text-slate-500">${app.assetClass}</td>
                        <td class="px-4 py-4 whitespace-nowrap text-sm font-bold ${scoreClass}">${app.score}</td>
                        <td class="px-4 py-4 whitespace-nowrap text-sm font-semibold ${getProfileClass(app.bureauProfile)}">${app.bureauProfile}</td>
                        <td class="px-4 py-4 whitespace-nowrap text-sm font-semibold ${getProfileClass(app.altDataProfile)}">${app.altDataProfile}</td>
                        <td class="px-4 py-4 whitespace-nowrap text-sm"><span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${decisionClass}">${app.decision}</span></td>
                    </tr>`;
                tableBody.innerHTML += row;
            });
        }

        function populateDecisionScreen(app) {
            document.getElementById('decision-loan-id').textContent = `Loan ID - ${app.id}`;
            const badge = document.getElementById('decision-status-badge');
            badge.textContent = app.decision;
             if (app.decision === 'Approved') { badge.className = 'text-sm font-medium text-green-700 bg-green-100 px-3 py-1 rounded-full';} 
             else if (app.decision === 'Rejected') { badge.className = 'text-sm font-medium text-red-700 bg-red-100 px-3 py-1 rounded-full';} 
             else { badge.className = 'text-sm font-medium text-yellow-700 bg-yellow-100 px-3 py-1 rounded-full';}
            document.getElementById('decision-date').textContent = app.date;
            document.getElementById('decision-product').textContent = app.assetClass;
            document.getElementById('decision-applicant-name').textContent = app.name;
            document.getElementById('decision-ki-score-val').textContent = app.summary.kiScore;
            const gradeEl = document.getElementById('decision-ki-score-grade');
            gradeEl.textContent = app.summary.grade;
            if (app.summary.kiScore <= 20) { gradeEl.className = 'text-lg font-semibold text-green-600'; } 
            else if (app.summary.kiScore <= 50) { gradeEl.className = 'text-lg font-semibold text-yellow-600'; } 
            else { gradeEl.className = 'text-lg font-semibold text-red-600'; }
            setKiGaugeValue('ki-gauge-pointer-container', app.summary.kiScore, 1, 100);
            const recoList = document.getElementById('decision-recommendation-list');
            recoList.innerHTML = `
                <li class="flex justify-between"><span>Requested Amount:</span> <span class="font-medium">KES ${app.summary.requestedAmount.toLocaleString()}</span></li>
                <li class="flex justify-between ${app.summary.eligibleAmount > app.summary.requestedAmount ? 'text-green-600' : ''}"><span>Eligible Amount:</span> <span class="font-bold">KES ${app.summary.eligibleAmount.toLocaleString()}</span></li>
                <li class="flex justify-between"><span>Recommended Term:</span> <span class="font-medium">${app.summary.term} Months</span></li>
                <li class="flex justify-between"><span>Recommended APR:</span> <span class="font-medium">${app.summary.apr}%</span></li>
            `;
            document.getElementById('explain-good').innerHTML = app.explainability.good.map(i => `<li>${i}</li>`).join('');
            document.getElementById('explain-improvement').innerHTML = app.explainability.improvement.map(i => `<li>${i}</li>`).join('');
            document.getElementById('explain-bad').innerHTML = app.explainability.bad.map(i => `<li>${i}</li>`).join('');
            if (app.collateralDetails) {
                // For Affordable Housing with detailed collateral info
                populateSection('collateral', app.collateralDetails, (data, listEl, badgeEl) => {
                    badgeEl.textContent = data.profile;
                    badgeEl.className = `text-sm font-medium px-3 py-1 rounded-full ${data.class}`;
                    listEl.innerHTML = data.details.map(i => `<li><span class="text-slate-500 block">${i.label}</span><p class="font-semibold ${i.class || 'text-slate-800'}">${i.value}</p></li>`).join('');
                });
            } else {
                // For other asset classes with basic collateral info
                populateSection('collateral', app.collateral, (data, el) => {
                    el.innerHTML = `<li><span class="text-slate-500 block">Type</span><p class="font-semibold text-slate-800">${data.type}</p></li> <li><span class="text-slate-500 block">Ownership</span><p class="font-semibold text-slate-800">${data.ownership}</p></li> <li><span class="text-slate-500 block">Value (KES)</span><p class="font-semibold text-slate-800">KES ${data.value.toLocaleString()}</p></li>`;
                });
            }
            populateSection('bureau', app.bureau, (data, listEl, badgeEl) => { badgeEl.textContent = data.profile; badgeEl.className = `text-sm font-medium px-3 py-1 rounded-full ${data.class}`; listEl.innerHTML = data.details.map(i => `<li><span class="text-slate-500 block">${i.label}</span><p class="font-semibold text-slate-800 ${i.class || ''}">${i.value}</p></li>`).join(''); });
            populateSection('cashflow', app.cashflow, (data, listEl, badgeEl) => { badgeEl.textContent = data.profile; badgeEl.className = `text-sm font-medium px-3 py-1 rounded-full ${data.class}`; listEl.innerHTML = data.details.map(i => `<li><span class="text-slate-500 block">${i.label}</span><p class="font-semibold ${i.class || 'text-slate-800'}">${i.value}</p></li>`).join(''); });
            populateSection('alternate', app.alternate, (data, contentEl, badgeEl) => { badgeEl.textContent = data.profile; badgeEl.className = `text-sm font-medium px-3 py-1 rounded-full ${data.class}`; let html = '<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">'; if (data.points.agri && data.points.agri.length > 0) html += `<div class="bg-green-50 p-4 rounded-lg border border-green-200"><h3 class="font-semibold text-green-800 mb-3 flex items-center"><svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707"></path></svg>Agricultural Data</h3><ul class="grid grid-cols-1 gap-3 text-sm">${data.points.agri.map(i => `<li class="flex justify-between"><span class="text-slate-600">${i.label}</span><span class="font-semibold ${i.class || 'text-slate-800'}">${i.value}</span></li>`).join('')}</ul></div>`; if (data.points.socio.length > 0) html += `<div class="bg-slate-50 p-4 rounded-lg border"><h3 class="font-semibold text-slate-700 mb-3 flex items-center"><svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>Socioeconomic Data</h3><ul class="grid grid-cols-1 gap-3 text-sm">${data.points.socio.map(i => `<li class="flex justify-between"><span class="text-slate-500">${i.label}</span><span class="font-semibold ${i.class || 'text-slate-800'}">${i.value}</span></li>`).join('')}</ul></div>`; if (data.points.climate && data.points.climate.length > 0) html += `<div class="bg-blue-50 p-4 rounded-lg border border-blue-200"><h3 class="font-semibold text-blue-800 mb-3 flex items-center"><svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 15a4 4 0 004 4h9a5 5 0 10-.1-9.999 5.002 5.002 0 10-9.78 2.096A4.001 4.001 0 003 15z"></path></svg>Climate & Risk Data</h3><ul class="grid grid-cols-1 gap-3 text-sm">${data.points.climate.map(i => `<li class="flex justify-between"><span class="text-slate-600">${i.label}</span><span class="font-semibold ${i.class || 'text-slate-800'}">${i.value}</span></li>`).join('')}</ul></div>`; html += '</div>'; contentEl.innerHTML = html; });
            populateSection('affordability', app.affordability, (data, gridEl) => { gridEl.innerHTML = ` <div class="bg-slate-50 p-4 rounded-lg"><p class="text-sm text-slate-500">DTI (Pre-Loan)</p><p class="text-2xl font-bold text-slate-800">${data.preDTI}</p></div> <div class="bg-sky-50 p-4 rounded-lg"><p class="text-sm text-sky-700">DTI (Post-Loan)</p><p class="text-2xl font-bold text-sky-800">${data.postDTI}</p></div> <div class="bg-slate-50 p-4 rounded-lg"><p class="text-sm text-slate-500">Proposed EMI</p><p class="text-2xl font-bold text-slate-800">${data.emi}</p></div> <div class="p-4 rounded-lg ${data.verdictClass}"><p class="text-sm">Verdict</p><p class="text-2xl font-bold">${data.verdict}</p></div> `; });
        }

        function populateSection(name, data, renderer) {
            const sectionEl = document.getElementById(`${name}-section`);
            if (!data) { if(sectionEl) sectionEl.style.display = 'none'; return; }
            if(sectionEl) sectionEl.style.display = 'block';
            if (name === 'bureau' || name === 'cashflow' || name === 'alternate' || name === 'collateral') { renderer(data, document.getElementById(`${name}-details-list`) || document.getElementById(`${name}-details-content`), document.getElementById(`${name}-profile-badge`)); } 
            else { renderer(data, document.getElementById(`${name}-details-list`) || document.getElementById(`${name}-details-grid`)); }
        }
        
        // --- FORM LOGIC ---
        const assetClassFields = {
            _createField(label, id, type = 'text', options = [], value = '') { let fieldHtml = ''; const fieldClasses = "mt-1 block w-full rounded-lg border-slate-200 bg-slate-50 py-2.5 px-4 shadow-sm focus:border-sky-400 focus:ring focus:ring-sky-200 focus:ring-opacity-50 transition"; if (type === 'select') { const optionsHtml = options.map(opt => `<option>${opt}</option>`).join(''); fieldHtml = `<select id="${id}" class="${fieldClasses}">${optionsHtml}</select>`; } else { fieldHtml = `<input type="${type}" id="${id}" value="${value}" class="${fieldClasses}">`; } return `<div><label for="${id}" class="font-semibold text-slate-700">${label}</label>${fieldHtml}</div>`; },
            _createSection(title, content) { return ` <div> <h3 class="text-lg font-bold text-slate-700 mb-4">${title}</h3> <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-5"> ${content} </div> </div> `; },
            _createWrapper(sections) { return `<div class="space-y-8">${sections}</div>`; },
            Agriculture: function() { const loanDetails = this._createField('Requested Amount (KES)', 'req-amount', 'number', [], '18000') + this._createField('Tenure (months)', 'req-tenure', 'number', [], '6'); const applicantDetails = this._createField('Applicant Name', 'app-name', 'text', [], 'Faith Mwangi') + this._createField('National ID', 'app-id', 'text', [], '87654321') + this._createField('Pincode', 'app-pincode', 'text', [], '20117'); const collateralDetails = this._createField('Collateral Type', 'col-type', 'select', ['Land', 'Livestock', 'Equipment']) + this._createField('Ownership', 'col-owner', 'select', ['Communal', 'Owned', 'Leased']); return this._createWrapper(this._createSection('Loan Details', loanDetails) + this._createSection('Applicant Details', applicantDetails) + this._createSection('Collateral', collateralDetails)); },
            SmallBusiness: function() { const loanDetails = this._createField('Requested Amount (KES)', 'req-amount', 'number', [], '40000') + this._createField('Tenure (months)', 'req-tenure', 'number', [], '12'); const businessDetails = this._createField('Business Name', 'biz-name', 'text', [], 'Kazi Njema Store') + this._createField('Years in Business', 'biz-years', 'number', [], '3') + this._createField('Avg Monthly Revenue', 'biz-rev', 'number', [], '150000'); return this._createWrapper(this._createSection('Loan Details', loanDetails) + this._createSection('Business Details', businessDetails)); },
            Personal: function() { const loanDetails = this._createField('Requested Amount (KES)', 'req-amount', 'number', [], '50000') + this._createField('Tenure (months)', 'req-tenure', 'number', [], '24'); const applicantDetails = this._createField('Applicant Name', 'app-name', 'text', [], 'John Doe') + this._createField('Employer', 'app-employer', 'text', [], 'ABC Company') + this._createField('Net Monthly Salary', 'app-salary', 'number', [], '70000'); return this._createWrapper(this._createSection('Loan Details', loanDetails) + this._createSection('Applicant Details', applicantDetails)); },
            Digital: function() { const loanDetails = this._createField('Requested Amount (KES)', 'req-amount', 'number', [], '5000'); const applicantDetails = this._createField('Full Name', 'app-name', 'text', [], 'Jane Akinyi') + this._createField('Phone Number', 'app-phone', 'text', [], '254722123456'); return this._createWrapper(this._createSection('Loan Details', loanDetails) + this._createSection('Applicant Details', applicantDetails)); },
            Microfinance: function() { const loanDetails = this._createField('Loan per Member (KES)', 'req-amount', 'number', [], '10000') + this._createField('Tenure (weeks)', 'req-tenure', 'number', [], '16'); const groupDetails = this._createField('Group Name', 'group-name', 'text', [], 'Upendo Women Group') + this._createField('Number of Members', 'group-members', 'number', [], '15'); return this._createWrapper(this._createSection('Loan Details', loanDetails) + this._createSection('Group Details', groupDetails)); },
            MSME: function() { const loanDetails = this._createField('Requested Amount (KES)', 'req-amount', 'number', [], '250000') + this._createField('Tenure (months)', 'req-tenure', 'number', [], '18'); const businessDetails = this._createField('Business Name', 'biz-name', 'text', [], 'Coastal Traders Ltd') + this._createField('Business Reg. No', 'biz-reg', 'text', [], 'BN-XYZ123') + this._createField('Avg Monthly Turnover', 'biz-turnover', 'number', [], '800000'); return this._createWrapper(this._createSection('Loan Details', loanDetails) + this._createSection('Business Details', businessDetails)); },
        };

        function updateAssetFields() {
            const assetClass = document.getElementById('asset-class').value;
            const fieldsContainer = document.getElementById('asset-specific-fields');
            if (typeof assetClassFields[assetClass] === 'function') {
                fieldsContainer.innerHTML = assetClassFields[assetClass]();
            } else {
                fieldsContainer.innerHTML = '';
            }
        }
        
        function runEvaluation() {
            showPage('evaluation-spinner-page');
            const statusEl = document.getElementById('spinner-status');
            const steps = ['Pulling Bureau Report...', 'Assessing Alternate Data...'];
            let currentStep = 0;
            statusEl.textContent = steps[currentStep];
            const interval = setInterval(() => {
                currentStep++;
                if (currentStep < steps.length) {
                    statusEl.textContent = steps[currentStep];
                } else {
                    clearInterval(interval);
                    showPage('app-shell');
                    showAppPage('decision-screen-page', null, '664793'); 
                }
            }, 1200);
        }

        function toggleBankStatement() {
            const details = document.getElementById('cashflow-details');
            const toggleText = document.getElementById('toggle-text');
            const toggleIcon = document.getElementById('toggle-icon');
            
            if (details.style.display === 'none') {
                details.style.display = 'block';
                toggleText.textContent = 'Collapse';
                toggleIcon.style.transform = 'rotate(180deg)';
            } else {
                details.style.display = 'none';
                toggleText.textContent = 'Expand';
                toggleIcon.style.transform = 'rotate(0deg)';
            }
        }

        function setKiGaugeValue(elementId, value, min, max) {
            const pointerContainer = document.getElementById(elementId);
            if (!pointerContainer) return;
            const range = max - min;
            const percentage = (value - min) / range;
            const angle = -90 + (percentage * 180);
            pointerContainer.style.transform = `rotate(${angle}deg)`;
        }
        
        window.onload = () => showPage('app-shell', true);
    </script>
</body>
</html>