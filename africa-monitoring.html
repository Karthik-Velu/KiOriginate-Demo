<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KI Originate - Africa Monitoring Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        
        .card {
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            transition: all 0.2s ease-in-out;
        }
        
        .card:hover {
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -2px rgb(0 0 0 / 0.1);
        }
        
        .nav-tab {
            padding: 1rem 1.5rem;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            font-weight: 600;
            color: #6b7280;
            transition: all 0.3s ease;
        }
        
        .nav-tab.active {
            color: #059669;
            border-bottom-color: #059669;
            background-color: #ecfdf5;
        }
        
        .nav-tab:hover {
            color: #059669;
            background-color: #f0fdf4;
        }
        
        .section-content {
            display: none;
        }
        
        .section-content.active {
            display: block;
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .metric-card {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            color: white;
            border-radius: 1rem;
            padding: 1.5rem;
        }
        
        .metric-value {
            font-size: 2.5rem;
            font-weight: 700;
            line-height: 1;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            color: white;
            font-weight: 600;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(5, 150, 105, 0.3);
        }
        
        .btn-secondary {
            background-color: #e5e7eb;
            color: #374151;
            font-weight: 600;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
        }
        
        .btn-secondary:hover {
            background-color: #d1d5db;
        }
        
        .alert-card {
            border-left: 4px solid #ef4444;
            background-color: #fef2f2;
        }
        
        .warning-card {
            border-left: 4px solid #f59e0b;
            background-color: #fffbeb;
        }
        
        .success-card {
            border-left: 4px solid #10b981;
            background-color: #ecfdf5;
        }
        
        .data-table {
            overflow-x: auto;
        }
        
        .data-table table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .data-table th,
        .data-table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .data-table th {
            background-color: #f9fafb;
            font-weight: 600;
            color: #374151;
        }
        
        .performance-toggle {
            background-color: #059669;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .performance-toggle:hover {
            background-color: #047857;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 50;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }
        
        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background-color: white;
            border-radius: 0.75rem;
            padding: 2rem;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="min-h-screen">
        <!-- Header -->
        <div class="bg-white shadow-sm border-b">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-16">
                    <div class="flex items-center space-x-4">
                        <button onclick="window.location.href='africa-home.html'" class="text-gray-500 hover:text-gray-700">
                            <i class="fas fa-arrow-left text-xl"></i>
                        </button>
                        <div class="flex items-center space-x-3">
                            <div class="bg-green-600 text-white p-2 rounded-lg">
                                <i class="fas fa-chart-line text-xl"></i>
                            </div>
                            <div>
                                <h1 class="text-2xl font-bold text-gray-900">Africa Monitoring Dashboard</h1>
                                <p class="text-sm text-gray-500">Kenya Portfolio & Model Performance</p>
                            </div>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div class="performance-toggle" onclick="togglePerformanceMode()">
                            <i class="fas fa-toggle-off mr-2" id="toggle-icon"></i>
                            <span id="toggle-text">Enable Performance Data</span>
                        </div>
                        <div class="text-sm text-gray-500">
                            <i class="fas fa-calendar mr-1"></i>
                            Last Updated: <span id="last-updated">Nov 15, 2024</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Navigation Tabs -->
        <div class="bg-white border-b">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex space-x-8">
                    <div class="nav-tab active" onclick="switchSection('portfolio')">
                        <i class="fas fa-briefcase mr-2"></i>Portfolio Monitoring
                    </div>
                    <div class="nav-tab" onclick="switchSection('model')">
                        <i class="fas fa-brain mr-2"></i>Model Monitoring
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            
            <!-- Portfolio Monitoring Section -->
            <div id="portfolio-section" class="section-content active">
                <!-- Day 0 View (Default) -->
                <div id="portfolio-day0" class="portfolio-view">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-3xl font-bold text-gray-900">Kenya Portfolio Overview</h2>
                        <div class="flex items-center space-x-4">
                            <select class="border rounded-lg px-3 py-2">
                                <option>All Products</option>
                                <option>Digital Loans</option>
                                <option>Microfinance</option>
                                <option>MSME</option>
                                <option>Agriculture</option>
                                <option>Small Business</option>
                                <option>Personal Loans</option>
                            </select>
                            <select class="border rounded-lg px-3 py-2">
                                <option>Last 6 Months</option>
                                <option>Last 12 Months</option>
                                <option>YTD</option>
                            </select>
                        </div>
                    </div>

                    <!-- Key Metrics -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <div class="metric-card">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-green-100 text-sm font-medium">Total Applications</p>
                                    <p class="metric-value">15,200</p>
                                    <p class="text-green-100 text-sm">↑ 18% from last month</p>
                                </div>
                                <i class="fas fa-file-alt text-3xl opacity-80"></i>
                            </div>
                        </div>
                        <div class="metric-card">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-green-100 text-sm font-medium">Auto Approved</p>
                                    <p class="metric-value">12,920</p>
                                    <p class="text-green-100 text-sm">85.0% approval rate</p>
                                </div>
                                <i class="fas fa-check-circle text-3xl opacity-80"></i>
                            </div>
                        </div>
                        <div class="metric-card">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-green-100 text-sm font-medium">Approved Amount</p>
                                    <p class="metric-value">KES 380M</p>
                                    <p class="text-green-100 text-sm">↑ 25% from last month</p>
                                </div>
                                <i class="fas fa-coins text-3xl opacity-80"></i>
                            </div>
                        </div>
                        <div class="metric-card">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-green-100 text-sm font-medium">Avg. Loan Amount</p>
                                    <p class="metric-value">KES 29K</p>
                                    <p class="text-green-100 text-sm">Mobile-first lending</p>
                                </div>
                                <i class="fas fa-mobile-alt text-3xl opacity-80"></i>
                            </div>
                        </div>
                    </div>

                    <!-- Charts Row -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                        <div class="card p-6">
                            <h3 class="text-xl font-bold text-gray-900 mb-4">Monthly Originations</h3>
                            <div id="originations-chart"></div>
                        </div>
                        <div class="card p-6">
                            <h3 class="text-xl font-bold text-gray-900 mb-4">Monthly KI Score Trends</h3>
                            <div id="ki-score-chart"></div>
                        </div>
                    </div>

                    <!-- Product Distribution & Tenure Analysis -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                        <div class="card p-6">
                            <h3 class="text-xl font-bold text-gray-900 mb-4">Product Distribution</h3>
                            <div id="product-distribution-chart"></div>
                        </div>
                        <div class="card p-6">
                            <h3 class="text-xl font-bold text-gray-900 mb-4">Loan Tenure Distribution</h3>
                            <div id="tenure-chart"></div>
                        </div>
                    </div>

                    <!-- Ticket Size Analysis -->
                    <div class="card p-6 mb-8">
                        <h3 class="text-xl font-bold text-gray-900 mb-4">Distribution by Ticket Size (KES)</h3>
                        <div id="ticket-size-chart"></div>
                    </div>

                    <!-- Key Metrics Table -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                        <div class="card p-6">
                            <h3 class="text-xl font-bold text-gray-900 mb-4">Key Distributions</h3>
                            <div class="data-table">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Metric</th>
                                            <th>Average</th>
                                            <th>Trend</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>KI Score</td>
                                            <td>28.3</td>
                                            <td><span class="text-green-600">↓ 3.2%</span></td>
                                        </tr>
                                        <tr>
                                            <td>Mobile Money Score</td>
                                            <td>745</td>
                                            <td><span class="text-green-600">↑ 4.1%</span></td>
                                        </tr>
                                        <tr>
                                            <td>Monthly Income</td>
                                            <td>KES 28,500</td>
                                            <td><span class="text-green-600">↑ 6.2%</span></td>
                                        </tr>
                                        <tr>
                                            <td>Loan Tenure</td>
                                            <td>1.8 months</td>
                                            <td><span class="text-blue-600">→ 0.1%</span></td>
                                        </tr>
                                        <tr>
                                            <td>Mobile Usage Score</td>
                                            <td>682</td>
                                            <td><span class="text-green-600">↑ 2.8%</span></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="card p-6">
                            <h3 class="text-xl font-bold text-gray-900 mb-4">Product-wise Performance</h3>
                            <div class="data-table">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Product</th>
                                            <th>Avg Amount</th>
                                            <th>Approval %</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>Digital Loans</td>
                                            <td>KES 15K</td>
                                            <td class="text-green-600">92%</td>
                                        </tr>
                                        <tr>
                                            <td>Microfinance</td>
                                            <td>KES 25K</td>
                                            <td class="text-green-600">88%</td>
                                        </tr>
                                        <tr>
                                            <td>Agriculture</td>
                                            <td>KES 45K</td>
                                            <td class="text-green-600">82%</td>
                                        </tr>
                                        <tr>
                                            <td>MSME</td>
                                            <td>KES 85K</td>
                                            <td class="text-green-600">78%</td>
                                        </tr>
                                        <tr>
                                            <td>Small Business</td>
                                            <td>KES 65K</td>
                                            <td class="text-green-600">80%</td>
                                        </tr>
                                        <tr>
                                            <td>Personal Loans</td>
                                            <td>KES 120K</td>
                                            <td class="text-yellow-600">72%</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Performance Data View (Hidden by default) -->
                <div id="portfolio-performance" class="portfolio-view" style="display: none;">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-3xl font-bold text-gray-900">Kenya Portfolio Performance</h2>
                        <div class="text-sm text-gray-600">
                            Performance data available from: <strong>Oct 2024</strong>
                        </div>
                    </div>

                    <!-- Performance Metrics -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <div class="card p-6 border-l-4 border-green-500">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-600 text-sm font-medium">Current Portfolio</p>
                                    <p class="text-3xl font-bold text-gray-900">KES 285M</p>
                                    <p class="text-green-600 text-sm">Active loans</p>
                                </div>
                                <i class="fas fa-wallet text-3xl text-green-500"></i>
                            </div>
                        </div>
                        <div class="card p-6 border-l-4 border-blue-500">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-600 text-sm font-medium">7+ DPD Rate</p>
                                    <p class="text-3xl font-bold text-gray-900">1.8%</p>
                                    <p class="text-blue-600 text-sm">vs 2.5% industry</p>
                                </div>
                                <i class="fas fa-exclamation-triangle text-3xl text-blue-500"></i>
                            </div>
                        </div>
                        <div class="card p-6 border-l-4 border-red-500">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-600 text-sm font-medium">30+ DPD Rate</p>
                                    <p class="text-3xl font-bold text-gray-900">0.6%</p>
                                    <p class="text-red-600 text-sm">↑ 0.1% from last month</p>
                                </div>
                                <i class="fas fa-times-circle text-3xl text-red-500"></i>
                            </div>
                        </div>
                        <div class="card p-6 border-l-4 border-purple-500">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-600 text-sm font-medium">Recovery Rate</p>
                                    <p class="text-3xl font-bold text-gray-900">89%</p>
                                    <p class="text-purple-600 text-sm">Within 30 days</p>
                                </div>
                                <i class="fas fa-undo text-3xl text-purple-500"></i>
                            </div>
                        </div>
                    </div>

                    <!-- Performance Charts -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                        <div class="card p-6">
                            <h3 class="text-xl font-bold text-gray-900 mb-4">DPD Trends (Short-term Focus)</h3>
                            <div id="dpd-trends-chart"></div>
                        </div>
                        <div class="card p-6">
                            <h3 class="text-xl font-bold text-gray-900 mb-4">Mobile Money Performance</h3>
                            <div id="mobile-money-chart"></div>
                        </div>
                    </div>

                    <!-- Performance by Segments -->
                    <div class="card p-6">
                        <h3 class="text-xl font-bold text-gray-900 mb-4">Performance by KI Score Bands</h3>
                        <div class="data-table">
                            <table>
                                <thead>
                                    <tr>
                                        <th>KI Score Band</th>
                                        <th>Volume</th>
                                        <th>Outstanding (KES M)</th>
                                        <th>7+ DPD %</th>
                                        <th>30+ DPD %</th>
                                        <th>Write-off %</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><span class="px-2 py-1 bg-green-100 text-green-800 rounded">1-20 (Best)</span></td>
                                        <td>2,845</td>
                                        <td>KES 89.2</td>
                                        <td class="text-green-600">0.4%</td>
                                        <td class="text-green-600">0.1%</td>
                                        <td class="text-green-600">0.02%</td>
                                    </tr>
                                    <tr>
                                        <td><span class="px-2 py-1 bg-blue-100 text-blue-800 rounded">21-40</span></td>
                                        <td>5,234</td>
                                        <td>KES 142.8</td>
                                        <td class="text-blue-600">1.2%</td>
                                        <td class="text-blue-600">0.3%</td>
                                        <td class="text-blue-600">0.08%</td>
                                    </tr>
                                    <tr>
                                        <td><span class="px-2 py-1 bg-yellow-100 text-yellow-800 rounded">41-60</span></td>
                                        <td>3,156</td>
                                        <td>KES 76.4</td>
                                        <td class="text-yellow-600">2.8%</td>
                                        <td class="text-yellow-600">1.1%</td>
                                        <td class="text-yellow-600">0.3%</td>
                                    </tr>
                                    <tr>
                                        <td><span class="px-2 py-1 bg-red-100 text-red-800 rounded">61-80</span></td>
                                        <td>1,456</td>
                                        <td>KES 28.9</td>
                                        <td class="text-red-600">5.2%</td>
                                        <td class="text-red-600">2.8%</td>
                                        <td class="text-red-600">1.2%</td>
                                    </tr>
                                    <tr>
                                        <td><span class="px-2 py-1 bg-red-200 text-red-900 rounded">81-100 (Worst)</span></td>
                                        <td>229</td>
                                        <td>KES 3.2</td>
                                        <td class="text-red-700">12.2%</td>
                                        <td class="text-red-700">6.1%</td>
                                        <td class="text-red-700">3.8%</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Model Monitoring Section -->
            <div id="model-section" class="section-content">
                <!-- Day 0 View (Default) -->
                <div id="model-day0" class="model-view">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-3xl font-bold text-gray-900">Africa Model Health Dashboard</h2>
                        <button class="btn-primary" onclick="showPerformanceSetup()">
                            <i class="fas fa-cog mr-2"></i>Setup Performance Data
                        </button>
                    </div>

                    <!-- Model Status Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                        <div class="card p-6 border-l-4 border-green-500">
                            <div class="flex items-center justify-between">
                                <div>
                                    <h3 class="font-bold text-gray-900">Primary Model</h3>
                                    <p class="text-lg font-semibold text-green-600">XGBoost Africa v1.3</p>
                                    <p class="text-sm text-gray-600">Deployed: Oct 15, 2024</p>
                                </div>
                                <div class="text-green-500">
                                    <i class="fas fa-check-circle text-2xl"></i>
                                    <p class="text-xs mt-1">Active</p>
                                </div>
                            </div>
                        </div>
                        <div class="card p-6 border-l-4 border-blue-500">
                            <div class="flex items-center justify-between">
                                <div>
                                    <h3 class="font-bold text-gray-900">Champion Gini</h3>
                                    <p class="text-lg font-semibold text-blue-600">0.82</p>
                                    <p class="text-sm text-gray-600">Kenya development dataset</p>
                                </div>
                                <div class="text-blue-500">
                                    <i class="fas fa-trophy text-2xl"></i>
                                    <p class="text-xs mt-1">Champion</p>
                                </div>
                            </div>
                        </div>
                        <div class="card p-6 border-l-4 border-yellow-500">
                            <div class="flex items-center justify-between">
                                <div>
                                    <h3 class="font-bold text-gray-900">Predictions Made</h3>
                                    <p class="text-lg font-semibold text-yellow-600">15,200</p>
                                    <p class="text-sm text-gray-600">This month</p>
                                </div>
                                <div class="text-yellow-500">
                                    <i class="fas fa-chart-line text-2xl"></i>
                                    <p class="text-xs mt-1">Active</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- PSI and CSI Tables -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                        <div class="card p-6">
                            <h3 class="text-xl font-bold text-gray-900 mb-4">
                                Population Stability Index (PSI)
                                <span class="text-sm font-normal text-gray-500 ml-2">- Model Score Distribution Shift</span>
                            </h3>
                            <div class="data-table">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>KI Score Range</th>
                                            <th>Reference %</th>
                                            <th>Current %</th>
                                            <th>PSI Component</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>1-10 (Best)</td>
                                            <td>12.5%</td>
                                            <td>13.2%</td>
                                            <td class="text-green-600">0.004</td>
                                        </tr>
                                        <tr>
                                            <td>11-20</td>
                                            <td>16.8%</td>
                                            <td>16.1%</td>
                                            <td class="text-green-600">0.003</td>
                                        </tr>
                                        <tr>
                                            <td>21-30</td>
                                            <td>22.3%</td>
                                            <td>22.9%</td>
                                            <td class="text-green-600">0.002</td>
                                        </tr>
                                        <tr>
                                            <td>31-40</td>
                                            <td>20.1%</td>
                                            <td>19.8%</td>
                                            <td class="text-green-600">0.000</td>
                                        </tr>
                                        <tr>
                                            <td>41-50</td>
                                            <td>14.2%</td>
                                            <td>14.6%</td>
                                            <td class="text-green-600">0.001</td>
                                        </tr>
                                        <tr>
                                            <td>51-60</td>
                                            <td>8.9%</td>
                                            <td>8.4%</td>
                                            <td class="text-green-600">0.003</td>
                                        </tr>
                                        <tr>
                                            <td>61-70</td>
                                            <td>3.8%</td>
                                            <td>3.6%</td>
                                            <td class="text-green-600">0.001</td>
                                        </tr>
                                        <tr>
                                            <td>71-80</td>
                                            <td>1.2%</td>
                                            <td>1.2%</td>
                                            <td class="text-green-600">0.000</td>
                                        </tr>
                                        <tr>
                                            <td>81-90</td>
                                            <td>0.2%</td>
                                            <td>0.2%</td>
                                            <td class="text-green-600">0.000</td>
                                        </tr>
                                        <tr>
                                            <td>91-100 (Worst)</td>
                                            <td>0.0%</td>
                                            <td>0.0%</td>
                                            <td class="text-green-600">0.000</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="mt-4 p-3 bg-green-50 rounded-lg">
                                <p class="text-sm text-green-700">
                                    <strong>Overall PSI: 0.014</strong> - KI Score distribution is stable
                                </p>
                            </div>
                        </div>

                        <div class="card p-6">
                            <h3 class="text-xl font-bold text-gray-900 mb-4">
                                Characteristic Stability Index (CSI)
                                <span class="text-sm font-normal text-gray-500 ml-2">- Input Feature Drift Detection</span>
                            </h3>
                            <div class="data-table">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Feature</th>
                                            <th>CSI Score</th>
                                            <th>Status</th>
                                            <th>Trend</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>Mobile Money Score</td>
                                            <td>0.06</td>
                                            <td><span class="px-2 py-1 bg-green-100 text-green-800 rounded text-xs">Stable</span></td>
                                            <td class="text-green-600">↓</td>
                                        </tr>
                                        <tr>
                                            <td>Monthly Income</td>
                                            <td>0.09</td>
                                            <td><span class="px-2 py-1 bg-green-100 text-green-800 rounded text-xs">Stable</span></td>
                                            <td class="text-green-600">↑</td>
                                        </tr>
                                        <tr>
                                            <td>Mobile Usage Score</td>
                                            <td>0.04</td>
                                            <td><span class="px-2 py-1 bg-green-100 text-green-800 rounded text-xs">Stable</span></td>
                                            <td class="text-green-600">→</td>
                                        </tr>
                                        <tr>
                                            <td>Loan Amount</td>
                                            <td>0.11</td>
                                            <td><span class="px-2 py-1 bg-yellow-100 text-yellow-800 rounded text-xs">Monitor</span></td>
                                            <td class="text-yellow-600">↑</td>
                                        </tr>
                                        <tr>
                                            <td>Transaction Frequency</td>
                                            <td>0.07</td>
                                            <td><span class="px-2 py-1 bg-green-100 text-green-800 rounded text-xs">Stable</span></td>
                                            <td class="text-green-600">↓</td>
                                        </tr>
                                        <tr>
                                            <td>Account Age</td>
                                            <td>0.03</td>
                                            <td><span class="px-2 py-1 bg-green-100 text-green-800 rounded text-xs">Stable</span></td>
                                            <td class="text-green-600">→</td>
                                        </tr>
                                        <tr>
                                            <td>Loan Tenure</td>
                                            <td>0.05</td>
                                            <td><span class="px-2 py-1 bg-green-100 text-green-800 rounded text-xs">Stable</span></td>
                                            <td class="text-green-600">↓</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="mt-4 p-3 bg-gray-50 rounded-lg">
                                <p class="text-sm text-gray-600">
                                    <strong>CSI Thresholds:</strong> 
                                    <span class="text-green-600">≤0.10 Stable</span> | 
                                    <span class="text-yellow-600">0.10-0.20 Monitor</span> | 
                                    <span class="text-red-600">>0.20 Alert</span>
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Alerts Section -->
                    <div class="card p-6 mb-8">
                        <h3 class="text-xl font-bold text-gray-900 mb-4">Model Health Alerts</h3>
                        <div class="space-y-4">
                            <div class="warning-card p-4 rounded-lg">
                                <div class="flex items-start space-x-3">
                                    <i class="fas fa-info-circle text-yellow-500 text-xl mt-1"></i>
                                    <div class="flex-1">
                                        <h4 class="font-bold text-yellow-800">Loan Amount CSI Monitor</h4>
                                        <p class="text-yellow-700 text-sm">CSI value of 0.11 indicates slight drift in loan amount patterns. Monitor for continued trend.</p>
                                        <p class="text-yellow-600 text-xs mt-1">Detected: Nov 12, 2024 | Severity: Low</p>
                                    </div>
                                    <button class="text-yellow-600 hover:text-yellow-800">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            </div>

                            <div class="success-card p-4 rounded-lg">
                                <div class="flex items-start space-x-3">
                                    <i class="fas fa-check-circle text-green-500 text-xl mt-1"></i>
                                    <div class="flex-1">
                                        <h4 class="font-bold text-green-800">Model Performance Excellent</h4>
                                        <p class="text-green-700 text-sm">KI Score PSI (0.014) and mobile money features showing stable performance. Model optimized for short-term lending.</p>
                                        <p class="text-green-600 text-xs mt-1">Last Check: Nov 15, 2024</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Feature Importance -->
                    <div class="card p-6">
                        <h3 class="text-xl font-bold text-gray-900 mb-4">Current Feature Importance (Africa Model)</h3>
                        <div id="feature-importance-chart"></div>
                    </div>
                </div>

                <!-- Model Performance View (Hidden by default) -->
                <div id="model-performance" class="model-view" style="display: none;">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-3xl font-bold text-gray-900">Africa Model Performance Analysis</h2>
                        <div class="text-sm text-gray-600">
                            Performance validation with Kenya live data
                        </div>
                    </div>

                    <!-- Model Performance Metrics -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <div class="card p-6 border-l-4 border-green-500">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-600 text-sm font-medium">Live Gini</p>
                                    <p class="text-3xl font-bold text-gray-900">0.79</p>
                                    <p class="text-green-600 text-sm">vs 0.82 dev</p>
                                </div>
                                <i class="fas fa-chart-line text-3xl text-green-500"></i>
                            </div>
                        </div>
                        <div class="card p-6 border-l-4 border-blue-500">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-600 text-sm font-medium">KS Statistic</p>
                                    <p class="text-3xl font-bold text-gray-900">0.48</p>
                                    <p class="text-blue-600 text-sm">Excellent separation</p>
                                </div>
                                <i class="fas fa-divide text-3xl text-blue-500"></i>
                            </div>
                        </div>
                        <div class="card p-6 border-l-4 border-purple-500">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-600 text-sm font-medium">Model Accuracy</p>
                                    <p class="text-3xl font-bold text-gray-900">87.2%</p>
                                    <p class="text-purple-600 text-sm">On validation set</p>
                                </div>
                                <i class="fas fa-bullseye text-3xl text-purple-500"></i>
                            </div>
                        </div>
                        <div class="card p-6 border-l-4 border-orange-500">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-600 text-sm font-medium">Precision @ 85%</p>
                                    <p class="text-3xl font-bold text-gray-900">94.1%</p>
                                    <p class="text-orange-600 text-sm">Approval threshold</p>
                                </div>
                                <i class="fas fa-crosshairs text-3xl text-orange-500"></i>
                            </div>
                        </div>
                    </div>

                    <!-- Performance Charts -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                        <div class="card p-6">
                            <h3 class="text-xl font-bold text-gray-900 mb-4">ROC Curve Comparison</h3>
                            <div id="roc-chart"></div>
                        </div>
                        <div class="card p-6">
                            <h3 class="text-xl font-bold text-gray-900 mb-4">Model Calibration</h3>
                            <div id="calibration-chart"></div>
                        </div>
                    </div>

                    <!-- Prediction Distribution -->
                    <div class="card p-6">
                        <h3 class="text-xl font-bold text-gray-900 mb-4">Prediction Score Distribution (Africa)</h3>
                        <div id="prediction-distribution-chart"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Performance Setup Modal -->
    <div id="performance-setup-modal" class="modal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-gray-900">Setup Performance Data - Kenya</h3>
                <button onclick="closePerformanceSetup()" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <div class="space-y-6">
                <div>
                    <h4 class="font-bold text-lg text-gray-800 mb-3">Data Upload Configuration</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Upload Method</label>
                            <select class="w-full border rounded-lg px-3 py-2">
                                <option>SFTP</option>
                                <option>API Push</option>
                                <option>Mobile API</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Upload Frequency</label>
                            <select class="w-full border rounded-lg px-3 py-2">
                                <option>Daily</option>
                                <option>Weekly</option>
                                <option>Real-time</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div>
                    <h4 class="font-bold text-lg text-gray-800 mb-3">Required Data Format (Kenya)</h4>
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <div class="data-table">
                            <table class="text-sm">
                                <thead>
                                    <tr>
                                        <th class="text-left">Field Name</th>
                                        <th class="text-left">Type</th>
                                        <th class="text-left">Required</th>
                                        <th class="text-left">Description</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td class="font-mono">loan_id</td>
                                        <td>String</td>
                                        <td><span class="text-red-600">Yes</span></td>
                                        <td>Unique loan identifier</td>
                                    </tr>
                                    <tr>
                                        <td class="font-mono">mobile_number</td>
                                        <td>String</td>
                                        <td><span class="text-red-600">Yes</span></td>
                                        <td>M-Pesa linked mobile number</td>
                                    </tr>
                                    <tr>
                                        <td class="font-mono">dpd_as_of_date</td>
                                        <td>Number</td>
                                        <td><span class="text-red-600">Yes</span></td>
                                        <td>Days past due</td>
                                    </tr>
                                    <tr>
                                        <td class="font-mono">current_balance_kes</td>
                                        <td>Number</td>
                                        <td><span class="text-red-600">Yes</span></td>
                                        <td>Outstanding balance in KES</td>
                                    </tr>
                                    <tr>
                                        <td class="font-mono">disbursed_amount_kes</td>
                                        <td>Number</td>
                                        <td><span class="text-red-600">Yes</span></td>
                                        <td>Original loan amount in KES</td>
                                    </tr>
                                    <tr>
                                        <td class="font-mono">repayment_method</td>
                                        <td>String</td>
                                        <td><span class="text-yellow-600">Optional</span></td>
                                        <td>M-Pesa, Bank, Cash</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="flex justify-end space-x-4">
                    <button onclick="closePerformanceSetup()" class="btn-secondary">Cancel</button>
                    <button onclick="savePerformanceSetup()" class="btn-primary">Save Configuration</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let performanceDataEnabled = false;
        let charts = {};

        // Section switching
        function switchSection(section) {
            // Update nav tabs
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            // Update content sections
            document.querySelectorAll('.section-content').forEach(content => content.classList.remove('active'));
            document.getElementById(`${section}-section`).classList.add('active');
        }

        // Performance mode toggle
        function togglePerformanceMode() {
            performanceDataEnabled = !performanceDataEnabled;
            const toggleIcon = document.getElementById('toggle-icon');
            const toggleText = document.getElementById('toggle-text');
            
            if (performanceDataEnabled) {
                toggleIcon.className = 'fas fa-toggle-on mr-2';
                toggleText.textContent = 'Performance Data Active';
                
                // Show performance views, hide day 0 views
                document.getElementById('portfolio-day0').style.display = 'none';
                document.getElementById('portfolio-performance').style.display = 'block';
                document.getElementById('model-day0').style.display = 'none';
                document.getElementById('model-performance').style.display = 'block';
                
                // Initialize performance charts
                initPerformanceCharts();
            } else {
                toggleIcon.className = 'fas fa-toggle-off mr-2';
                toggleText.textContent = 'Enable Performance Data';
                
                // Show day 0 views, hide performance views
                document.getElementById('portfolio-day0').style.display = 'block';
                document.getElementById('portfolio-performance').style.display = 'none';
                document.getElementById('model-day0').style.display = 'block';
                document.getElementById('model-performance').style.display = 'none';
            }
        }

        // Performance setup modal
        function showPerformanceSetup() {
            document.getElementById('performance-setup-modal').classList.add('show');
        }

        function closePerformanceSetup() {
            document.getElementById('performance-setup-modal').classList.remove('show');
        }

        function savePerformanceSetup() {
            alert('Performance data configuration saved! Kenya SFTP endpoint configured successfully.');
            closePerformanceSetup();
        }

        // Initialize Day 0 charts
        function initDay0Charts() {
            // Originations Chart
            charts.originations = new ApexCharts(document.querySelector("#originations-chart"), {
                chart: { type: 'bar', height: 300, toolbar: { show: false } },
                plotOptions: { bar: { horizontal: false, columnWidth: '55%' } },
                dataLabels: { enabled: false },
                xaxis: { categories: ['May 24', 'Jun 24', 'Jul 24', 'Aug 24', 'Sep 24', 'Oct 24'] },
                colors: ['#059669', '#10b981'],
                series: [
                    { name: 'Applications', data: [2100, 2350, 2580, 2800, 3100, 3200] },
                    { name: 'Approved', data: [1785, 1998, 2193, 2380, 2635, 2720] }
                ]
            });
            charts.originations.render();

            // KI Score Monthly Trends
            charts.kiScore = new ApexCharts(document.querySelector("#ki-score-chart"), {
                chart: { type: 'line', height: 300, toolbar: { show: false } },
                stroke: { width: 3, curve: 'smooth' },
                xaxis: { categories: ['May 24', 'Jun 24', 'Jul 24', 'Aug 24', 'Sep 24', 'Oct 24'] },
                yaxis: { title: { text: 'Average KI Score' }, min: 20, max: 35 },
                colors: ['#059669', '#10b981', '#ef4444'],
                series: [
                    { name: 'Overall Avg KI Score', data: [30.2, 29.8, 29.1, 28.9, 28.4, 28.3] },
                    { name: 'Approved Avg KI Score', data: [24.5, 24.1, 23.8, 23.2, 22.9, 23.1] },
                    { name: 'Rejected Avg KI Score', data: [48.3, 47.8, 47.2, 46.9, 46.4, 45.8] }
                ],
                tooltip: {
                    y: {
                        formatter: function(val) {
                            return val.toFixed(1) + ' (Lower is Better)';
                        }
                    }
                }
            });
            charts.kiScore.render();

            // Product Distribution Chart
            charts.productDistribution = new ApexCharts(document.querySelector("#product-distribution-chart"), {
                chart: { type: 'donut', height: 300 },
                labels: ['Digital Loans', 'Microfinance', 'MSME', 'Agriculture', 'Small Business', 'Personal Loans'],
                colors: ['#06b6d4', '#f59e0b', '#ef4444', '#10b981', '#8b5cf6', '#f97316'],
                series: [25, 20, 15, 15, 15, 10],
                legend: { position: 'bottom' },
                plotOptions: {
                    pie: {
                        donut: {
                            labels: {
                                show: true,
                                total: {
                                    show: true,
                                    label: 'Total',
                                    formatter: () => '100%'
                                }
                            }
                        }
                    }
                }
            });
            charts.productDistribution.render();

            // Tenure Distribution Chart - Based on attachment showing majority <3 months
            charts.tenureChart = new ApexCharts(document.querySelector("#tenure-chart"), {
                chart: { type: 'bar', height: 300, toolbar: { show: false } },
                plotOptions: { bar: { horizontal: true } },
                dataLabels: { enabled: true },
                xaxis: { 
                    categories: ['<1M', '1M', '2M', '3M', '4M-6M', '7M-12M', '12M-18M', '18M-24M', '24M-30M', '30M-36M', '36M+']
                },
                colors: ['#059669'],
                series: [{ 
                    name: 'Percentage', 
                    data: [8, 81, 5, 3, 2, 0.5, 0.3, 0.1, 0.05, 0.03, 0.02] // Heavily weighted toward 1 month
                }]
            });
            charts.tenureChart.render();

            // Ticket Size Chart - Based on attachment
            charts.ticketSizeChart = new ApexCharts(document.querySelector("#ticket-size-chart"), {
                chart: { type: 'bar', height: 350, toolbar: { show: false } },
                plotOptions: { bar: { horizontal: false, columnWidth: '80%' } },
                dataLabels: { enabled: true },
                xaxis: { 
                    categories: ['0-5K', '5K-10K', '10K-15K', '15K-20K', '20K-25K', '25K-30K', '>30K'],
                    title: { text: 'Ticket Size (KES)' }
                },
                yaxis: { title: { text: 'Percentage %' } },
                colors: ['#059669'],
                series: [{ 
                    name: 'Distribution %', 
                    data: [47, 16, 10, 8, 6, 3, 10] // Based on the distribution chart showing majority in 0-5K range
                }]
            });
            charts.ticketSizeChart.render();

            // Feature Importance Chart - Africa specific
            charts.featureImportance = new ApexCharts(document.querySelector("#feature-importance-chart"), {
                chart: { type: 'bar', height: 300, toolbar: { show: false } },
                plotOptions: { bar: { horizontal: true } },
                dataLabels: { enabled: true },
                xaxis: { 
                    categories: ['Mobile Money Score', 'Monthly Income', 'Mobile Usage Score', 'Transaction Frequency', 'Account Age', 'Loan Amount', 'Employment Type', 'Loan Tenure']
                },
                colors: ['#059669'],
                series: [{ 
                    name: 'Importance', 
                    data: [0.28, 0.19, 0.16, 0.13, 0.10, 0.08, 0.04, 0.02] 
                }]
            });
            charts.featureImportance.render();
        }

        // Initialize Performance charts
        function initPerformanceCharts() {
            // DPD Trends Chart - Short term focus
            if (!charts.dpdTrends) {
                charts.dpdTrends = new ApexCharts(document.querySelector("#dpd-trends-chart"), {
                    chart: { type: 'line', height: 300, toolbar: { show: false } },
                    stroke: { width: 3, curve: 'smooth' },
                    xaxis: { categories: ['Oct 24', 'Nov 24'] },
                    colors: ['#ef4444', '#f59e0b', '#06b6d4'],
                    series: [
                        { name: '7+ DPD', data: [1.5, 1.8] },
                        { name: '15+ DPD', data: [0.8, 1.0] },
                        { name: '30+ DPD', data: [0.5, 0.6] }
                    ]
                });
                charts.dpdTrends.render();
            }

            // Mobile Money Performance Chart
            if (!charts.mobileMoney) {
                charts.mobileMoney = new ApexCharts(document.querySelector("#mobile-money-chart"), {
                    chart: { type: 'area', height: 300, toolbar: { show: false } },
                    stroke: { curve: 'smooth', width: 2 },
                    xaxis: { categories: ['Oct 24', 'Nov 24'] },
                    colors: ['#10b981', '#059669'],
                    series: [
                        { name: 'M-Pesa Repayments %', data: [78, 82] },
                        { name: 'Mobile Lending Volume', data: [85, 89] }
                    ],
                    fill: { opacity: 0.7 }
                });
                charts.mobileMoney.render();
            }

            // ROC Curve
            if (!charts.roc) {
                charts.roc = new ApexCharts(document.querySelector("#roc-chart"), {
                    chart: { type: 'line', height: 300, toolbar: { show: false } },
                    stroke: { width: 3, curve: 'smooth' },
                    xaxis: { title: { text: 'False Positive Rate' } },
                    yaxis: { title: { text: 'True Positive Rate' } },
                    colors: ['#059669', '#ef4444'],
                    series: [
                        { name: 'Africa Model (AUC: 0.79)', data: [[0, 0], [0.1, 0.28], [0.2, 0.48], [0.3, 0.65], [0.4, 0.78], [0.5, 0.85], [0.6, 0.90], [0.7, 0.94], [0.8, 0.97], [0.9, 0.99], [1, 1]] },
                        { name: 'Random (AUC: 0.5)', data: [[0, 0], [1, 1]] }
                    ]
                });
                charts.roc.render();
            }

            // Calibration Chart
            if (!charts.calibration) {
                charts.calibration = new ApexCharts(document.querySelector("#calibration-chart"), {
                    chart: { type: 'line', height: 300, toolbar: { show: false } },
                    stroke: { width: 3, curve: 'smooth' },
                    xaxis: { title: { text: 'Mean Predicted Probability' } },
                    yaxis: { title: { text: 'Fraction of Positives' } },
                    colors: ['#059669', '#ef4444'],
                    series: [
                        { name: 'Model Calibration', data: [[0.1, 0.09], [0.2, 0.19], [0.3, 0.29], [0.4, 0.38], [0.5, 0.52], [0.6, 0.61], [0.7, 0.72], [0.8, 0.81], [0.9, 0.88]] },
                        { name: 'Perfect Calibration', data: [[0, 0], [1, 1]] }
                    ]
                });
                charts.calibration.render();
            }

            // Prediction Distribution - Africa optimized
            if (!charts.predictionDist) {
                charts.predictionDist = new ApexCharts(document.querySelector("#prediction-distribution-chart"), {
                    chart: { type: 'histogram', height: 300, toolbar: { show: false } },
                    plotOptions: { bar: { columnWidth: '80%' } },
                    xaxis: { 
                        title: { text: 'Prediction Score Bins' },
                        categories: ['0-0.1', '0.1-0.2', '0.2-0.3', '0.3-0.4', '0.4-0.5', '0.5-0.6', '0.6-0.7', '0.7-0.8', '0.8-0.9', '0.9-1.0']
                    },
                    yaxis: { title: { text: 'Frequency' } },
                    colors: ['#059669'],
                    series: [{ 
                        name: 'Applications', 
                        data: [189, 356, 567, 823, 1156, 945, 678, 512, 367, 189] 
                    }]
                });
                charts.predictionDist.render();
            }
        }

        // Initialize on load
        document.addEventListener('DOMContentLoaded', function() {
            initDay0Charts();
        });
    </script>
</body>
</html>
